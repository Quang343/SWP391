<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="FrontEnd/fragments/head::head">

    <style>

        /* CƒÉn gi·ªØa ·∫£nh trong container */
        img {
            display: block;
            margin-left: auto;
            margin-right: auto;
            object-fit: contain; /* Ho·∫∑c 'cover' n·∫øu b·∫°n mu·ªën ·∫£nh ph·ªß to√†n b·ªô container */
            max-width: 100%; /* ƒê·∫£m b·∫£o ·∫£nh ƒë√°p ·ª©ng v√† kh√¥ng v∆∞·ª£t qu√° chi·ªÅu r·ªông c·ªßa container */
            height: auto; /* Gi·ªØ t·ª∑ l·ªá ·∫£nh khi thay ƒë·ªïi k√≠ch th∆∞·ªõc */
        }

        /* CƒÉn gi·ªØa t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ trong profile box */
        .profile-box {
            display: flex;
            justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
            align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
            padding: 0;
            margin: 0;
            height: 100%; /* ƒê·∫£m b·∫£o chi·ªÅu cao c·ªßa box l√† 100% */
        }

        /* M·∫´u cho background c·ªßa ·∫£nh */
        .cover-image {
            width: 100%; /* ƒê·∫£m b·∫£o ·∫£nh cover chi·∫øm to√†n b·ªô chi·ªÅu r·ªông */
            height: 200px; /* T√πy ch·ªânh chi·ªÅu cao c·ªßa ·∫£nh cover */
            background-size: cover;
            background-position: center;
        }

        /* Ki·ªÉm tra v√† s·ª≠a layout cho c√°c ph·∫ßn t·ª≠ trong profile */
        .profile-contain {
            text-align: center; /* CƒÉn gi·ªØa vƒÉn b·∫£n */
        }

        /* N·∫øu b·∫°n mu·ªën th√™m padding ho·∫∑c margin cho c√°c ph·∫ßn t·ª≠ trong profile */
        .profile-name {
            margin-top: 10px;
        }

        .cover-icon input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0;
            cursor: pointer;
        }

        /* M√†u n·ªÅn c·ªßa c√°c trang ƒë√£ ch·ªçn */
        ul.custom-pagination li.page-item.active > a.page-link,
        ul.custom-pagination li.page-item.active > span.page-link {
            background-color: #19a877 !important; /* M√†u xanh b·∫°n mu·ªën */
            color: #fff !important;
            border: none !important;
        }

        /* M√†u cho c√°c n√∫t ph√¢n trang ch∆∞a ch·ªçn */
        ul.custom-pagination .page-link {
            color: #198754 !important; /* M√†u ch·ªØ xanh ƒë·∫≠m */
            border-radius: 6px !important;
            min-width: 38px;
            text-align: center;
            box-shadow: none !important;
        }

        /* M√†u khi hover l√™n n√∫t ph√¢n trang */
        ul.custom-pagination .page-link:hover {
            background-color: #e5f6ee !important; /* M√†u n·ªÅn s√°ng khi hover */
            color: #198754 !important;
        }

        /* Th√™m s·ª± ∆∞u ti√™n cho ph√¢n trang khi ch·ªçn */
        .pagination .page-item.active .page-link {
            background-color: #19a877 !important; /* M√†u xanh Fastkart */
            border-color: #19a877 !important;
            color: #fff !important;
            font-weight: 600;
            border-radius: 10px;
        }

    </style>
</head>


<body>

<!-- Loader Start -->
<div class="fullpage-loader">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>
<!-- Loader End -->

<!-- Header Start -->
<header th:replace="FrontEnd/fragments/header::header"></header>
<!-- Header End -->

<!-- mobile fix menu start -->
<div class="mobile-menu d-md-none d-block mobile-cart">
    <ul>
        <li>
            <a href="index.html">
                <i class="iconly-Home icli"></i>
                <span>Home</span>
            </a>
        </li>

        <li class="mobile-category">
            <a href="javascript:void(0)">
                <i class="iconly-Category icli js-link"></i>
                <span>Category</span>
            </a>
        </li>

        <li>
            <a href="search.html" class="search-box">
                <i class="iconly-Search icli"></i>
                <span>Search</span>
            </a>
        </li>

        <li>
            <a href="wishlist.html" class="notifi-wishlist">
                <i class="iconly-Heart icli"></i>
                <span>My Wish</span>
            </a>
        </li>

        <li>
            <a href="cart.html">
                <i class="iconly-Bag-2 icli fly-cate"></i>
                <span>Cart</span>
            </a>
        </li>
    </ul>
</div>
<!-- mobile fix menu end -->

<!-- Breadcrumb Section Start -->
<section class="breadcrumb-section pt-0">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb-contain">
                    <h2>User Dashboard</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="index.html">
                                    <i class="fa-solid fa-house"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active">User Dashboard</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- User Dashboard Section Start -->
<section class="user-dashboard-section section-b-space">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-xxl-3 col-lg-4">
                <div class="dashboard-left-sidebar">
                    <div class="close-button d-flex d-lg-none">
                        <button class="close-sidebar">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    <div class="profile-box">
                        <div class="cover-image">
                            <img th:src="@{FrontEnd/assets/images/inner-page/cover-img.jpg}"
                                 class="img-fluid blur-up lazyload"
                                 alt="">
                        </div>

                        <div class="profile-contain">
                            <div class="profile-image">
                                <div class="position-relative" style="display: flex;justify-content: center; padding-left: 9px">
                                    <img th:src="${session.account.getImageUrl}"
                                         class="blur-up lazyload update_img" alt="more image"
                                         accept=".jpg,.jpeg,.png,.gif,.webp,image/*" style="position: absolute;margin-top: -65px">


                                </div>
                            </div>

                            <div class="profile-name">
                                <h3 th:text="${session.account.getUserName}">Your username</h3>
                                <h6 class="text-content" th:text="${session.account.getEmail}">Your email</h6>
                            </div>

                        </div>
                    </div>

                    <ul class="nav nav-pills user-nav-pills" id="pills-tab" role="tablist">


                        <li class="nav-item" role="presentation">
                            <a href="#pills-tabContent" class="nav-link active" id="pills-dashboard-tab"
                               data-bs-toggle="pill" data-bs-target="#pills-dashboard" role="tab"><i
                                    data-feather="home"></i>
                                DashBoard</a>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link " id="pills-product-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-product" type="button" role="tab"><i
                                    data-feather="shopping-bag"></i>My Blog
                            </button>
                        </li>


                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-order" type="button" role="tab"><i
                                    data-feather="shopping-bag"></i>Order
                            </button>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="col-xxl-9 col-lg-8">
                <button class="btn left-dashboard-show btn-animation btn-md fw-bold d-block mb-4 d-lg-none">Show
                    Menu
                </button>
                <div class="dashboard-right-sidebar">
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-dashboard" role="tabpanel">
                            <div class="dashboard-home">
                                <div class="title">
                                    <h2>Trang t·ªïng quan c·ªßa t√¥i</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="dashboard-user-name">
                                    <h6 class="text-content">Xin ch√†o,<b class="text-title"
                                                                         th:text="${session.account.getUserName}">Your
                                        username</b></h6>
                                    <p class="text-content">T·ª´ t√†i kho·∫£n Dashboard, b·∫°n c√≥ th·ªÉ xem ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y v√†
                                        c·∫≠p nh·∫≠t th√¥ng tin t√†i kho·∫£n..</p>
                                </div>

                                <div class="total-box">
                                    <div class="row g-sm-4 g-3">
                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img th:src="@{FrontEnd/assets/images/svg/order.svg}"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img th:src="@{FrontEnd/assets/images/svg/order.svg}"
                                                     class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>T·ªïng s·ªë Blog</h5>
                                                    <h3 id="totalBlogsCount">0</h3>
                                                    <!-- S·ªë l∆∞·ª£ng blog s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y -->
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img th:src="@{FrontEnd/assets/images/svg/wishlist.svg}"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img th:src="@{FrontEnd/assets/images/svg/wishlist.svg}"
                                                     class="blur-up lazyload" alt="">
                                                <div class="total-detail">
                                                    <h5>T·ªïng y√™u th√≠ch</h5>
                                                    <h3 th:if="${totalWishlist != null}" th:text="${totalWishlist}">
                                                        32158</h3>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-4">
                                    <div class="col-xxl-6">
                                        <div class="dashboard-content-title">
                                            <h4>Th√¥ng tin
                                            </h4>
                                        </div>
                                        <div class="dashboard-detail">
                                            <h6 class="text-content" th:text="${session.account.getFullName}">Your
                                                fullname</h6>
                                            <h6 class="text-content" th:text="${session.account.getEmail}">Your
                                                email</h6>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade " id="pills-product" role="tabpanel">
                            <div class="product-tab">
                                <div class="title">
                                    <h2>All Blog</h2>
                                    <span class="title-leaf">
                <svg class="icon-width bg-gray">
                    <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                </svg>
            </span>
                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">
                                        <button class="btn btn-success"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductModal"
                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">
                                            + Add Blog
                                        </button>
                                    </div>
                                </div>

                                <div class="table-responsive dashboard-bg-box" style="overflow-x:auto; width:100%;">
                                    <table class="table blog-table" style="min-width: 1000px;">
                                        <!--B·∫£ng Blog-->
                                        <thead>
                                        <tr>
                                            <th scope="col">Number</th>
                                            <th scope="col">Images</th>
                                            <th scope="col">Content</th>
                                            <th scope="col">Title</th>
                                            <th scope="col">Author</th>
                                            <th scope="col">Status</th>
                                            <th scope="col">Created At</th>
                                            <th scope="col">Edit / Delete</th>

                                        </tr>
                                        </thead>
                                        <!--                                        <tbody>-->
                                        <!--                                        <tr th:each="blog, iterStat : ${blogs}">-->
                                        <!--                                            &lt;!&ndash; Number (STT) &ndash;&gt;-->
                                        <!--                                            <td th:text="${iterStat.index + 1}"></td>-->

                                        <!--                                            &lt;!&ndash; Images &ndash;&gt;-->
                                        <!--                                            <td>-->
                                        <!--                                                <img th:src="@{'/Frontend/assets/images/blog/' + ${blog.blogDetail.thumbnail}}"-->
                                        <!--                                                     style="max-width: 120px; max-height: 70px; object-fit: cover; border-radius: 6px;"-->
                                        <!--                                                     class="img-fluid" alt="">-->
                                        <!--                                            </td>-->

                                        <!--                                            &lt;!&ndash; Content (Show ng·∫Øn g·ªçn, v√≠ d·ª• 40 k√Ω t·ª± ƒë·∫ßu) &ndash;&gt;-->
                                        <!--                                            <td>-->
                                        <!--                                                <h6 th:text="${#strings.length(blog.content) > 40 ? #strings.substring(blog.content, 0, 40) + '...' : blog.content}"></h6>-->
                                        <!--                                            </td>-->

                                        <!--                                            &lt;!&ndash; Title &ndash;&gt;-->
                                        <!--                                            <td>-->
                                        <!--                                                <h6 th:text="${blog.title}"></h6>-->
                                        <!--                                            </td>-->

                                        <!--                                            &lt;!&ndash; Status &ndash;&gt;-->
                                        <!--                                            <td>-->
                                        <!--                                                <h6 th:text="${blog.status}"></h6>-->
                                        <!--                                            </td>-->

                                        <!--                                            &lt;!&ndash; Created At &ndash;&gt;-->
                                        <!--                                            <td>-->
                                        <!--                                                <h6 th:text="${#dates.format(blog.createdAt, 'dd/MM/yyyy')}"></h6>-->
                                        <!--                                            </td>-->

                                        <!--                                            &lt;!&ndash; Edit/Delete (ch·ªâ l√† icon, b·∫°n c·∫ßn g·∫Øn link js ho·∫∑c url cho action n√†y) &ndash;&gt;-->
                                        <!--                                            <td class="edit-delete">-->
                                        <!--                                                <a th:href="@{'/blog/edit?id=' + ${blog.blogID}}"><i data-feather="edit"-->
                                        <!--                                                                                                     class="edit"></i></a>-->
                                        <!--                                                <a th:href="@{'/blog/delete?id=' + ${blog.blogID}}"-->
                                        <!--                                                   onclick="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a?')">-->
                                        <!--                                                    <i data-feather="trash-2" class="delete"></i>-->
                                        <!--                                                </a>-->
                                        <!--                                            </td>-->
                                        <!--                                        </tr>-->
                                        <!--                                        </tbody>-->

                                        <tbody id="blogTableBody">
                                        <!-- Blog rows s·∫Ω ƒë∆∞·ª£c JS th√™m v√†o ƒë√¢y -->
                                        </tbody>
                                    </table>
                                    <!-- Pagination -->
                                    <nav>
                                        <ul class="pagination justify-content-center custom-pagination" id="pagination">
                                            <!-- JS s·∫Ω render ra c√°c n√∫t ·ªü ƒë√¢y -->
                                        </ul>

                                    </nav>


                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-order" role="tabpanel">
                            <div class="dashboard-order">
                                <div class="title">
                                    <h2>All Order</h2>
                                    <span class="title-leaf title-leaf-gray">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="order-tab dashboard-bg-box">
                                    <div class="table-responsive">
                                        <table class="table order-table">
                                            <thead>
                                            <tr>
                                                <th scope="col">Order ID</th>
                                                <th scope="col">Product Name</th>
                                                <th scope="col">Status</th>
                                                <th scope="col">Price</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td class="product-image">#254834</td>
                                                <td>
                                                    <h6>Fantasy Crunchy Choco Chip Cookies</h6>
                                                </td>
                                                <td>
                                                    <label class="success">Shipped</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#355678</td>
                                                <td>
                                                    <h6>Peanut Butter Bite Premium Butter Cookies 600 g</h6>
                                                </td>
                                                <td>
                                                    <label class="danger">Pending</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>


                                            </tbody>
                                        </table>
                                    </div>
                                    <nav class="custom-pagination">
                                        <ul class="pagination justify-content-center">
                                            <li class="page-item disabled">
                                                <a class="page-link" href="javascript:void(0)" tabindex="-1">
                                                    <i class="fa-solid fa-angles-left"></i>
                                                </a>
                                            </li>
                                            <li class="page-item active">
                                                <a class="page-link" href="javascript:void(0)">1</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">2</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">3</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">
                                                    <i class="fa-solid fa-angles-right"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-profile" role="tabpanel">
                            <div class="dashboard-profile">
                                <div class="title">
                                    <h2>My Profile</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="profile-tab dashboard-bg-box">
                                    <div class="dashboard-title dashboard-flex">
                                        <h3>Profile Name</h3>
                                        <button class="btn btn-sm theme-bg-color text-white" data-bs-toggle="modal"
                                                data-bs-target="#edit-profile">Edit Profile
                                        </button>
                                    </div>

                                    <ul>
                                        <li>
                                            <h5>Company Name :</h5>
                                            <h5>Grocery Store</h5>
                                        </li>
                                        <li>
                                            <h5>Email Address :</h5>
                                            <h5>joshuadbass@rhyta.com</h5>
                                        </li>
                                        <li>
                                            <h5>Country / Region :</h5>
                                            <h5>107 Veltri Drive</h5>
                                        </li>

                                        <li>
                                            <h5>Year Established :</h5>
                                            <h5>2022</h5>
                                        </li>

                                        <li>
                                            <h5>Total Employees :</h5>
                                            <h5>154 - 360 People</h5>
                                        </li>
                                        <li>
                                            <h5>Category :</h5>
                                            <h5>Grocery</h5>
                                        </li>

                                        <li>
                                            <h5>Street Address :</h5>
                                            <h5>234 High St</h5>
                                        </li>

                                        <li>
                                            <h5>City / State :</h5>
                                            <h5>107 Veltri Drive</h5>
                                        </li>

                                        <li>
                                            <h5>Zip :</h5>
                                            <h5>B23 6SN</h5>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- User Dashboard Section End -->

<!-- Footer Section Start -->
<footer class="section-t-space">
    <div th:replace="FrontEnd/fragments/footer :: footer"></div>
</footer>
<!-- Footer Section End -->

<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->


<!-- Modal Add Blog -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addBlogLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addBlogLabel">Th√™m Blog m·ªõi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addBlogForm">
                    <div class="mb-3">
                        <label for="input-title" class="form-label">Ti√™u ƒë·ªÅ</label>
                        <input type="text" class="form-control" id="input-title" required>
                    </div>
                    <div class="mb-3">
                        <label for="input-content" class="form-label">N·ªôi dung</label>
                        <textarea class="form-control" id="input-content" rows="3" required></textarea>
                    </div>

                    <!--                    // tac gia se duoc lay session-->
                    <div class="mb-3">
                        <label for="input-author" class="form-label">T√°c gi·∫£</label>
                        <input type="text" class="form-control" id="input-author" required>
                    </div>

                    <div class="mb-3">
                        <label for="input-category" class="form-label">Danh m·ª•c</label>
                        <select class="form-control" id="input-category" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="input-status" class="form-label">Tr·∫°ng th√°i</label>
                        <select class="form-control" id="input-status" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="input-thumbnail" class="form-label">·∫¢nh Thumbnail</label>
                        <input type="file" class="form-control" id="input-thumbnail" accept="image/*"
                               onchange="previewImage(event)">
                        <img id="thumbnailPreview" style="max-width: 100%; margin-top: 10px; display: none;"
                             alt="Preview Image"/>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                <button type="button" class="btn btn-success" onclick="addBlogJS()">Th√™m</button>
            </div>
        </div>
    </div>
</div>


<!--model edit-->

<div class="modal fade" id="editBlogModal" tabindex="-1" aria-labelledby="editBlogLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBlogLabel">Ch·ªânh s·ª≠a Blog</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editBlogForm">
                    <!-- Gi·ªëng nh∆∞ form add, ch·ªâ ƒë·ªïi id c√°c input th√†nh edit-... -->
                    <div class="mb-3">
                        <label for="edit-title" class="form-label">Ti√™u ƒë·ªÅ</label>
                        <input type="text" class="form-control" id="edit-title" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-content" class="form-label">N·ªôi dung</label>
                        <textarea class="form-control" id="edit-content" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="edit-category" class="form-label">Danh m·ª•c</label>
                        <select class="form-control" id="edit-category" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="edit-status" class="form-label">Tr·∫°ng th√°i</label>
                        <select class="form-control" id="edit-status" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="edit-author" class="form-label">T√°c gi·∫£</label>
                        <input type="text" class="form-control" id="edit-author" required>
                    </div>
                    <div class="mb-3">
                        <label for="edit-thumbnail" class="form-label">·∫¢nh Thumbnail</label>
                        <input type="file" class="form-control" onchange="previewEditThumbnail(event)"
                               id="edit-thumbnail" accept="image/*">
                        <img id="edit-preview-thumbnail" style="max-width: 100px; margin-top: 5px;"/>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                <button type="button" class="btn btn-success" onclick="saveEditBlog()">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>
</div>


<!-- latest jquery-->
<script th:src="@{/Frontend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- jquery ui-->
<script th:src="@{/Frontend/assets/js/jquery-ui.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap-notify.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/popper.min.js}"></script>

<!-- feather icon js-->
<script th:src="@{/Frontend/assets/js/feather/feather.min.js}"></script>
<script th:src="@{/Frontend/assets/js/feather/feather-icon.js}"></script>

<!-- Lazyload Js -->
<script th:src="@{/Frontend/assets/js/lazysizes.min.js}"></script>

<!-- Slick js-->
<script th:src="@{/Frontend/assets/js/slick/slick.js}"></script>
<script th:src="@{/Frontend/assets/js/slick/slick-animation.min.js}"></script>
<script th:src="@{/Frontend/assets/js/slick/custom_slick.js}"></script>

<!-- WOW js -->
<script th:src="@{/Frontend/assets/js/wow.min.js}"></script>
<script th:src="@{/Frontend/assets/js/custom-wow.js}"></script>

<!-- script js -->
<script th:src="@{/Frontend/assets/js/script.js}"></script>

<!-- theme setting js -->
<script th:src="@{/Frontend/assets/js/theme-setting.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    const pageSize = 3;
    const CONTEXT_PATH = "/AgriculturalWarehouseManagementApplication";

    function loadBlogPage(page = 1) {
        axios.get(`${CONTEXT_PATH}/api/my-blog/page?page=${page}&size=${pageSize}`)
            .then(res => {
                console.log("API data:", res.data); // TH√äM LOG N√ÄY!
                // B·∫£o v·ªá code, n·∫øu kh√¥ng c√≥ blogs th√¨ tr·∫£ v·ªÅ m·∫£ng r·ªóng
                const data = res.data || {};
                renderBlogs(data.blogs, data.currentPage, pageSize);
                renderPagination(data.currentPage, data.totalPages);
            })
            .catch(err => {
                console.error('L·ªói l·∫•y d·ªØ li·ªáu:', err);
            });
    }

    function renderBlogs(blogs, currentPage, pageSize) {
        const tbody = document.getElementById("blogTableBody");
        tbody.innerHTML = "";
        blogs.forEach((blog, idx) => {
            const tr = document.createElement("tr");
            // N·∫øu d√πng DTO th√¨ blog.thumbnail l√† ƒë·ªß, n·∫øu v·∫´n l√† entity th√¨ blog.blogDetail.thumbnail
            const thumbnail = blog.thumbnail || (blog.blogDetail && blog.blogDetail.thumbnail) || "no-image.png";
            //   const imageSrc = `${CONTEXT_PATH}/Frontend/assets/images/blog/${thumbnail}`; // <-- S·ª≠a ·ªü ƒë√¢y
            const imageSrc = `${CONTEXT_PATH}/blog/${thumbnail}`; // ƒê∆∞·ªùng d·∫´n gi·ªëng Thymeleaf ƒë√£ d√πng
            const color = getStatusColor(blog.status);
            tr.innerHTML = `
            <td>${(currentPage - 1) * pageSize + idx + 1}</td>
            <td><img src="${imageSrc}" style="max-width:100px; max-height:60px;" alt=""></td>
            <td>${blog.content && blog.content.length > 40 ? blog.content.substring(0, 40) + '...' : blog.content || ''}</td>
            <td>${blog.title || ""}</td>
             <td> <b><i>${blog.author || ""}</i></b></td>
            <td><span style="font-weight:bold;color:${color}">${blog.status}</span></td>
            <td>${formatDate(blog.createdAt)}</td>
          <td>
                  <a href="javascript:void(0)" onclick="openEditBlogModal(${blog.blogID})"><i data-feather="edit"></i></a>
                   <a href="javascript:void(0)" onclick="deleteBlog(${blog.blogID})"><i data-feather="trash-2"></i></a>
            </td>
        `;
            tbody.appendChild(tr);
        });
        if (window.feather) feather.replace();
    }


    function renderPagination(currentPage, totalPages) {
        let html = '';

        // Hi·ªán PREVIOUS n·∫øu kh√¥ng ph·∫£i trang 1
        if (currentPage > 1) {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="gotoPage(${currentPage - 1});return false;">PREVIOUS</a></li>`;
        }

        // Lu√¥n hi·ªán trang 1
        html += `<li class="page-item${currentPage === 1 ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(1);return false;">1</a></li>`;

        // N·∫øu currentPage > 3, hi·ªán ...
        if (currentPage > 3) {
            html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }

        // Hi·ªán c√°c trang tr∆∞·ªõc/sau currentPage (n·∫øu c√≥)
        for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
            html += `<li class="page-item${i === currentPage ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(${i});return false;">${i}</a></li>`;
        }

        // N·∫øu currentPage < totalPages - 2, hi·ªán ...
        if (currentPage < totalPages - 2) {
            html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }

        // Lu√¥n hi·ªán trang cu·ªëi n·∫øu > 1
        if (totalPages > 1) {
            html += `<li class="page-item${currentPage === totalPages ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(${totalPages});return false;">${totalPages}</a></li>`;
        }

        // Hi·ªán NEXT n·∫øu kh√¥ng ph·∫£i trang cu·ªëi
        if (currentPage < totalPages) {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="gotoPage(${currentPage + 1});return false;">NEXT</a></li>`;
        }

        document.getElementById("pagination").innerHTML = html;
    }


    function gotoPage(page) {
        loadBlogPage(page);
    }

    function formatDate(dateStr) {
        if (!dateStr) return '';
        const d = new Date(dateStr);
        return d.toLocaleDateString('vi-VN');
    }

    function getStatusColor(status) {
        switch (status) {
            case 'ACTIVE':
                return '#198754';
            case 'INACTIVE':
                return '#6c757d';
            case 'DRAFT':
                return '#f39c12';
            case 'PENDING':
                return '#0dcaf0';
            case 'PUBLISHED':
                return '#20c997';
            case 'DELETED':
                return '#dc3545';
            default:
                return '#212529';
        }
    }

    // G·ªçi l·∫°i khi tab My Blog ƒë∆∞·ª£c click ho·∫∑c trang load v√†o tab ƒë√≥!
    document.addEventListener('DOMContentLoaded', function () {
        if (document.querySelector("#pills-product").classList.contains("show")) {
            loadBlogPage(1);
        }
        document.getElementById("pills-product-tab").addEventListener('click', function () {
            loadBlogPage(1);
        });
    }); // H·∫øt h√†m view blog user


    // ======================= LOAD CATEGORY & STATUS =======================
    function loadBlogCategories() {
        axios.get(`${CONTEXT_PATH}/api/my-blog/category`)
            .then(res => {
                console.log("Danh m·ª•c nh·∫≠n ƒë∆∞·ª£c:", res.data); // Debug
                const select = document.getElementById('input-category');
                select.innerHTML = '';
                res.data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.blogCategoryId}">${cat.categoryName}</option>`;
                });
            })
            .catch(err => {
                console.error("L·ªói load danh m·ª•c:", err);
            });
    }

    function loadBlogStatusList() {
        axios.get(`${CONTEXT_PATH}/api/my-blog/status-list`)
            .then(res => {
                const select = document.getElementById('input-status');
                select.innerHTML = '';
                res.data.forEach(st => {
                    select.innerHTML += `<option value="${st.name}">${st.name}</option>`;
                });
            })
            .catch(err => {
                console.error("L·ªói load status:", err);
            });
    }

    // Khi modal m·ªü ‚Üí load danh m·ª•c & tr·∫°ng th√°i
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("addProductModal");
        if (modal) {
            modal.addEventListener("show.bs.modal", function () {
                loadBlogCategories();
                loadBlogStatusList();
            });
        }
    });

    // ======================= TH√äM BLOG =======================
    function addBlogJS() {
        const title = document.getElementById('input-title').value;
        const content = document.getElementById('input-content').value;
        const author = document.getElementById('input-author').value; // L·∫•y gi√° tr·ªã t√°c gi·∫£
        const blogCategoryID = document.getElementById('input-category').value;
        const status = document.getElementById('input-status').value;
        const thumbnailFile = document.getElementById('input-thumbnail').files[0];
        const userID = "[[${session.accountId}]]"; // fix c·ª©ng ho·∫∑c l·∫•y t·ª´ session n·∫øu c√≥
        //  const author = "T√™n t√°c gi·∫£"; // sau n√†y l·∫•y t·ª´ user login
        // userID v√† author t·∫°m hardcode, sau l·∫•y t·ª´ session ho·∫∑c principal
        const authorName = author || "Ng∆∞·ªùi d√πng ·∫©n danh"; // N·∫øu ng∆∞·ªùi d√πng kh√¥ng nh·∫≠p th√¨ d√πng t√™n m·∫∑c ƒë·ªãnh

        if (!thumbnailFile) {
            alert("Vui l√≤ng ch·ªçn ·∫£nh thumbnail!");
            return;
        }

        const formData = new FormData();
        formData.append("file", thumbnailFile);

        // B∆∞·ªõc 1: Upload ·∫£nh thumbnail
        axios.post(`${CONTEXT_PATH}/api/my-blog/upload-thumbnail`, formData, {
            headers: {'Content-Type': 'multipart/form-data'}
        })
            .then(res => {
                const thumbnailName = res.data;

                // B∆∞·ªõc 2: G·ª≠i d·ªØ li·ªáu blog
                const blog = {
                    title,
                    content,
                    blogCategoryID: parseInt(blogCategoryID),
                    userID,
                    author,
                    status,
                    blogDetail: {
                        thumbnail: thumbnailName,
                        detailContent: "N·ªôi dung chi ti·∫øt m√¥ t·∫£ th√™m blog." // b·∫Øt bu·ªôc n·∫øu d√πng @NotBlank
                    }
                };

                return axios.post(`${CONTEXT_PATH}/api/my-blog/add_blog`, blog);
            })
            .then(res => {
                alert("üéâ Th√™m blog th√†nh c√¥ng!");
                loadBlogPage(1);
                $('#addProductModal').modal('hide');
                document.getElementById('addBlogForm').reset();
            })
            .catch(err => {
                console.error("Chi ti·∫øt l·ªói t·ª´ server:", err);
                if (err.response && err.response.data) {
                    alert("L·ªói khi th√™m blog: " + JSON.stringify(err.response.data));
                } else {
                    alert("L·ªói kh√¥ng x√°c ƒë·ªãnh khi th√™m blog!");
                }
            });
    }

    // H√†m ƒë·ªÉ preview ·∫£nh khi ng∆∞·ªùi d√πng ch·ªçn file
    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('thumbnailPreview');

        // Ki·ªÉm tra n·∫øu c√≥ file ƒë∆∞·ª£c ch·ªçn
        if (file) {
            const reader = new FileReader();  // T·∫°o ƒë·ªëi t∆∞·ª£ng FileReader ƒë·ªÉ ƒë·ªçc file

            // Khi file ƒë∆∞·ª£c ƒë·ªçc xong
            reader.onload = function () {
                preview.src = reader.result;  // ƒê·∫∑t ƒë∆∞·ªùng d·∫´n ·∫£nh ƒë√£ ƒë·ªçc v√†o src c·ªßa img
                preview.style.display = 'block';  // Hi·ªÉn th·ªã th·∫ª img
            };

            reader.readAsDataURL(file);  // ƒê·ªçc file d∆∞·ªõi d·∫°ng base64
        }
    }


    // Edit model
    let currentEditBlogId = null;

    function openEditBlogModal(blogID) {
        currentEditBlogId = blogID;
        // L·∫•y d·ªØ li·ªáu blog
        axios.get(`${CONTEXT_PATH}/api/my-blog/detail/${blogID}`)
            .then(res => {
                const blog = res.data;
                document.getElementById('edit-title').value = blog.title || '';
                document.getElementById('edit-content').value = blog.content || '';
                document.getElementById('edit-author').value = blog.author || '';

                // Hi·ªÉn th·ªã thumbnail hi·ªán t·∫°i
                const thumb = (blog.blogDetail && blog.blogDetail.thumbnail) || blog.thumbnail || 'no-image.png';
                document.getElementById('edit-preview-thumbnail').src = `${CONTEXT_PATH}/blog/${thumb}`;

                // Load category & status (ph·∫£i set selected sau khi render option)
                loadEditBlogCategories(blog.blogCategoryID || blog.blogCategoryId);
                loadEditBlogStatusList(blog.status);

                $('#editBlogModal').modal('show');
            })
            .catch(err => {
                alert("L·ªói load blog: " + JSON.stringify(err));
            });
    }

    // Load category v√† set selected
    function loadEditBlogCategories(selectedValue) {
        axios.get(`${CONTEXT_PATH}/api/my-blog/category`)
            .then(res => {
                const select = document.getElementById('edit-category');
                select.innerHTML = '';
                res.data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.blogCategoryId}">${cat.categoryName}</option>`;
                });
                if (selectedValue) select.value = selectedValue;
            });
    }

    // Load status v√† set selected
    function loadEditBlogStatusList(selectedValue) {
        axios.get(`${CONTEXT_PATH}/api/my-blog/status-list`)
            .then(res => {
                const select = document.getElementById('edit-status');
                select.innerHTML = '';
                res.data.forEach(st => {
                    select.innerHTML += `<option value="${st.name}">${st.name}</option>`;
                });
                if (selectedValue) select.value = selectedValue;
            });
    }

    function saveEditBlog() {
        const title = document.getElementById('edit-title').value;
        const content = document.getElementById('edit-content').value;
        const author = document.getElementById('edit-author').value;
        const blogCategoryID = document.getElementById('edit-category').value;
        const status = document.getElementById('edit-status').value;
        const thumbnailFile = document.getElementById('edit-thumbnail').files[0];

        // N·∫øu ch·ªçn ·∫£nh m·ªõi ‚Üí upload tr∆∞·ªõc, c√≤n kh√¥ng th√¨ gi·ªØ nguy√™n
        function doUpdate(thumbnailName) {
            const blog = {
                title,
                content,
                author,
                blogCategoryID: parseInt(blogCategoryID),
                status,
                blogDetail: {
                    thumbnail: thumbnailName // D√πng ·∫£nh m·ªõi n·∫øu upload, kh√¥ng th√¨ gi·ªØ ·∫£nh c≈©
                }
            };

            axios.put(`${CONTEXT_PATH}/api/my-blog/edit_blog/${currentEditBlogId}`, blog)
                .then(res => {
                    alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                    $('#editBlogModal').modal('hide');
                    loadBlogPage(1); // ho·∫∑c load l·∫°i page hi·ªán t·∫°i
                })
                .catch(err => {
                    alert("L·ªói c·∫≠p nh·∫≠t: " + JSON.stringify(err));
                });
        }

        // N·∫øu c√≥ file th√¨ upload
        if (thumbnailFile) {
            const formData = new FormData();
            formData.append("file", thumbnailFile);
            axios.post(`${CONTEXT_PATH}/api/my-blog/upload-thumbnail`, formData, {
                headers: {'Content-Type': 'multipart/form-data'}
            }).then(res => {
                doUpdate(res.data); // d√πng t√™n file m·ªõi
            }).catch(err => {
                alert("L·ªói upload ·∫£nh: " + JSON.stringify(err));
            });
        } else {
            // Kh√¥ng ch·ªçn file m·ªõi ‚Üí l·∫•y t√™n ·∫£nh c≈© t·ª´ preview src
            const imgSrc = document.getElementById('edit-preview-thumbnail').src;
            // L·∫•y t√™n file t·ª´ ƒë∆∞·ªùng d·∫´n
            let thumbnailName = imgSrc.split('/blog/')[1] || '';
            doUpdate(thumbnailName);
        }
    }

    function previewEditThumbnail(event) {
        const input = event.target;
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('edit-preview-thumbnail').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function deleteBlog(blogID) {
        if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° blog n√†y kh√¥ng?")) return;

        axios.delete(`${CONTEXT_PATH}/api/my-blog/delete_blog/${blogID}`)
            .then(res => {
                alert("üóëÔ∏è Blog ƒë√£ ƒë∆∞·ª£c xo√°!");
                loadBlogPage(1); // ho·∫∑c reload l·∫°i trang hi·ªán t·∫°i
            })
            .catch(err => {
                alert("L·ªói xo√° blog: " + (err.response?.data || "Kh√¥ng r√µ nguy√™n nh√¢n"));
            });
    }

    // dem
    function loadTotalBlogs() {
        axios.get(`${CONTEXT_PATH}/api/my-blog/total-blogs`)
            .then(res => {
                const totalBlogs = res.data;
                document.querySelector("#totalBlogsCount").textContent = totalBlogs;
            })
            .catch(err => {
                console.error("L·ªói khi l·∫•y t·ªïng s·ªë blog:", err);
            });
    }

    // G·ªçi h√†m loadTotalBlogs khi trang t·∫£i
    document.addEventListener('DOMContentLoaded', function () {
        loadTotalBlogs();
    });

</script>

</body>

</html>
