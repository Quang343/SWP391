<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="FrontEnd/fragments/head::head"></head>

<body>

<!-- Loader Start -->
<div class="fullpage-loader">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>
<!-- Loader End -->

<!-- Header Start -->
<header th:replace="FrontEnd/fragments/header::header"></header>
<!-- Header End -->

<!-- mobile fix menu start -->
<div class="mobile-menu d-md-none d-block mobile-cart">
    <ul>
        <li>
            <a href="index.html">
                <i class="iconly-Home icli"></i>
                <span>Home</span>
            </a>
        </li>

        <li class="mobile-category">
            <a href="javascript:void(0)">
                <i class="iconly-Category icli js-link"></i>
                <span>Category</span>
            </a>
        </li>

        <li>
            <a href="search.html" class="search-box">
                <i class="iconly-Search icli"></i>
                <span>Search</span>
            </a>
        </li>

        <li>
            <a href="wishlist.html" class="notifi-wishlist">
                <i class="iconly-Heart icli"></i>
                <span>My Wish</span>
            </a>
        </li>

        <li>
            <a href="cart.html">
                <i class="iconly-Bag-2 icli fly-cate"></i>
                <span>Cart</span>
            </a>
        </li>
    </ul>
</div>
<!-- mobile fix menu end -->

<!-- Breadcrumb Section Start -->
<section class="breadcrumb-section pt-0">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb-contain">
                    <h2>User Dashboard</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="home">
                                    <i class="fa-solid fa-house"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active">User Dashboard</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- User Dashboard Section Start -->
<section class="user-dashboard-section section-b-space">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-xxl-3 col-lg-4">
                <div class="dashboard-left-sidebar">
                    <div class="close-button d-flex d-lg-none">
                        <button class="close-sidebar">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    <div class="profile-box">
                        <div class="cover-image">
                            <img src="../assets/images/inner-page/cover-img.jpg" class="img-fluid blur-up lazyload"
                                 alt="">
                        </div>

                        <div class="profile-contain">
                            <div class="profile-image">
                                <div class="position-relative">
                                    <img src="../assets/images/vendor-page/logo.png"
                                         class="blur-up lazyload update_img" alt="">
                                </div>
                            </div>

                            <div class="profile-name">
                                <h3>Joshua D. Bass</h3>
                                <h6 class="text-content">joshuadbass@rhyta.com</h6>
                            </div>
                        </div>
                    </div>

                    <ul class="nav nav-pills user-nav-pills" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a href="#pills-tabContent" class="nav-link active" id="pills-dashboard-tab"
                               data-bs-toggle="pill" data-bs-target="#pills-dashboard" role="tab"><i
                                    data-feather="home"></i>
                                DashBoard</a>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-product-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-product" type="button" role="tab"><i
                                    data-feather="shopping-bag"></i>Products
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-product-detail-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-product-detail" type="button" role="tab"><i
                                    data-feather="shopping-bag"></i>Product Detail
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-order" type="button" role="tab"><i
                                    data-feather="shopping-bag"></i>Order
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-profile" type="button" role="tab"><i data-feather="user"></i>
                                Profile
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-out-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-out" type="button" role="tab"><i data-feather="log-out"></i>
                                Log Out
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-xxl-9 col-lg-8">
                <button class="btn left-dashboard-show btn-animation btn-md fw-bold d-block mb-4 d-lg-none">Show
                    Menu
                </button>
                <div class="dashboard-right-sidebar">

                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-dashboard" role="tabpanel">
                            <div class="dashboard-home">
                                <div class="title">
                                    <h2>My Dashboard</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="dashboard-user-name">
                                    <h6 class="text-content">Hello, <b class="text-title">Vicki E. Pope</b></h6>
                                    <p class="text-content">From your My Account Dashboard you have the ability to
                                        view a snapshot of your recent account activity and update your account
                                        information. Select a link below to view or edit information.</p>
                                </div>

                                <div class="total-box">
                                    <div class="row g-sm-4 g-3">
                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/order.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/order.svg" class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>Total Products</h5>
                                                    <h3>25</h3>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/pending.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/pending.svg" class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>Total Sales</h5>
                                                    <h3>12550</h3>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/wishlist.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/wishlist.svg"
                                                     class="blur-up lazyload" alt="">
                                                <div class="total-detail">
                                                    <h5>Order Pending</h5>
                                                    <h3>36</h3>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-4">
                                    <div class="col-xxl-6">
                                        <div class="dashboard-bg-box">
                                            <div id="chart"></div>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="dashboard-bg-box">
                                            <div id="sale"></div>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="table-responsive dashboard-bg-box">
                                            <div class="dashboard-title mb-4">
                                                <h3>Trending Products</h3>
                                            </div>

                                            <table class="table product-table">
                                                <thead>
                                                <tr>
                                                    <th scope="col">·∫¢nh</th>
                                                    <th scope="col">T√™n</th>
                                                    <th scope="col">Gi√°</th>
                                                    <th scope="col">Sales</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/1.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Fantasy Crunchy Choco Chip Cookies</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$25.69</h6>
                                                    </td>
                                                    <td>
                                                        <h6>152</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/2.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Peanut Butter Bite Premium Butter Cookies 600 g</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$35.36</h6>
                                                    </td>
                                                    <td>
                                                        <h6>34</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/3.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Yumitos Chilli Sprinkled Potato Chips 100 g</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$78.55</h6>
                                                    </td>
                                                    <td>
                                                        <h6>78</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/4.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>healthy Long Life Toned Milk 1 L</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$32.98</h6>
                                                    </td>
                                                    <td>
                                                        <h6>135</h6>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="order-tab dashboard-bg-box">
                                            <div class="dashboard-title mb-4">
                                                <h3>Recent Order</h3>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table order-table">
                                                    <thead>
                                                    <tr>
                                                        <th scope="col">Order ID</th>
                                                        <th scope="col">Product Name</th>
                                                        <th scope="col">Status</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td class="product-image">#254834</td>
                                                        <td>
                                                            <h6>Choco Chip Cookies</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#355678</td>
                                                        <td>
                                                            <h6>Premium Butter Cookies</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#647536</td>
                                                        <td>
                                                            <h6>Sprinkled Potato Chips</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#125689</td>
                                                        <td>
                                                            <h6>Milk 1 L</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#215487</td>
                                                        <td>
                                                            <h6>Raw Mutton Leg</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#365474</td>
                                                        <td>
                                                            <h6>Instant Coffee</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#368415</td>
                                                        <td>
                                                            <h6>Jowar Stick and Jowar Chips</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-product" role="tabpanel">
                            <div class="product-tab">
                                <div class="title"
                                     style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h2>T·∫•t C·∫£ S·∫£n Ph·∫©m</h2>

                                    </div>

                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">
                                        <button class="btn btn-success"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductModal"
                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">
                                            + Th√™m S·∫£n Ph·∫©m
                                        </button>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-start mb-2">
                                    <button id="btnResetSort" class="btn btn-outline-secondary btn-sm"
                                            title="T·∫£i l·∫°i b·∫£ng">
                                        üîÑ
                                    </button>
                                </div>

                                <div class="table-responsive dashboard-bg-box">
                                    <table class="table product-table">
                                        <thead>
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">·∫¢nh</th>
                                            <th>
                                                <div class="header-with-sort">
                                                    <span>T√™n </span>
                                                    <div class="sort-buttons">
                                                        <button class="btn-sort" data-key="name" data-order="asc"
                                                                title="A-Z">‚ñ≤
                                                        </button>
                                                        <button class="btn-sort" data-key="name" data-order="desc"
                                                                title="Z-A">‚ñº
                                                        </button>
                                                    </div>
                                                </div>
                                            </th>
                                            <th>
                                                <div class="header-with-sort">
                                                    <span>Danh m·ª•c</span>
                                                    <div class="sort-buttons">
                                                        <button class="btn-sort" data-key="category" data-order="asc"
                                                                title="A-Z">‚ñ≤
                                                        </button>
                                                        <button class="btn-sort" data-key="category" data-order="desc"
                                                                title="Z-A">‚ñº
                                                        </button>
                                                    </div>
                                                </div>
                                            </th>
                                            <th scope="col">M√¥ t·∫£</th>
                                            <th scope="col">Tr·∫°ng th√°i</th>
                                            <th scope="col">H√†nh ƒë·ªông</th>
                                        </tr>
                                        </thead>
                                        <tbody id="productTable">
                                        <!-- B·ªè th:each ƒëi -->
                                        <!-- JS s·∫Ω t·ª± add t·ª´ng <tr> v√†o tbody -->


                                        </tbody>
                                    </table>

                                    <nav class="custom-pagination">
                                        <ul class="pagination justify-content-center" id="paginationContainer">
                                            <!-- C√°c li s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi b·∫±ng JS -->
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-product-detail" role="tabpanel">
                            <div class="product-detail-tab">
                                <div class="title"
                                     style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h2>Chi Ti·∫øt S·∫£n Ph·∫©m</h2>

                                    </div>

                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">
                                        <button class="btn btn-primary"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductDetailModal"
                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">
                                            + Th√™m Chi Ti·∫øt
                                        </button>
                                    </div>
                                </div>

                                <select id="productFilter" class="form-select mb-3" style="width: 300px">
                                    <option value="">T·∫•t c·∫£ s·∫£n ph·∫©m</option>
                                </select>

                                <div class="table-responsive dashboard-bg-box" id="productDetailContainer">

                                    <table class="table product-detail-table">
                                        <thead>
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">T√™n s·∫£n ph·∫©m</th>
                                            <th scope="col">Chi ti·∫øt</th>
                                            <th scope="col">Gi√° (VNƒê)</th>
                                            <th scope="col">H·∫°n s·ª≠ d·ª•ng (th√°ng)</th>
                                            <th scope="col">Tr·∫°ng th√°i</th>
                                            <th scope="col">H√†nh ƒë·ªông</th>
                                        </tr>
                                        </thead>
                                        <tbody id="productDetailTable">
                                        </tbody>
                                    </table>

                                    <nav class="custom-pagination mt-3">
                                        <ul class="pagination justify-content-center" id="paginationProductDetail"></ul>
                                    </nav>
                                </div>

                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-order" role="tabpanel">
                            <div class="dashboard-order">
                                <div class="title">
                                    <h2>All Order</h2>
                                    <span class="title-leaf title-leaf-gray">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="order-tab dashboard-bg-box">
                                    <div class="table-responsive">
                                        <table class="table order-table">
                                            <thead>
                                            <tr>
                                                <th scope="col">Order ID</th>
                                                <th scope="col">Product Name</th>
                                                <th scope="col">Status</th>
                                                <th scope="col">Price</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td class="product-image">#254834</td>
                                                <td>
                                                    <h6>Fantasy Crunchy Choco Chip Cookies</h6>
                                                </td>
                                                <td>
                                                    <label class="success">Shipped</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#355678</td>
                                                <td>
                                                    <h6>Peanut Butter Bite Premium Butter Cookies 600 g</h6>
                                                </td>
                                                <td>
                                                    <label class="danger">Pending</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#647536</td>
                                                <td>
                                                    <h6>Yumitos Chilli Sprinkled Potato Chips 100 g</h6>
                                                </td>
                                                <td>
                                                    <label class="success">Shipped</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#125689</td>
                                                <td>
                                                    <h6>healthy Long Life Toned Milk 1 L</h6>
                                                </td>
                                                <td>
                                                    <label class="danger">Pending</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#215487</td>
                                                <td>
                                                    <h6>Raw Mutton Leg, Packaging 5 Kg</h6>
                                                </td>
                                                <td>
                                                    <label class="danger">Pending</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#365474</td>
                                                <td>
                                                    <h6>Cold Brew Coffee Instant Coffee 50 g</h6>
                                                </td>
                                                <td>
                                                    <label class="success">Shipped</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td class="product-image">#368415</td>
                                                <td>
                                                    <h6>SnackAmor Combo Pack of Jowar Stick and Jowar Chips</h6>
                                                </td>
                                                <td>
                                                    <label class="danger">Pending</label>
                                                </td>
                                                <td>
                                                    <h6>$25.69</h6>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <nav class="custom-pagination">
                                        <ul class="pagination justify-content-center">
                                            <li class="page-item disabled">
                                                <a class="page-link" href="javascript:void(0)" tabindex="-1">
                                                    <i class="fa-solid fa-angles-left"></i>
                                                </a>
                                            </li>
                                            <li class="page-item active">
                                                <a class="page-link" href="javascript:void(0)">1</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">2</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">3</a>
                                            </li>
                                            <li class="page-item">
                                                <a class="page-link" href="javascript:void(0)">
                                                    <i class="fa-solid fa-angles-right"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-profile" role="tabpanel">
                            <div class="dashboard-profile">
                                <div class="title">
                                    <h2>My Profile</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="profile-tab dashboard-bg-box">
                                    <div class="dashboard-title dashboard-flex">
                                        <h3>Profile Name</h3>
                                        <button class="btn btn-sm theme-bg-color text-white" data-bs-toggle="modal"
                                                data-bs-target="#edit-profile">Edit Profile
                                        </button>
                                    </div>

                                    <ul>
                                        <li>
                                            <h5>Company Name :</h5>
                                            <h5>Grocery Store</h5>
                                        </li>
                                        <li>
                                            <h5>Email Address :</h5>
                                            <h5>joshuadbass@rhyta.com</h5>
                                        </li>
                                        <li>
                                            <h5>Country / Region :</h5>
                                            <h5>107 Veltri Drive</h5>
                                        </li>

                                        <li>
                                            <h5>Year Established :</h5>
                                            <h5>2022</h5>
                                        </li>

                                        <li>
                                            <h5>Total Employees :</h5>
                                            <h5>154 - 360 People</h5>
                                        </li>
                                        <li>
                                            <h5>Category :</h5>
                                            <h5>Grocery</h5>
                                        </li>

                                        <li>
                                            <h5>Street Address :</h5>
                                            <h5>234 High St</h5>
                                        </li>

                                        <li>
                                            <h5>City / State :</h5>
                                            <h5>107 Veltri Drive</h5>
                                        </li>

                                        <li>
                                            <h5>Zip :</h5>
                                            <h5>B23 6SN</h5>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--CSS-->
    <style>
        .delete:hover {
            color: #dc3545 !important;
            transform: scale(1.1);
            transition: all 0.2s ease;
        }

        .product-info-card {
            border: 1px solid #dee2e6;
            background-color: #f8f9fa !important;
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .toast {
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
    </style>

</section>
<!-- User Dashboard Section End -->

<!-- Footer Section Start -->
<footer th:replace="FrontEnd/fragments/footer::footer"></footer>
<!-- Footer Section End -->

<!-- Deal Box Modal Start -->
<div class="modal fade theme-modal deal-modal" id="deal-box" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h5 class="modal-title w-100" id="deal_today">Deal Today</h5>
                    <p class="mt-1 text-content">Recommended deals for you.</p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="deal-offer-box">
                    <ul class="deal-offer-list">
                        <li class="list-1">
                            <div class="deal-offer-contain">
                                <a href="shop-left-sidebar.html" class="deal-image">
                                    <img src="../assets/images/vegetable/product/10.png" class="blur-up lazyload"
                                         alt="">
                                </a>

                                <a href="shop-left-sidebar.html" class="deal-contain">
                                    <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                    <h6>$52.57
                                        <del>57.62</del>
                                        <span>500 G</span></h6>
                                </a>
                            </div>
                        </li>

                        <li class="list-2">
                            <div class="deal-offer-contain">
                                <a href="shop-left-sidebar.html" class="deal-image">
                                    <img src="../assets/images/vegetable/product/11.png" class="blur-up lazyload"
                                         alt="">
                                </a>

                                <a href="shop-left-sidebar.html" class="deal-contain">
                                    <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                    <h6>$52.57
                                        <del>57.62</del>
                                        <span>500 G</span></h6>
                                </a>
                            </div>
                        </li>

                        <li class="list-3">
                            <div class="deal-offer-contain">
                                <a href="shop-left-sidebar.html" class="deal-image">
                                    <img src="../assets/images/vegetable/product/12.png" class="blur-up lazyload"
                                         alt="">
                                </a>

                                <a href="shop-left-sidebar.html" class="deal-contain">
                                    <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                    <h6>$52.57
                                        <del>57.62</del>
                                        <span>500 G</span></h6>
                                </a>
                            </div>
                        </li>

                        <li class="list-1">
                            <div class="deal-offer-contain">
                                <a href="shop-left-sidebar.html" class="deal-image">
                                    <img src="../assets/images/vegetable/product/13.png" class="blur-up lazyload"
                                         alt="">
                                </a>

                                <a href="shop-left-sidebar.html" class="deal-contain">
                                    <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                    <h6>$52.57
                                        <del>57.62</del>
                                        <span>500 G</span></h6>
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Deal Box Modal End -->

<!-- Tap to top and theme setting button start -->
<div class="theme-option">
    <div class="setting-box">
        <button class="btn setting-button">
            <i class="fa-solid fa-gear"></i>
        </button>

        <div class="theme-setting-2">
            <div class="theme-box">
                <ul>
                    <li>
                        <div class="setting-name">
                            <h4>Color</h4>
                        </div>
                        <div class="theme-setting-button color-picker">
                            <form class="form-control">
                                <label for="colorPick" class="form-label mb-0">Theme Color</label>
                                <input type="color" class="form-control form-control-color" id="colorPick"
                                       value="#0da487" title="Choose your color">
                            </form>
                        </div>
                    </li>

                    <li>
                        <div class="setting-name">
                            <h4>Dark</h4>
                        </div>
                        <div class="theme-setting-button">
                            <button class="btn btn-2 outline" id="darkButton">Dark</button>
                            <button class="btn btn-2 unline" id="lightButton">Light</button>
                        </div>
                    </li>

                    <li>
                        <div class="setting-name">
                            <h4>RTL</h4>
                        </div>
                        <div class="theme-setting-button rtl">
                            <button class="btn btn-2 rtl-unline">LTR</button>
                            <button class="btn btn-2 rtl-outline">RTL</button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="back-to-top">
        <a id="back-to-top" href="#">
            <i class="fas fa-chevron-up"></i>
        </a>
    </div>
</div>
<!-- Tap to top and theme setting button end -->

<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->

<!-- Add address modal box start -->
<div class="modal fade theme-modal" id="add-address" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add a new address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-4 theme-form-floating">
                        <input type="text" class="form-control" id="fname" placeholder="Enter First Name">
                        <label for="fname">First Name</label>
                    </div>
                </form>

                <form>
                    <div class="form-floating mb-4 theme-form-floating">
                        <input type="text" class="form-control" id="lname" placeholder="Enter Last Name">
                        <label for="lname">Last Name</label>
                    </div>
                </form>

                <form>
                    <div class="form-floating mb-4 theme-form-floating">
                        <input type="email" class="form-control" id="email" placeholder="Enter Email Address">
                        <label for="email">Email Address</label>
                    </div>
                </form>

                <form>
                    <div class="form-floating mb-4 theme-form-floating">
                            <textarea class="form-control" placeholder="Leave a comment here" id="address"
                                      style="height: 100px"></textarea>
                        <label for="address">Enter Address</label>
                    </div>
                </form>

                <form>
                    <div class="form-floating mb-4 theme-form-floating">
                        <input type="email" class="form-control" id="pin" placeholder="Enter Pin Code">
                        <label for="pin">Pin Code</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-md" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn theme-bg-color btn-md text-white" data-bs-dismiss="modal">Save
                    changes
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Add address modal box end -->

<!-- Location Modal Start -->
<div class="modal location-modal fade theme-modal" id="locationModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel1">Choose your Delivery Location</h5>
                <p class="mt-1 text-content">Enter your address and we will specify the offer for your area.</p>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="location-list">
                    <div class="search-input">
                        <input type="search" class="form-control" placeholder="Search Your Area">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </div>

                    <div class="disabled-box">
                        <h6>Select a Location</h6>
                    </div>

                    <ul class="location-select custom-height">
                        <li>
                            <a href="javascript:void(0)">
                                <h6>Alabama</h6>
                                <span>Min: $130</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Arizona</h6>
                                <span>Min: $150</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>California</h6>
                                <span>Min: $110</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Colorado</h6>
                                <span>Min: $140</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Florida</h6>
                                <span>Min: $160</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Georgia</h6>
                                <span>Min: $120</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Kansas</h6>
                                <span>Min: $170</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Minnesota</h6>
                                <span>Min: $120</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>New York</h6>
                                <span>Min: $110</span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript:void(0)">
                                <h6>Washington</h6>
                                <span>Min: $130</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Location Modal End -->

<!-- Edit Profile Start -->
<div class="modal fade theme-modal" id="editProfile" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel2">Edit Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-xxl-12">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="pname" value="Jack Jennas">
                                <label for="pname">Full Name</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-6">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="email" class="form-control" id="email1" value="vicki.pope@gmail.com">
                                <label for="email1">Email address</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-6">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input class="form-control" type="tel" value="4567891234" name="mobile" id="mobile"
                                       maxlength="10" oninput="javascript: if (this.value.length > this.maxLength) this.value =
                                            this.value.slice(0, this.maxLength);">
                                <label for="mobile">Email address</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-12">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="address1"
                                       value="8424 James Lane South San Francisco">
                                <label for="address1">Add Address</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-12">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="address2" value="CA 94080">
                                <label for="address2">Add Address 2</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-4">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <select class="form-select" id="floatingSelect1">
                                    <option selected>Choose Your Country</option>
                                    <option value="kingdom">United Kingdom</option>
                                    <option value="states">United States</option>
                                    <option value="fra">France</option>
                                    <option value="china">China</option>
                                    <option value="spain">Spain</option>
                                    <option value="italy">Italy</option>
                                    <option value="turkey">Turkey</option>
                                    <option value="germany">Germany</option>
                                    <option value="russian">Russian Federation</option>
                                    <option value="malay">Malaysia</option>
                                    <option value="mexico">Mexico</option>
                                    <option value="austria">Austria</option>
                                    <option value="hong">Hong Kong SAR, China</option>
                                    <option value="ukraine">Ukraine</option>
                                    <option value="thailand">Thailand</option>
                                    <option value="saudi">Saudi Arabia</option>
                                    <option value="canada">Canada</option>
                                    <option value="singa">Singapore</option>
                                </select>
                                <label for="floatingSelect">Country</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-4">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <select class="form-select" id="floatingSelect">
                                    <option selected>Choose Your City</option>
                                    <option value="kingdom">India</option>
                                    <option value="states">Canada</option>
                                    <option value="fra">Dubai</option>
                                    <option value="china">Los Angeles</option>
                                    <option value="spain">Thailand</option>
                                </select>
                                <label for="floatingSelect">City</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-4">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="address3" value="94080">
                                <label for="address3">Pin Code</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-animation btn-md fw-bold"
                        data-bs-dismiss="modal">Close
                </button>
                <button type="button" data-bs-dismiss="modal"
                        class="btn theme-bg-color btn-md fw-bold text-light">Save changes
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Edit Profile End -->

<!-- Edit Card Start -->
<div class="modal fade theme-modal" id="editCard" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel8">Edit Card</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-xxl-6">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="finame" value="Mark">
                                <label for="finame">First Name</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-6">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <input type="text" class="form-control" id="laname" value="Jecno">
                                <label for="laname">Last Name</label>
                            </div>
                        </form>
                    </div>

                    <div class="col-xxl-4">
                        <form>
                            <div class="form-floating theme-form-floating">
                                <select class="form-select" id="floatingSelect12">
                                    <option selected>Card Type</option>
                                    <option value="kingdom">Visa Card</option>
                                    <option value="states">MasterCard Card</option>
                                    <option value="fra">RuPay Card</option>
                                    <option value="china">Contactless Card</option>
                                    <option value="spain">Maestro Card</option>
                                </select>
                                <label for="floatingSelect12">Card Type</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-animation btn-md fw-bold"
                        data-bs-dismiss="modal">Cancel
                </button>
                <button type="button" class="btn theme-bg-color btn-md fw-bold text-light">Update Card</button>
            </div>
        </div>
    </div>
</div>
<!-- Edit Card End -->

<!-- Remove Profile Modal Start -->
<div class="modal fade theme-modal remove-profile" id="removeProfile" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header d-block text-center">
                <h5 class="modal-title w-100" id="exampleModalLabel22">Are You Sure ?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="remove-box">
                    <p>The permission for the use/group, preview is inherited from the object, object will create a
                        new permission for this object</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-animation btn-md fw-bold" data-bs-dismiss="modal">No</button>
                <button type="button" class="btn theme-bg-color btn-md fw-bold text-light"
                        data-bs-target="#removeAddress" data-bs-toggle="modal">Yes
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade theme-modal remove-profile" id="removeAddress" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center" id="exampleModalLabel12">Done!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="remove-box text-center">
                    <h4 class="text-content">It's Removed.</h4>
                </div>
            </div>
            <div class="modal-footer pt-0">
                <button type="button" class="btn theme-bg-color btn-md fw-bold text-light"
                        data-bs-dismiss="modal">Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Remove Pofiler Modal End -->

<!-- Edit Profile Modal Start -->
<div class="modal fade theme-modal" id="edit-profile" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel3">Edit Your Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="companyName" class="form-label">Company Name</label>
                        <input type="text" class="form-control" id="companyName" value="Grocery Store">
                    </div>
                    <div class="mb-3">
                        <label for="emailAddress" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="emailAddress" value="joshuadbass@rhyta.com">
                    </div>
                    <div class="mb-3">
                        <label for="country" class="form-label">Country / Region</label>
                        <input type="text" class="form-control" id="country" value="107 Veltri Drive">
                    </div>
                    <div class="mb-3">
                        <label for="established" class="form-label">Year Established</label>
                        <input type="email" class="form-control" id="established" value="2022">
                    </div>
                    <div class="mb-3">
                        <label for="employees" class="form-label">Total Employees</label>
                        <input type="text" class="form-control" id="employees" value="154 - 360 People">
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">Category</label>
                        <input type="email" class="form-control" id="category" value="Grocery">
                    </div>
                    <div class="mb-3">
                        <label for="street" class="form-label">Street Address</label>
                        <input type="text" class="form-control" id="street" value="234 High St">
                    </div>
                    <div class="mb-3">
                        <label for="city" class="form-label">City / State</label>
                        <input type="email" class="form-control" id="city" value="107 Veltri Drive">
                    </div>
                    <div class="mb-3">
                        <label for="zip" class="form-label">Zip</label>
                        <input type="text" class="form-control" id="zip" value="B23 6SN">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-animation btn-md fw-bold"
                        data-bs-dismiss="modal">Cancel
                </button>
                <button type="button" class="btn theme-bg-color btn-md fw-bold text-light"
                        data-bs-dismiss="modal">Save
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Edit Profile Modal End -->

<!--Th√™m th∆∞ vi·ªán-->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<!--Th√™m th∆∞ vi·ªán End-->

<!--Reset Tab Data-->
<script>

    let preventResetProductDetail = false; // üëà Flag ƒë·ªÉ ch·∫∑n reset t·∫°m th·ªùi

    function resetProductTab() {
        currentSort = {key: null, order: null};
        document.querySelectorAll(".btn-sort").forEach(btn => btn.classList.remove("active-sort"));
        loadProducts(1);
    }

    function resetProductDetailTab() {
        // Reset filter dropdown v·ªÅ "T·∫•t c·∫£ s·∫£n ph·∫©m"
        const filterSelect = document.getElementById("productFilter");
        if (filterSelect) {
            filterSelect.value = ""; // ch·ªçn "T·∫•t c·∫£ s·∫£n ph·∫©m"
        }

        // Reset c√°c bi·∫øn filter
        selectedProductId = null;
        selectedCategoryId = null;

        // Load l·∫°i t·∫•t c·∫£ chi ti·∫øt s·∫£n ph·∫©m
        loadProductDetails();

        // Reset d√≤ng hi·ªÉn th·ªã s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn n·∫øu c√≥
        const selectedNameDisplay = document.getElementById("selectedProductName");
        if (selectedNameDisplay) {
            selectedNameDisplay.innerText = "T·∫•t c·∫£ s·∫£n ph·∫©m";
        }
    }

    document.querySelectorAll('button[data-bs-toggle="pill"]').forEach(btn => {
        btn.addEventListener('shown.bs.tab', function (e) {
            const targetId = e.target.getAttribute('data-bs-target');

            switch (targetId) {
                case '#pills-product':
                    resetProductTab();
                    break;
                case '#pills-product-detail':
                    if (preventResetProductDetail) {
                        preventResetProductDetail = false; // üëà Reset l·∫°i flag sau khi show tab
                    } else {
                        resetProductDetailTab();
                    }
                    break;
                case '#pills-order':
                    resetOrderTab();
                    break;
            }
        });
    });

</script>
<!--Reset Tab Data End-->


<!--1. Tab Product-->
<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="addProductForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Th√™m S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="form-label-title col-sm-3 mb-0">T√™n</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" placeholder="T√™n s·∫£n ph·∫©m" id="productName"
                                   required>
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label form-label-title">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="categoryId" required>
                                <option value="" disabled selected>ƒêang t·∫£i danh m·ª•c...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">M√¥ t·∫£</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m ·ªü ƒë√¢y..."
                                      id="description" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row">
                        <label class="col-sm-3 col-form-label form-label-title">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select id="status" class="form-select" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>


                    <!-- Upload Images -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">H√¨nh ·∫£nh</label>
                        <div class="col-sm-9">
                            <div class="custom-upload-box">
                                <label for="productImages" class="upload-label">
                                    <i class="fa fa-upload me-2"></i>Ch·ªçn ·∫£nh (t·ªëi ƒëa 5)
                                </label>
                                <input type="file" id="productImages" class="form-control visually-hidden"
                                       accept="image/*" multiple>
                                <p class="text-muted mt-2 mb-0" id="fileUploadNote">Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.</p>
                                <div id="previewContainer" class="d-flex flex-wrap gap-2 mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button class="btn btn-success" type="submit" id="submitBtn">ƒê·ªìng √Ω</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Add Product Modal End-->

<!-- View Images Modal -->

<!-- Modal Xem & Qu·∫£n L√Ω ·∫¢nh -->
<div class="modal fade" id="viewImageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">·∫¢nh S·∫£n Ph·∫©m</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body text-center">
                <!-- Khu v·ª±c ·∫£nh -->
                <div id="imageContainer" class="d-flex flex-wrap gap-3 justify-content-center mb-3"></div>

                <!-- C·∫£nh b√°o -->
                <p class="text-muted">Ch·ªçn t·ªëi ƒëa 5 ·∫£nh.</p>

                <!-- N√∫t th√™m ·∫£nh -->
                <button class="btn btn-outline-danger mt-2" id="deleteAllBtn">üóë X√≥a t·∫•t c·∫£</button>

                <!-- File input ·∫©n -->
                <input type="file" id="imageUploader" accept="image/*" multiple hidden/>
            </div>
        </div>
    </div>
</div>

<!-- View Images Modal End -->

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editProductForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">Ch·ªânh S·ª≠a</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="form-label-title col-sm-3 mb-0">T√™n</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" placeholder="T√™n s·∫£n ph·∫©m" id="editProductName"
                                   required>
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label form-label-title">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="editCategoryId" required>
                                <option value="" disabled selected>ƒêang t·∫£i danh m·ª•c...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">M√¥ t·∫£</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m ·ªü ƒë√¢y..."
                                      id="editDescription" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row">
                        <label class="col-sm-3 col-form-label form-label-title">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select id="editStatus" class="form-select" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button class="btn btn-primary" type="submit" id="editSubmitBtn">C·∫≠p Nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Edit Product Modal End -->

<!--Logic Tab Product-->

<!--CSS-->
<style>

    #btnResetSort {
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
        color: #343a40;
        padding: 4px 10px;
        font-size: 14px;
        border-radius: 4px;
        transition: background-color 0.2s, color 0.2s;
    }

    #btnResetSort:hover {
        background-color: #e2e6ea;
        color: #212529;
        cursor: pointer;
        font-weight: 500;
    }

    .btn-sort.active-sort {
        color: #dc3545; /* ƒë·ªè nh·∫π */
        font-weight: bold;
        text-decoration: underline;
    }

    .header-with-sort {
        display: flex;
        align-items: center; /* CƒÉn gi·ªØa ngang */
        justify-content: center; /* CƒÉn gi·ªØa d·ªçc */
        text-align: center;
    }

    .sort-buttons {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .btn-sort {
        font-size: 10px;
        padding: 0;
        border: none;
        background: transparent;
        cursor: pointer;
        line-height: 1;
        color: #333;
    }

    .btn-sort:hover {
        color: #0d6efd;
        font-weight: bold;
    }

    .custom-pagination .page-item.disabled .page-link {
        color: #999 !important; /* m√†u ch·ªØ m·ªù */
        background-color: #f8f9fa; /* n·ªÅn nh·∫π */
        border-color: #dee2e6; /* vi·ªÅn m·ªù */
        pointer-events: none; /* kh√¥ng cho b·∫•m */
        cursor: not-allowed; /* hi·ªÉn th·ªã con tr·ªè ch√©o */
        opacity: 0.6; /* m·ªù t·ªïng th·ªÉ */
        transition: 0.3s;
    }

    .preview-image-box {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 6px;
        overflow: hidden;
        border: 1px solid #ccc;
    }

    .preview-image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
    }

    .preview-image-box button {
        position: absolute;
        top: 4px;
        right: 4px;
        background-color: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
    }

    .wrap-text {
        white-space: normal !important;
        word-wrap: break-word;
        word-break: break-word;
        max-width: 200px;
    }

    #productTable tbody {
        display: block;
        min-height: calc(5 * 48px);
    }

    #productTable thead,
    #productTable tbody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
    }

    #productTable {
        border-collapse: collapse;
        width: 100%;
    }

    #imageContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .image-box {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f8f8;
    }

    .image-box img {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
    }

    .image-box .delete-btn {
        position: absolute;
        top: 4px;
        right: 6px;
        background-color: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 14px;
        line-height: 18px;
        cursor: pointer;
        padding: 0;
    }

    .image-box.add-btn {
        font-size: 28px;
        font-weight: bold;
        color: #888;
        border: 2px dashed #ced4da;
        cursor: pointer;
    }

    #deleteAllBtn {
        font-weight: bold;
        color: red;
    }

    .custom-upload-box {
        border: 2px dashed #ced4da;
        border-radius: 8px;
        padding: 16px;
        text-align: center;
        background-color: #f9f9f9;
        transition: background-color 0.3s ease;
    }

    .custom-upload-box:hover {
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .upload-label {
        cursor: pointer;
        font-weight: 500;
        color: #0d6efd;
        font-size: 16px;
        display: inline-block;
    }

    .upload-label i {
        font-size: 18px;
    }

    .image-wrapper {
        position: relative;
        display: inline-block;
        margin: 10px;
    }

    .image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }


    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }

</style>

<!--Upload file Add Modal-->
<script>

    let selectedFiles = [];

    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("productImages");
        const note = document.getElementById("fileUploadNote");
        const previewContainer = document.getElementById("previewContainer");
        const modalEl = document.getElementById("addProductModal");


        // üßπ Khi modal ƒë√≥ng ‚Üí reset
        modalEl.addEventListener("hidden.bs.modal", () => {
            selectedFiles = [];
            // input.value = "";
            previewContainer.innerHTML = "";
            note.textContent = "Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.";
        });

        input.addEventListener("change", function () {
            const newFiles = Array.from(this.files);
            if (newFiles.length === 0) return;

            const totalFiles = selectedFiles.length + newFiles.length;

            if (totalFiles > 5) {
                alert(`B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 5 ·∫£nh. Hi·ªán t·∫°i ƒë√£ c√≥ ${selectedFiles.length} ·∫£nh.`);
                this.value = "";
                return;
            }

            // üëâ Th√™m file m·ªõi v√†o danh s√°ch c≈©
            selectedFiles = selectedFiles.concat(newFiles);
            renderPreviews();
            this.value = ""; // reset input ƒë·ªÉ l·∫ßn sau onchange ho·∫°t ƒë·ªông l·∫°i
        });

        function renderPreviews() {
            previewContainer.innerHTML = "";
            note.textContent = selectedFiles.length > 0
                ? `ƒê√£ ch·ªçn ${selectedFiles.length} t·ªáp.`
                : "Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.";

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();

                reader.onload = function (e) {
                    const box = document.createElement("div");
                    box.className = "preview-image-box";

                    const img = document.createElement("img");
                    img.src = e.target.result;

                    const delBtn = document.createElement("button");
                    delBtn.innerHTML = "√ó";
                    delBtn.title = "Xo√° ·∫£nh n√†y";

                    delBtn.onclick = () => {
                        selectedFiles.splice(index, 1);
                        renderPreviews();
                    };

                    box.appendChild(img);
                    box.appendChild(delBtn);
                    previewContainer.appendChild(box);
                };

                reader.readAsDataURL(file);
            });
        }

        // üß† (G·ª£i √Ω): N·∫øu b·∫°n d√πng `selectedFiles` ƒë·ªÉ submit ‚Üí c·∫ßn s·ª≠a ph·∫ßn upload ·∫£nh l·∫°i ƒë·ªÉ d√πng selectedFiles
    });
</script>

<!--CRUD-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadCategories();
        loadStatuses();
        loadProducts();
        setupProductSortButtons();
        setupAddFormSubmit();
        setupEditFormSubmit();
    });

    function loadCategories() {
        const selects = [document.getElementById('categoryId'), document.getElementById('editCategoryId')];

        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/categories')
            .then(res => {
                const categories = res.data;

                selects.forEach(select => {
                    select.innerHTML = '<option value="" disabled selected>Ch·ªçn danh m·ª•c...</option>';
                    categories.forEach(cat => {
                        const option = document.createElement("option");
                        option.value = cat.id;
                        option.textContent = cat.name;
                        select.appendChild(option);
                    });
                });
            })
            .catch(err => {
                console.error("L·ªói khi load categories:", err);
            });
    }

    function loadStatuses() {
        const selects = [document.getElementById('status'), document.getElementById('editStatus')];
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/statuses')
            .then(res => {
                selects.forEach(select => {
                    select.innerHTML = '<option value="" disabled selected>Ch·ªçn tr·∫°ng th√°i...</option>';
                    res.data.forEach(status => {
                        const text = status.replace(/_/g, ' ');
                        const option = new Option(text, status);
                        select.add(option);
                    });
                });
            });
    }

    function loadProducts(page = 1) {
        currentPage = page;

        const requiredItems = page * pageSize;

        // N·∫øu ch∆∞a ƒë·ªß d·ªØ li·ªáu ‚Üí g·ªçi l·∫°i API ƒë·ªÉ l·∫•y th√™m
        if (!allProducts || allProducts.length < requiredItems) {
            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    allProducts = res.data;
                    renderPageFromData(allProducts, page);
                });
        } else {
            renderPageFromData(allProducts, page);
        }
    }

    function renderPageFromData(data, page) {
        totalPages = Math.ceil(data.length / pageSize);
        const pageItems = data.slice((page - 1) * pageSize, page * pageSize);

        const tbody = document.getElementById("productTable");
        tbody.innerHTML = "";
        pageItems.forEach((product, i) => {
            const stt = (page - 1) * pageSize + i + 1;
            appendProductToTable(product, stt);
        });

        renderPaginationTemplate(data.length, page);
        addActionListeners();
        addViewImageListeners();
    }

    let currentSort = {key: null, order: null};

    function setupProductSortButtons() {
        document.querySelectorAll(".btn-sort").forEach(btn => {
            btn.addEventListener("click", () => {
                const key = btn.dataset.key;
                const order = btn.dataset.order;

                currentSort = {key, order};

                // Xo√° active ·ªü t·∫•t c·∫£ c√°c n√∫t
                document.querySelectorAll(".btn-sort").forEach(b => b.classList.remove("active-sort"));

                // G√°n active cho n√∫t v·ª´a click
                btn.classList.add("active-sort");

                renderSortedProducts();
            });
        });
    }

    function renderSortedProducts(page = 1) {
        currentPage = page; // üëà th√™m d√≤ng n√†y

        let sorted = [...allProducts];

        if (currentSort.key && currentSort.order) {
            sorted.sort((a, b) => {
                const valA = currentSort.key === "category"
                    ? (a.category?.name || "")
                    : (a.name || "");
                const valB = currentSort.key === "category"
                    ? (b.category?.name || "")
                    : (b.name || "");

                return currentSort.order === "asc"
                    ? valA.localeCompare(valB, 'vi', {sensitivity: 'base'})
                    : valB.localeCompare(valA, 'vi', {sensitivity: 'base'});
            });
        }

        const pageItems = sorted.slice((currentPage - 1) * pageSize, currentPage * pageSize);

        const tbody = document.getElementById("productTable");
        tbody.innerHTML = "";

        pageItems.forEach((product, i) => {
            const stt = (currentPage - 1) * pageSize + i + 1;
            appendProductToTable(product, stt);
        });

        addActionListeners();
        addViewImageListeners();
        renderPaginationTemplate(sorted.length, currentPage); // ‚úÖ v·∫´n ƒë√∫ng
    }

    function appendProductToTable(product, index) {
        const tbody = document.getElementById("productTable");
        const row = document.createElement('tr');
        row.setAttribute('data-id', product.id);

        // ƒê·ªãnh nghƒ©a m√†u theo status
        let statusColor = "black";
        switch (product.status) {
            case "ACTIVE":
                statusColor = "green";
                break;
            case "INACTIVE":
                statusColor = "red";
                break;
            case "OUT_OF_STOCK":
                statusColor = "orange";
                break;
        }

        row.innerHTML = `
        <td>${index}</td>
        <td class="text-center align-middle">
          <button type="button" class="btn btn-sm btn-outline-info btn-view-images" title="Qu·∫£n l√Ω ·∫£nh" data-id="${product.id}">
              <i class="ri-image-line"></i>
            </button>
        </td>
        <td class="wrap-text">${product.name}</td>
        <td>${product.category?.name || 'Unknown'}</td>
        <td class="wrap-text">${product.description || ''}</td>
        <td><span style="color: ${statusColor}; font-weight: bold;">${product.status.replace(/_/g, ' ')}</span></td>
        <td class="text-center align-middle">
            <ul class="option-list d-flex justify-content-center gap-2 list-unstyled m-0">
                <li><button type="button" class="btn btn-sm btn-outline-info btn-view" title="Chi ti·∫øt s·∫£n ph·∫©m" data-id="${product.id}"><i class="ri-eye-line"></i></button></li>
                <li><button class="btn btn-sm btn-outline-primary btn-edit" title="Ch·ªânh s·ª≠a" data-id="${product.id}"><i class="ri-pencil-line"></i></button></li>
                <li>
                    <button class="btn btn-sm btn-outline-danger btn-delete"
                        title="${product.status === 'INACTIVE' ? 'S·∫£n ph·∫©m ƒë√£ ng·ª´ng kinh doanh' : 'X√≥a'}"
                        data-id="${product.id}"
                        ${product.status === 'INACTIVE' ? 'disabled' : ''}>
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </li>
            </ul>
        </td>
    `;

        tbody.appendChild(row);
        setupProductViewButtons();
    }

    document.getElementById("btnResetSort").addEventListener("click", function () {
        currentSort = {key: null, order: null};
        document.querySelectorAll(".btn-sort").forEach(btn => btn.classList.remove("active-sort"));
        loadProducts(1); // üëà v·ªÅ trang 1
    });

    function addActionListeners() {
        document.querySelectorAll(".btn-edit").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = this.dataset.id;
                axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                    .then(res => {
                        const product = res.data.find(p => p.id == id);
                        if (product) {
                            document.getElementById('editProductName').value = product.name;
                            document.getElementById('editDescription').value = product.description || '';
                            document.getElementById('editCategoryId').value = product.category.id;
                            document.getElementById('editStatus').value = product.status;

                            document.getElementById('editProductForm').setAttribute("data-edit-id", id);
                            const modal = new bootstrap.Modal(document.getElementById('editProductModal'));
                            modal.show();
                        }
                    });
            });
        });

        document.querySelectorAll(".btn-delete").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = this.dataset.id;
                axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                    .then(res => {
                        const product = res.data.find(p => p.id == id);

                        if (!product || product.status === "INACTIVE") {
                            alert("S·∫£n ph·∫©m n√†y ƒë√£ ng·ª´ng kinh doanh");
                            return;
                        }
                        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ng·ª´ng kinh doanh s·∫£n ph·∫©m n√†y kh√¥ng?")) {
                            axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/products/${id}`, {status: "INACTIVE"})
                                .then(() => {
                                    alert("ƒê√£ chuy·ªÉn s·∫£n ph·∫©m sang tr·∫°ng th√°i INACTIVE.");

                                    // ‚úÖ C·∫≠p nh·∫≠t ngay trong m·∫£ng allProducts
                                    const index = allProducts.findIndex(p => p.id == id);
                                    if (index !== -1) {
                                        allProducts[index].status = "INACTIVE";
                                    }

                                    // ‚úÖ Render l·∫°i danh s√°ch ƒë√∫ng theo tr·∫°ng th√°i m·ªõi
                                    if (currentSort.key) {
                                        renderSortedProducts();
                                    } else {
                                        renderPageFromData(allProducts, currentPage);
                                    }
                                })
                        }
                    });
            });
        });
    }


    function setupAddFormSubmit() {
        const form = document.getElementById('addProductForm');
        const btn = document.getElementById('submitBtn');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";

            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('description').value.trim();
            const categoryId = document.getElementById('categoryId').value;
            const status = document.getElementById('status').value;

            // Ki·ªÉm tra tr√πng t√™n
            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    const isDuplicate = res.data.some(p => p.name.toLowerCase() === name.toLowerCase());
                    if (isDuplicate) {
                        alert("T√™n s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i.");
                        btn.disabled = false;
                        btn.innerText = "Th√™m S·∫£n Ph·∫©m";
                        return;
                    }

                    // T·∫°o s·∫£n ph·∫©m
                    const data = {name, description, categoryId, status};
                    axios.post('/AgriculturalWarehouseManagementApplication/api/seller/products', data)
                        .then(response => {
                            const productId = response.data.id;
                            if (!productId) {
                                alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c productId sau khi t·∫°o.");
                                return;
                            }

                            // üëâ B·∫Øt ƒë·∫ßu upload ·∫£nh
                            const files = selectedFiles.slice(0, 5); // ‚úÖ s·ª≠a d√≤ng n√†y ƒë·ªÉ d√πng ƒë√∫ng file ƒë√£ ch·ªçn
                            const uploads = [];

                            for (const file of files) {
                                const formData = new FormData();
                                formData.append("file", file);
                                uploads.push(
                                    axios.post(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/upload-image`, formData)
                                );
                            }

                            Promise.all(uploads)
                                .then(() => {
                                    alert("S·∫£n ph·∫©m & ·∫£nh ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng.");
                                    bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                                    form.reset();
                                    axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                                        .then(res => {
                                            const totalItems = res.data.length;
                                            const lastPage = Math.ceil(totalItems / pageSize);
                                            loadProducts(lastPage); // ‚úÖ ƒê·∫øn trang cu·ªëi
                                        });
                                    // üëâ N·∫øu mu·ªën qu·∫£n l√Ω ·∫£nh ti·∫øp, c√≥ th·ªÉ m·ªü modal View lu√¥n:
                                    // openImageModal(productId);
                                })
                                .finally(() => {
                                    btn.disabled = false;
                                    btn.innerText = "Th√™m S·∫£n Ph·∫©m";
                                });
                        })
                        .catch(err => {
                            alert("Th√™m s·∫£n ph·∫©m th·∫•t b·∫°i.");
                            console.error(err);
                            btn.disabled = false;
                            btn.innerText = "Th√™m S·∫£n Ph·∫©m";
                        });
                });
        });
    }

    function setupEditFormSubmit() {
        const form = document.getElementById('editProductForm');
        const btn = document.getElementById('editSubmitBtn');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";

            const id = this.getAttribute("data-edit-id");
            const name = document.getElementById('editProductName').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const categoryId = document.getElementById('editCategoryId').value;
            const status = document.getElementById('editStatus').value;

            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    const isDuplicate = res.data.some(p => p.name.toLowerCase() === name.toLowerCase() && p.id != id);
                    if (isDuplicate) {
                        alert("T√™n s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i.");
                        btn.disabled = false;
                        btn.innerText = "C√¢p Nh·∫≠t";
                        return;
                    }
                    const data = {name, description, categoryId, status};
                    axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/products/${id}`, data)
                    axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/products/${id}`, data)
                        .then(() => {
                            alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                            bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();

                            // üëâ C·∫≠p nh·∫≠t trong m·∫£ng allProducts
                            const index = allProducts.findIndex(p => p.id == id);
                            if (index !== -1) {
                                allProducts[index] = {
                                    ...allProducts[index],
                                    name,
                                    description,
                                    category: {
                                        id: categoryId,
                                        name: document.querySelector(`#editCategoryId option[value="${categoryId}"]`)?.innerText || ""
                                    },
                                    status
                                };
                            }

                            // üëâ Render l·∫°i trang hi·ªán t·∫°i (kh√¥ng g·ªçi l·∫°i API)
                            if (currentSort.key) {
                                renderSortedProducts();
                            } else {
                                renderPageFromData(allProducts, currentPage);
                            }
                        })
                        .catch(err => {
                            alert("L·ªói khi c·∫≠p nh·∫≠t s·∫£n ph·∫©m: " + (err.response?.data?.message || "Kh√¥ng r√µ l·ªói"));
                        })
                        .finally(() => {
                            btn.disabled = false;
                            btn.innerText = "C·∫≠p Nh·∫≠t";
                        });
                });
        });
    }

    function addViewImageListeners() {

        document.querySelectorAll(".btn-view-images").forEach(btn => {
            btn.addEventListener("click", function () {
                const productId = this.dataset.id;
                const imageContainer = document.getElementById("imageContainer");
                const fileInput = document.getElementById("imageUploader");
                const deleteAllBtn = document.getElementById("deleteAllBtn");

                imageContainer.innerHTML = "";
                deleteAllBtn.onclick = () => {
                    axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/${productId}/images`)
                        .then(res => {
                            const images = res.data;
                            if (images.length === 0) {
                                alert("Kh√¥ng c√≥ ·∫£nh n√†o ƒë·ªÉ xo√°.");
                                return;
                            }

                            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° t·∫•t c·∫£ ·∫£nh c·ªßa s·∫£n ph·∫©m n√†y kh√¥ng?")) {
                                const deletePromises = images.map(img =>
                                    axios.delete(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/images/${img.id}`)
                                );

                                Promise.all(deletePromises)
                                    .then(() => {
                                        imageContainer.innerHTML = "";
                                        renderAddSlots(imageContainer, fileInput);
                                        alert("ƒê√£ xo√° t·∫•t c·∫£ ·∫£nh.");
                                    })
                                    .catch(err => alert("Xo√° ·∫£nh l·ªói"));
                            }
                        });
                };

                axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/${productId}/images`)
                    .then(res => {
                        const images = res.data;
                        let imageCount = images.length;

                        // üëâ render t·ª´ng ·∫£nh hi·ªán c√≥
                        images.forEach(img => {
                            const box = createImageBox(img.imageUrl, img.id, productId);
                            imageContainer.appendChild(box);
                        });

                        renderAddSlots(imageContainer, fileInput);

                        fileInput.onchange = () => {
                            const files = Array.from(fileInput.files);
                            if (files.length === 0) return;

                            const currentImages = imageContainer.querySelectorAll(".image-box:not(.add-btn)").length;
                            const availableSlots = 5 - currentImages;

                            // üëâ C·∫£nh b√°o n·∫øu ng∆∞·ªùi d√πng ch·ªçn qu√° s·ªë slot tr·ªëng
                            if (files.length > availableSlots) {
                                alert(`Ch·ªâ c√≥ th·ªÉ t·∫£i t·ªëi ƒëa ${availableSlots} ·∫£nh n·ªØa.`);
                                return;
                            }

                            const filesToUpload = files.slice(0, availableSlots); // ‚úÖ Gi·ªõi h·∫°n s·ªë ·∫£nh upload

                            let uploadCount = 0;

                            filesToUpload.forEach(file => {
                                const formData = new FormData();
                                formData.append("file", file);
                                console.log("üëâ ƒêang upload ·∫£nh t·ªõi:", `/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/upload-image`);

                                axios.post(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/upload-image`, formData)
                                    .then(res => {
                                        const imageId = res.data.id;
                                        const imageUrl = res.data.imageUrl;
                                        const newBox = createImageBox(imageUrl, imageId, productId);
                                        const addBtn = imageContainer.querySelector(".add-btn");

                                        if (addBtn) {
                                            imageContainer.replaceChild(newBox, addBtn);
                                        } else {
                                            imageContainer.appendChild(newBox);
                                        }

                                        renderAddSlots(imageContainer, fileInput); // render l·∫°i slot "+"
                                    })
                                    .catch(err => {
                                        alert("T·∫£i ·∫£nh th·∫•t b·∫°i");
                                        console.error(err);
                                    });
                            });

                            fileInput.value = ""; // ‚úÖ Reset input sau khi upload
                        };

                        new bootstrap.Modal(document.getElementById('viewImageModal')).show();
                    });
            });
        });

        // ‚úÖ t·∫°o √¥ hi·ªÉn th·ªã ·∫£nh t·ª´ server
        function createImageBox(imageUrl, imageId, productId) {
            const wrapper = document.createElement("div");
            wrapper.className = "image-wrapper text-center";

            const box = document.createElement("div");
            box.className = "image-box";

            const image = document.createElement("img");
            image.src = "/AgriculturalWarehouseManagementApplication/seller/" + imageUrl;
            image.alt = "Product Image";

            box.appendChild(image);

            // T·∫°o h·ªôp ch·ª©a n√∫t ƒëi·ªÅu khi·ªÉn (x√≥a + zoom)
            const controlBox = document.createElement("div");
            controlBox.className = "image-controls mt-2 d-flex justify-content-center gap-2";

            // ‚ùå N√∫t x√≥a (icon X)
            const delBtn = document.createElement("button");
            delBtn.className = "btn btn-sm btn-outline-danger";
            delBtn.innerHTML = "<i class='bi bi-x-lg'></i>"; // Bootstrap icon X
            delBtn.title = "Delete Image";

            delBtn.addEventListener("click", () => {
                axios.delete(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/images/${imageId}`)
                    .then(() => {
                        const box = delBtn.closest(".image-box");
                        const wrapper = delBtn.closest(".image-wrapper");

                        if (wrapper.classList.contains("from-slot")) {
                            box.innerHTML = "+";
                            box.className = "image-box add-btn";
                            box.onclick = () => document.getElementById("imageUploader").click();

                            wrapper.classList.remove("from-slot");
                            wrapper.innerHTML = "";
                            wrapper.appendChild(box);
                        } else {
                            wrapper.remove();
                        }

                        renderAddSlots(document.getElementById("imageContainer"), document.getElementById("imageUploader"));
                    })
                    .catch(err => alert("Xo√° ·∫£nh l·ªói"));
            });

            // üîç N√∫t zoom (ph√≥ng ·∫£nh to)
            const zoomBtn = document.createElement("button");
            zoomBtn.className = "btn btn-sm btn-outline-primary";
            zoomBtn.innerHTML = "<i class='bi bi-zoom-in'></i>"; // Bootstrap icon zoom
            zoomBtn.title = "Zoom Image";

            zoomBtn.addEventListener("click", () => {
                const zoomWindow = window.open(image.src, "_blank");
                zoomWindow.focus();
            });

            // G·∫Øn n√∫t v√†o controlBox
            controlBox.appendChild(zoomBtn);
            controlBox.appendChild(delBtn);

            // Th√™m v√†o wrapper
            wrapper.appendChild(box);
            wrapper.appendChild(controlBox);

            return wrapper;
        }

        // ‚úÖ render slot "+"
        function renderAddSlots(container, fileInput) {
            // ‚ùå Xo√° t·∫•t c·∫£ slot "+" c≈© n·∫øu c√≤n
            container.querySelectorAll(".add-btn").forEach(btn => btn.remove());

            const currentImageCount = container.querySelectorAll(".image-box:not(.add-btn)").length;
            const availableSlots = 5 - currentImageCount;

            for (let i = 0; i < availableSlots; i++) {
                const plusBox = document.createElement("div");
                plusBox.className = "image-box add-btn";
                plusBox.innerText = "+";
                plusBox.addEventListener("click", () => fileInput.click());
                container.appendChild(plusBox);
            }
        }


    }


</script>

<!--Filter theo view detail-->
<script>
    function setupProductViewButtons() {
        const viewButtons = document.querySelectorAll('.btn-view');
        viewButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const productId = this.dataset.id;

                // üëâ 1. Chuy·ªÉn tab sang "Product Detail"
                const detailTab = new bootstrap.Tab(document.getElementById('pills-product-detail-tab'));
                detailTab.show();

                // üëâ 2. Set dropdown filter b√™n Product Detail
                const filterDropdown = document.getElementById('productFilter');
                filterDropdown.value = productId;

                // üëâ 3. G·ªçi h√†m load Product Detail theo productId
                loadProductDetails(productId);

                // üëâ 4. Scroll xu·ªëng b·∫£ng chi ti·∫øt (n·∫øu mu·ªën)
                setTimeout(() => {
                    document.getElementById('pills-product-detail').scrollIntoView({behavior: 'smooth'});
                }, 300);
            });
        });
    }

    document.addEventListener("click", function (e) {
        const viewBtn = e.target.closest(".btn-view");
        if (viewBtn) {
            const productId = viewBtn.dataset.id;

            preventResetProductDetail = true; // üëà B·∫≠t c·ªù

            const detailTab = new bootstrap.Tab(document.getElementById('pills-product-detail-tab'));
            detailTab.show();

            document.getElementById('productFilter').value = productId;
            selectedProductId = productId;
            loadProductDetails(productId);

            setTimeout(() => {
                document.getElementById('pills-product-detail').scrollIntoView({behavior: 'smooth'});
            }, 300);
        }
    });

</script>

<!--Ph√¢n trang Product-->
<script>
    let currentPage = 1;
    const pageSize = 5;
    let allProducts = [];

    function renderPaginationTemplate(totalItems, currentPage) {
        const totalPages = Math.ceil(totalItems / pageSize);
        const paginationUl = document.querySelector(".custom-pagination ul");
        paginationUl.innerHTML = "";

        if (totalPages <= 1) return;

        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = startPage + maxVisiblePages - 1;

        if (endPage > totalPages) {
            endPage = totalPages;
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        function goToPage(page) {
            currentPage = page;
            if (currentSort.key) {
                renderSortedProducts(page);
            } else {
                loadProducts(page);
            }
        }

        // <<< V·ªÅ ƒë·∫ßu
        const firstLi = document.createElement("li");
        firstLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        firstLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="V·ªÅ trang ƒë·∫ßu"><i class="fa-solid fa-angles-left"></i></a>`;
        if (currentPage !== 1) {
            firstLi.onclick = () => {
                if (currentSort.key && currentSort.order) {
                    renderSortedProducts(1);
                } else {
                    loadProducts(1);
                }
            };
        }
        paginationUl.appendChild(firstLi);

        // << Trang tr∆∞·ªõc
        const prevLi = document.createElement("li");
        prevLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        prevLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="Trang tr∆∞·ªõc"><i class="fa-solid fa-angle-left"></i></a>`;
        if (currentPage !== 1) prevLi.onclick = () => goToPage(currentPage - 1);
        paginationUl.appendChild(prevLi);

        // ... ƒë·∫ßu n·∫øu c·∫ßn
        if (startPage > 1) {
            const dots = document.createElement("li");
            dots.className = "page-item disabled";
            dots.innerHTML = `<span class="page-link">...</span>`;
            paginationUl.appendChild(dots);
        }

        // C√°c trang gi·ªØa
        for (let i = startPage; i <= endPage; i++) {
            const li = document.createElement("li");
            li.className = "page-item" + (i === currentPage ? " active" : "");
            li.innerHTML = `<a class="page-link" href="javascript:void(0)">${i}</a>`;
            li.onclick = () => {
                if (currentSort.key && currentSort.order) {
                    renderSortedProducts(i); // üëâ d√πng sort
                } else {
                    loadProducts(i);        // üëâ m·∫∑c ƒë·ªãnh
                }
            };
            paginationUl.appendChild(li);
        }

        // ... cu·ªëi n·∫øu c·∫ßn
        if (endPage < totalPages) {
            const dots = document.createElement("li");
            dots.className = "page-item disabled";
            dots.innerHTML = `<span class="page-link">...</span>`;
            paginationUl.appendChild(dots);
        }

        // >> Trang sau
        const nextLi = document.createElement("li");
        nextLi.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        nextLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="Trang ti·∫øp theo"><i class="fa-solid fa-angle-right"></i></a>`;
        if (currentPage !== totalPages) nextLi.onclick = () => goToPage(currentPage + 1);
        paginationUl.appendChild(nextLi);

        // >>> T·ªõi cu·ªëi
        const lastLi = document.createElement("li");
        lastLi.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        lastLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="T·ªõi trang cu·ªëi"><i class="fa-solid fa-angles-right"></i></a>`;
        if (currentPage !== totalPages) lastLi.onclick = () => goToPage(totalPages);
        paginationUl.appendChild(lastLi);
    }
</script>

<!--Logic Tab Product End-->
<!--Tab Product End-->

<!--2. Tab Product Detail-->
<!--Modal Add Product Detail-->
<div class="modal fade" id="addProductDetailModal" tabindex="-1" aria-labelledby="addProductDetailModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="addProductDetailForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductDetailModalLabel">Th√™m Chi Ti·∫øt S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">T√™n</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="productId" required>
                                <option value="" disabled selected>Ch·ªçn s·∫£n ph·∫©m...</option>
                                <!-- S·∫Ω ƒë∆∞·ª£c JS load -->
                            </select>
                        </div>
                    </div>

                    <!-- Category (readonly) -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="categoryName" readonly>
                            <input type="hidden" id="categoryIdHidden"> <!-- d√πng cho JS -->
                        </div>
                    </div>

                    <!-- Radio ch·ªçn ch·∫ø ƒë·ªô -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Ch·ªçn ch·∫ø ƒë·ªô kh·ªëi l∆∞·ª£ng</label><br/>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="weightMode" id="availableWeightOption"
                                   checked/>
                            <label class="form-check-label" for="availableWeightOption">Kh·ªëi l∆∞·ª£ng c√≥ s·∫µn c·ªßa danh
                                m·ª•c</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="weightMode" id="customWeightOption"/>
                            <label class="form-check-label" for="customWeightOption">T√πy ch·ªânh kh·ªëi l∆∞·ª£ng / ƒë∆°n
                                v·ªã</label>
                        </div>
                    </div>

                    <!-- Available -->
                    <div id="availableWeightSection" class="mb-3">
                        <label class="form-label fw-bold">Kh·ªëi l∆∞·ª£ng c√≥ s·∫µn c·ªßa danh m·ª•c</label>
                        <div id="weightUnitSelectContainer" class="d-flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Custom -->
                    <div id="customWeightSection" class="mb-3" style="display: none;">
                        <label class="form-label fw-bold">T√πy ch·ªânh kh·ªëi l∆∞·ª£ng / ƒë∆°n v·ªã</label>
                        <div class="d-flex align-items-center flex-wrap gap-2">
                            <input type="number" step="0.01" id="weight" class="form-control"
                                   placeholder="Nh·∫≠p kh·ªëi l∆∞·ª£ng..." style="max-width: 150px;"/>

                            <div id="unitButtonGroup" class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary" data-unit="g">g</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="kg">kg</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="ml">ml</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="l">l</button>
                            </div>

                            <input type="hidden" id="unit"/>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Gi√° (VNƒê)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="price" min="0" required>
                        </div>
                    </div>

                    <!-- Expiry -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">H·∫°n s·ª≠ d·ª•ng (th√°ng)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="expiry" min="1" required>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="productDetailStatus" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-success">ƒê·ªìng √Ω</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--Modal Add Product Detail End-->

<!--Modal Edit Product Detail-->
<div class="modal fade" id="editProductDetailModal" tabindex="-1" aria-labelledby="editProductDetailModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editProductDetailForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductDetailModalLabel">Ch·ªânh S·ª≠a Chi Ti·∫øt S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">T√™n s·∫£n ph·∫©m</label>
                        <div class="col-sm-9">
                            <input type="text" id="editProductNameInDetail" class="form-control" readonly>
                        </div>
                    </div>

                    <!-- Weight + Unit -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Chi ti·∫øt</label>
                        <div class="col-sm-4">
                            <input type="number" step="0.01" id="editWeight" class="form-control"
                                   placeholder="Kh·ªëi l∆∞·ª£ng (vd: 150)">
                        </div>
                        <div class="col-sm-5">
                            <select id="editUnit" class="form-select">
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="ml">ml</option>
                                <option value="l">l</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 text-muted small fst-italic text-end me-3">
                        Vui l√≤ng kh√¥ng nh·∫≠p tr√πng v·ªõi nh·ªØng chi ti·∫øt c√≥ s·∫µn c·ªßa s·∫£n ph·∫©m n√†y.
                    </div>

                    <!-- Price -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Gi√° (VNƒê)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="editPrice" min="0" required>
                        </div>
                    </div>

                    <!-- Expiry -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">H·∫°n s·ª≠ d·ª•ng (th√°ng)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="editExpiry" min="1" required>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="editStatusInDetail" required>
                                <option value="">ƒêang t·∫£i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-success">C·∫≠p Nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--Modal Edit Product Detail End-->

<!--CSS-->
<style>
    .product-detail-table {
        width: 100%;
        border-collapse: collapse;
        background-color: #fff;
    }

    .product-detail-table thead th {
        font-weight: 600;
        padding: 12px 10px;
        color: #333;
        text-align: center;
        border-bottom: 1px solid #eee !important; /* ‚úÖ CH·ªàNH L·∫†I ƒê·ªò ƒê·∫¨M */
    }

    .product-detail-table tbody td {
        border-bottom: 1px solid #eee;
        padding: 12px 10px;
        vertical-align: middle;
        color: #444;
    }

    .product-detail-table tbody tr:hover {
        background-color: #f9f9f9;
    }

    .product-detail-table tbody td {
        text-align: center;
    }

    /* D√πng chung cho c·∫£ unit buttons v√† available weight buttons */
    .btn.weight-unit-btn,
    #unitButtonGroup .btn {
        padding: 4px 10px;
        font-size: 0.85rem;
        min-width: 50px;
        height: 32px;
        border: 2px solid #000000;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
        background-color: white;
        color: #000000;
    }

    .btn.weight-unit-btn:hover,
    #unitButtonGroup .btn:hover {
        background-color: #000000;
        color: #fff;
    }

    .btn.weight-unit-btn.active,
    #unitButtonGroup .btn.active,
    #unitButtonGroup .btn.btn-primary {
        background-color: #000000;
        color: white;
        border-color: #000000;
    }
</style>

<!--CRUD-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadProductDropdown();
        loadProductDetailStatuses();
        loadProductFilterOptions();      // üëà Th√™m d√≤ng n√†y
        setupProductFilter();            // üëà Th√™m d√≤ng n√†y
        setupProductDropdownChange();
        setupAddProductDetailForm();
        setupUnitButtons();
        setupWeightModeToggle();

        loadProductDetails(); // Load b·∫£ng ban ƒë·∫ßu
    });


    let selectedProductId = null;
    let selectedCategoryId = null;

    const modal = document.getElementById('addProductDetailModal');
    modal.addEventListener('hidden.bs.modal', function () {
        const form = document.getElementById("addProductDetailForm");
        form.reset();

        document.getElementById("productId").value = "";
        document.getElementById("categoryName").value = "";
        document.getElementById("unit").value = "";
        document.getElementById("productDetailStatus").value = "";
        document.getElementById("weightUnitSelectContainer").innerHTML = "";
        const detailNameInput = document.getElementById("detailName");
        if (detailNameInput) detailNameInput.value = "";

        document.querySelectorAll('#unitButtonGroup button[data-unit]').forEach(btn => {
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-outline-secondary');
        });

        document.querySelectorAll('.weight-unit-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById("availableWeightOption").checked = true;
        document.getElementById("customWeightOption").checked = false;
        document.getElementById("availableWeightSection").style.display = "block";
        document.getElementById("customWeightSection").style.display = "none";

        selectedProductId = null;
        selectedCategoryId = null;
    });

    function loadProductDropdown() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
            .then(res => {
                const select = document.getElementById('productId');
                select.innerHTML = '<option value="" disabled selected>Ch·ªçn s·∫£n ph·∫©m...</option>';
                res.data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    select.appendChild(option);
                });
            });
    }

    function loadProductDetailStatuses() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/statuses')
            .then(res => {
                const select = document.getElementById('productDetailStatus');
                select.innerHTML = '<option value="" disabled selected>Ch·ªçn tr·∫°ng th√°i...</option>';
                res.data.forEach(status => {
                    const text = status.replace(/_/g, ' ');
                    const option = new Option(text, status);
                    select.add(option);
                });
            });
    }

    function setupAvailableWeightSelection() {
        const buttons = document.querySelectorAll(".weight-unit-btn");
        buttons.forEach(btn => {
            btn.addEventListener("click", function () {
                buttons.forEach(b => b.classList.remove("active"));
                this.classList.add("active");
            });
        });
    }

    function setupProductDropdownChange() {
        document.getElementById("productId").addEventListener("change", function () {
            const productId = this.value;
            selectedProductId = productId;

            axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/products/${productId}`)
                .then(res => {
                    const product = res.data;
                    const category = product.category;
                    selectedCategoryId = category.id;
                    document.getElementById("categoryName").value = category.name;

                    axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/category-weights/${selectedCategoryId}`)
                        .then(weightRes => {
                            const list = weightRes.data;
                            const container = document.getElementById("weightUnitSelectContainer");
                            container.innerHTML = "";

                            list.forEach(item => {
                                const button = document.createElement("button");
                                button.type = "button";
                                button.className = "btn weight-unit-btn";
                                button.textContent = `${item.weight} ${item.unit}`;
                                button.dataset.weight = item.weight;
                                button.dataset.unit = item.unit;
                                container.appendChild(button);
                            });
                            setupAvailableWeightSelection();
                        });

                    loadProductDetails(productId); // Load b·∫£ng theo s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn
                });
        });
    }

    function setupUnitButtons() {
        const unitButtons = document.querySelectorAll('#unitButtonGroup button[data-unit]');
        const unitInput = document.getElementById("unit");

        unitButtons.forEach(btn => {
            btn.addEventListener("click", function () {
                unitInput.value = this.dataset.unit;
                unitButtons.forEach(b => b.classList.remove("btn-primary", "btn-outline-secondary"));
                unitButtons.forEach(b => b.classList.add("btn-outline-secondary"));
                this.classList.remove("btn-outline-secondary");
                this.classList.add("btn-primary");
            });
        });
    }

    function setupAddProductDetailForm() {
        const form = document.getElementById("addProductDetailForm");
        const btn = form.querySelector("button[type='submit']");

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";
            let weight = null;
            let unit = null;

            const isAvailableMode = document.getElementById("availableWeightOption").checked;

            if (isAvailableMode) {
                const selectedBtn = document.querySelector("#weightUnitSelectContainer .weight-unit-btn.active");
                if (!selectedBtn) {
                    alert("Vui l√≤ng ch·ªçn Available Weight!");
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                    return;
                }
                weight = parseFloat(selectedBtn.dataset.weight);
                unit = selectedBtn.dataset.unit;
            } else {
                weight = parseFloat(document.getElementById("weight").value);
                unit = document.getElementById("unit").value.trim();
            }

            const dto = {
                productId: selectedProductId,
                weight: weight,
                unit: unit,
                price: parseFloat(document.getElementById("price").value),
                expiry: parseInt(document.getElementById("expiry").value),
                status: document.getElementById("productDetailStatus").value
            };

            axios.post('/AgriculturalWarehouseManagementApplication/api/seller/product-details', dto)
                .then(() => {
                    alert("Th√™m Product Detail th√†nh c√¥ng.");
                    bootstrap.Modal.getInstance(document.getElementById('addProductDetailModal')).hide();

                    form.reset();
                    document.getElementById("productId").value = "";
                    document.getElementById("categoryName").value = "";
                    document.getElementById("unit").value = "";
                    document.getElementById("productDetailStatus").value = "";
                    document.getElementById("weightUnitSelectContainer").innerHTML = "";
                    const detailNameInput = document.getElementById("detailName");
                    if (detailNameInput) detailNameInput.value = "";

                    document.querySelectorAll('#unitButtonGroup button[data-unit]').forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-outline-secondary');
                    });

                    selectedProductId = null;
                    selectedCategoryId = null;

                    // üëá T·∫£i l·∫°i to√†n b·ªô ƒë·ªÉ t√≠nh trang cu·ªëi
                    axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/all-dto')
                        .then(res => {
                            const totalItems = res.data.length;
                            const lastPage = Math.ceil(totalItems / pageSizeDetail);
                            loadProductDetails(null, lastPage);
                        });
                })
                .catch(err => {
                    if (err.response?.data?.message) {
                        alert("L·ªói khi th√™m Product Detail: " + err.response.data.message);
                    } else {
                        alert("L·ªói khi th√™m Product Detail.");
                        console.error(err);
                    }
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                });
        });
    }

    function setupWeightModeToggle() {
        const availableRadio = document.getElementById("availableWeightOption");
        const customRadio = document.getElementById("customWeightOption");
        const availableSection = document.getElementById("availableWeightSection");
        const customSection = document.getElementById("customWeightSection");

        document.querySelectorAll('input[name="weightMode"]').forEach(radio => {
            radio.addEventListener("change", () => {
                if (availableRadio.checked) {
                    availableSection.style.display = "block";
                    customSection.style.display = "none";
                } else {
                    availableSection.style.display = "none";
                    customSection.style.display = "block";
                }
            });
        });
    }

    function loadProductDetails(productId = null, page = 1) {
        currentPageDetail = page;

        const url = productId
            ? `/AgriculturalWarehouseManagementApplication/api/seller/product-details/product-dto/${productId}`
            : `/AgriculturalWarehouseManagementApplication/api/seller/product-details/all-dto`;

        axios.get(url)
            .then(res => {
                allProductDetails = res.data;

                const start = (page - 1) * pageSizeDetail;
                const end = start + pageSizeDetail;
                const paginated = allProductDetails.slice(start, end);

                const tbody = document.getElementById("productDetailTable");
                tbody.innerHTML = "";

                paginated.forEach((item, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${start + index + 1}</td>
                    <td>${item.productName}</td>
                    <td>${item.detailName}</td>
                    <td>${item.price}</td>
                    <td>${item.expiry}</td>
                    <td>${item.status}</td>
                    <td class="text-center align-middle">
                        <ul class="option-list d-flex justify-content-center gap-2 list-unstyled m-0">
                            <li>
                                <button class="btn btn-sm btn-outline-primary btn-edit-detail" title="Edit" data-id="${item.id}">
                                    <i class="ri-pencil-line"></i>
                                </button>
                            </li>
                            <li>
                                <button class="btn btn-sm btn-outline-danger btn-delete"
                                    title="${item.status === 'INACTIVE' ? 'Chi ti·∫øt s·∫£n ph·∫©m ƒë√£ ng·ª´ng kinh doanh' : 'Soft Delete'}"
                                    data-id="${item.id}"
                                    ${item.status === 'INACTIVE' ? 'disabled' : ''}>
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </li>
                        </ul>
                    </td>
                `;
                    tbody.appendChild(row);
                });

                renderPaginationProductDetail(allProductDetails.length, page, (newPage) => {
                    loadProductDetails(productId, newPage);
                });

                setupProductDetailActions?.();
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi load product details:", err);
            });
    }

    // Set m·∫∑c ƒë·ªãnh cho radio
    document.getElementById("availableWeightOption").checked = true;
    document.getElementById("customWeightOption").checked = false;
    document.getElementById("availableWeightSection").style.display = "block";
    document.getElementById("customWeightSection").style.display = "none";

    function loadProductFilterOptions() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
            .then(res => {
                const filterSelect = document.getElementById('productFilter');
                filterSelect.innerHTML = '<option value="">T·∫•t c·∫£ s·∫£n ph·∫©m</option>';
                res.data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    filterSelect.appendChild(option);
                });
            });
    }

    function setupProductFilter() {
        const filterSelect = document.getElementById("productFilter");
        filterSelect.addEventListener("change", function () {
            const productId = this.value;
            if (productId) {
                loadProductDetails(productId); // Load theo s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn
            } else {
                loadProductDetails(); // Load t·∫•t c·∫£
            }
        });
    }

    document.addEventListener("click", function (e) {
        const editBtn = e.target.closest(".btn-edit-detail");
        if (editBtn) {
            const id = editBtn.dataset.id;
            openEditProductDetailModal(id);
        }
    });

    function openEditProductDetailModal(id) {
        // Load danh s√°ch tr·∫°ng th√°i tr∆∞·ªõc khi hi·ªÉn th·ªã modal
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/statuses')
            .then(res => {
                const select = document.getElementById('editStatusInDetail');
                select.innerHTML = '<option value="">Ch·ªçn tr·∫°ng th√°i...</option>';
                res.data.forEach(status => {
                    const text = status.replace(/_/g, ' ');
                    const option = new Option(text, status);
                    select.add(option);
                });

                // Sau khi load xong tr·∫°ng th√°i, m·ªõi ti·∫øp t·ª•c load chi ti·∫øt
                return axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/${id}`);
            })
            .then(res => {
                const detail = res.data;
                document.getElementById("editProductNameInDetail").value = detail.productName;

                document.getElementById("editWeight").value = detail.weight;
                document.getElementById("editUnit").value = detail.unit;

                document.getElementById("editPrice").value = detail.price;
                document.getElementById("editExpiry").value = detail.expiry;
                document.getElementById("editStatusInDetail").value = detail.status;

                document.getElementById("editProductDetailForm").dataset.id = id;

                const modal = new bootstrap.Modal(document.getElementById("editProductDetailModal"));
                modal.show();
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi m·ªü modal edit:", err);
                alert("Kh√¥ng th·ªÉ hi·ªÉn th·ªã chi ti·∫øt s·∫£n ph·∫©m.");
            });
    }

    document.getElementById("editProductDetailForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const id = this.dataset.id;
        const dto = {
            weight: parseFloat(document.getElementById("editWeight").value),
            unit: document.getElementById("editUnit").value,
            price: parseFloat(document.getElementById("editPrice").value),
            expiry: parseInt(document.getElementById("editExpiry").value),
            status: document.getElementById("editStatusInDetail").value
        };

        axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/${id}`, dto)
            .then(() => {
                alert("C·∫≠p nh·∫≠t th√†nh c√¥ng.");
                bootstrap.Modal.getInstance(document.getElementById("editProductDetailModal")).hide();
                loadProductDetails(null, currentPageDetail); // load l·∫°i ƒë√∫ng trang ƒëang ƒë·ª©ng
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t:", err);
                alert("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t chi ti·∫øt.");
            });
    });


</script>

<!--Ph√¢n trang Product Detail-->
<script>
    let allProductDetails = [];
    let currentPageDetail = 1;
    const pageSizeDetail = 5;

    function renderPaginationProductDetail(totalItems, currentPage, callback) {
        const totalPages = Math.ceil(totalItems / pageSizeDetail);
        const paginationUl = document.getElementById("paginationProductDetail");
        paginationUl.innerHTML = "";

        if (totalPages <= 1) return;

        function createLi(page, label, isActive = false, isDisabled = false, title = "") {
            const li = document.createElement("li");
            li.className = `page-item${isActive ? " active" : ""}${isDisabled ? " disabled" : ""}`;
            li.innerHTML = `<a class="page-link" href="#" title="${title}">${label}</a>`;
            if (!isActive && !isDisabled) {
                li.querySelector("a").addEventListener("click", (e) => {
                    e.preventDefault();
                    callback(page);
                });
            }
            return li;
        }

        paginationUl.appendChild(createLi(1, '<i class="fa-solid fa-angles-left"></i>', false, currentPage === 1, "V·ªÅ trang ƒë·∫ßu"));
        paginationUl.appendChild(createLi(currentPage - 1, '<i class="fa-solid fa-angle-left"></i>', false, currentPage === 1, "Trang tr∆∞·ªõc"));

        const maxVisible = 5;
        let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let end = start + maxVisible - 1;
        if (end > totalPages) {
            end = totalPages;
            start = Math.max(1, end - maxVisible + 1);
        }

        for (let i = start; i <= end; i++) {
            paginationUl.appendChild(createLi(i, i, i === currentPage));
        }

        paginationUl.appendChild(createLi(currentPage + 1, '<i class="fa-solid fa-angle-right"></i>', false, currentPage === totalPages, "Trang sau"));
        paginationUl.appendChild(createLi(totalPages, '<i class="fa-solid fa-angles-right"></i>', false, currentPage === totalPages, "T·ªõi trang cu·ªëi"));
    }

</script>

<!--Tab Product Detail End-->


<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->

<!-- latest jquery-->
<script th:src="@{/Frontend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- jquery ui-->
<script th:src="@{/Frontend/assets/js/jquery-ui.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap-notify.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/popper.min.js}"></script>

<!-- feather icon js-->
<script th:src="@{/Frontend/assets/js/feather/feather.min.js}"></script>
<script th:src="@{/Frontend/assets/js/feather/feather-icon.js}"></script>

<!-- Lazyload Js -->
<script th:src="@{/Frontend/assets/js/lazysizes.min.js}"></script>

<!-- Slick js-->
<script th:src="@{/Frontend/assets/js/slick/slick.js}"></script>
<script th:src="@{/Frontend/assets/js/slick/custom_slick.js}"></script>

<!-- Apexcharts Js -->
<script th:src="@{/Frontend/assets/js/apexchart.js}"></script>
<script th:src="@{/Frontend/assets/js/custom-chart.js}"></script>

<!-- Nav & tab upside js -->
<script th:src="@{/Frontend/assets/js/nav-tab.js}"></script>

<!-- script js -->
<script th:src="@{/Frontend/assets/js/script.js}"></script>

<!-- theme setting js -->
<script th:src="@{/Frontend/assets/js/theme-setting.js}"></script>
</body>

</html>