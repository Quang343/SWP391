<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="FrontEnd/fragments/head::head"></head>

<!--    shipper.html-->

<style>

    /* M√†u n·ªÅn c·ªßa c√°c trang ƒë√£ ch·ªçn */
    ul.custom-pagination li.page-item.active > a.page-link,
    ul.custom-pagination li.page-item.active > span.page-link {
        background-color: #19a877 !important; /* M√†u xanh b·∫°n mu·ªën */
        color: #fff !important;
        border: none !important;
    }

    /* M√†u cho c√°c n√∫t ph√¢n trang ch∆∞a ch·ªçn */
    ul.custom-pagination .page-item.active {
        color: #198754 !important; /* M√†u ch·ªØ xanh ƒë·∫≠m */
        border-radius: 6px !important;
        min-width: 38px;
        text-align: center;
        box-shadow: none !important;
    }

    /* M√†u khi hover l√™n n√∫t ph√¢n trang */
    ul.custom-pagination .page-link:hover {
        background-color: #e5f6ee !important; /* M√†u n·ªÅn s√°ng khi hover */
        color: #198754 !important;
    }

    /* Th√™m s·ª± ∆∞u ti√™n cho ph√¢n trang khi ch·ªçn */
    .pagination .page-item.active .page-link {
        background-color: #19a877 !important; /* M√†u xanh Fastkart */
        border-color: #19a877 !important;
        color: #fff !important;
        font-weight: 600;
        border-radius: 10px;
    }

    #searchRecommendations {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    #searchRecommendations li {
        cursor: pointer;
        padding: 8px 10px;
    }

    #searchRecommendations li:hover {
        background-color: #e5f6ee;
    }

    #statusFilter {
        background: #f8f9fa;
        border: 1.5px solid #19a877;
        color: #19a877;
        font-weight: 600;
        border-radius: 8px;
        padding: 5px 16px 5px 8px;
        transition: border-color 0.2s, box-shadow 0.2s;
        outline: none;
        box-shadow: 0 2px 6px rgba(25,168,119,0.05);
        min-width: 140px;
    }

    #statusFilter:focus {
        border-color: #157347;
        box-shadow: 0 0 0 0.16rem rgba(25,168,119,.25);
        background: #e5f6ee;
    }

    #statusFilter option {
        font-weight: 500;
        color: #198754;
    }


</style>

<body>

<!-- Loader Start -->
<div class="fullpage-loader">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>
<!-- Loader End -->

<!-- Header Start -->
<!--<head th:replace="FrontEnd/fragments/header::header"></head>-->
<!-- Header End -->

<!-- mobile fix menu start -->
<div class="mobile-menu d-md-none d-block mobile-cart">
    <ul>
        <li class="active">
            <a href="index.html">
                <i class="iconly-Home icli"></i>
                <span>Home</span>
            </a>
        </li>

        <li class="mobile-category">
            <a href="javascript:void(0)">
                <i class="iconly-Category icli js-link"></i>
                <span>Category</span>
            </a>
        </li>

        <li>
            <a href="search.html" class="search-box">
                <i class="iconly-Search icli"></i>
                <span>Search</span>
            </a>
        </li>


        <li>
            <a href="cart.html">
                <i class="iconly-Bag-2 icli fly-cate"></i>
                <span>Cart</span>
            </a>
        </li>
    </ul>
</div>
<!-- mobile fix menu end -->

<!-- Breadcrumb Section Start -->
<section class="breadcrumb-section pt-0">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb-contain">
                    <h2>Qu·∫£n l√Ω V·∫≠n chuy·ªÉn</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="home">
                                    <i class="fa-solid fa-house"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active">Qu·∫£n l√Ω V·∫≠n chuy·ªÉn</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- User Dashboard Section Start -->
<section class="user-dashboard-section section-b-space">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-xxl-3 col-lg-4">
                <div class="dashboard-left-sidebar">
                    <div class="close-button d-flex d-lg-none">
                        <button class="close-sidebar">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    <div class="profile-box">
                        <div class="cover-image position-relative">
                            <img id="coverImage"
                                 src="/AgriculturalWarehouseManagementApplication/Backend/assets/images/user/default-cover.jpg"
                                 class="img-fluid blur-up lazyload" alt="Avatar">

                            <!-- N√∫t ch·ªânh s·ª≠a ·∫£nh b√¨a (sau n√†y d√πng ti·∫øp ƒë∆∞·ª£c) -->
                            <!--                            <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 edit-cover-btn" title="ƒê·ªïi ·∫£nh b√¨a">-->
                            <!--                                <i class="fa-solid fa-pen"></i>-->
                            <!--                            </button>-->
                        </div>


                        <div class="profile-contain">
                            <div class="profile-image">
                                <div class="position-relative avatar-wrapper">
                                    <img id="avatarImage"
                                         src="/AgriculturalWarehouseManagementApplication/Backend/assets/images/user/default-avatar.png"
                                         class="avatar-img" alt="">

                                    <!-- N√∫t ch·ªânh s·ª≠a ·∫£nh avatar -->
                                    <button class="btn btn-sm btn-light position-absolute edit-avatar-btn"
                                            title="ƒê·ªïi ·∫£nh ƒë·∫°i di·ªán">
                                        <i class="fa-solid fa-camera"></i>
                                    </button>


                                    <!-- üîç N√∫t zoom -->
                                    <button class="btn btn-sm btn-light position-absolute zoom-avatar-btn"
                                            title="Ph√≥ng to ·∫£nh">
                                        <i class="fa-solid fa-magnifying-glass-plus"></i>
                                    </button>

                                    <!-- File input -->
                                    <input type="file" id="avatarInput" style="display: none;" accept="image/*">
                                </div>
                            </div>


                            <div class="profile-name">
                                <h3 id="usernameDisplay">username m·∫∑c ƒë·ªãnh</h3>
                                <h6 class="text-content" id="emailDisplay">email@example.com</h6>
                            </div>

                        </div>
                    </div>


                    <ul class="nav nav-pills user-nav-pills" id="pills-tab" role="tablist">

                        <li class="nav-item" role="presentation">
                            <a href="#pills-tabContent" class="nav-link active" id="pills-dashboard-tab"
                               data-bs-toggle="pill" data-bs-target="#pills-dashboard" role="tab"><i
                                    data-feather="home"></i>
                                T·ªïng quan</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-profile" type="button" role="tab">
                                <i data-feather="user"></i> H·ªì s∆°
                            </button>
                        </li>


                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-order" type="button" role="tab">
                                <i data-feather="clipboard"></i> ƒê∆°n h√†ng
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="pills-out-tab"
                               href="http://localhost:8080/AgriculturalWarehouseManagementApplication/logoutUser"
                               role="tab">
                                <i data-feather="log-out"></i> ƒêƒÉng xu·∫•t
                            </a>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="col-xxl-9 col-lg-8">
                <button class="btn left-dashboard-show btn-animation btn-md fw-bold d-block mb-4 d-lg-none">Show
                    Menu
                </button>
                <div class="dashboard-right-sidebar">
                    <div class="tab-content" id="pills-tabContent">
                        <!--                            Trang ƒëi·ªÅu khi·ªÉn-->
                        <div class="tab-pane fade show active" id="pills-dashboard" role="tabpanel">
                            <div class="dashboard-home">
                                <div class="title">
                                    <h2>Trang t·ªïng quan c·ªßa t√¥i</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="dashboard-user-name">
                                    <h6 class="text-content">
                                        Xin ch√†o b·∫°n,
                                        <!--                                        <b class="text-title" th:text="${shipper.username}">username</b>-->
                                        <i><b> Ch√∫c b·∫°n m·ªôt bu·ªïi s√°ng vui v·∫ª v√† tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng !!</b></i>
                                    </h6>
                                    <!--                                    <p class="text-content">-->
                                    <!--                                        T·ª´ t√†i kho·∫£n Dashboard, b·∫°n c√≥ th·ªÉ xem ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y v√† c·∫≠p nh·∫≠t th√¥ng tin t√†i kho·∫£n..-->
                                    <!--                                    </p>-->
                                </div>

                                <div class="total-box">
                                    <div class="row g-sm-4 g-3">
                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img th:src="@{FrontEnd/assets/images/svg/order.svg}"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img th:src="@{FrontEnd/assets/images/svg/order.svg}"
                                                     class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>ƒê∆°n h√†ng ƒë√£ xu·∫•t kho</h5>
                                                    <h3 id="totalSTOCKOUTCount">0</h3>
                                                    <!-- S·ªë l∆∞·ª£ng blog s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y -->
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img th:src="@{FrontEnd/assets/images/svg/wishlist.svg}"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img th:src="@{FrontEnd/assets/images/svg/wishlist.svg}"
                                                     class="blur-up lazyload" alt="">
                                                <div class="total-detail">
                                                    <h5>ƒê∆°n h√†ng ƒë√£ giao</h5>
                                                    <h3 id="totalDELIVEREDCount">0</h3>
                                                    <!-- S·ªë l∆∞·ª£ng blog s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t ·ªü ƒë√¢y -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-4">
                                    <div class="col-xxl-6">
                                        <div class="dashboard-content-title">
                                            <h4>Th√¥ng tin
                                            </h4>
                                        </div>
                                        <div class="dashboard-detail">
                                            <!--                                            <h6 class="text-content" th:text="${shipper.fullName}">H·ªç t√™n</h6>-->
                                            <!--                                            <h6 class="text-content" th:text="${shipper.email}">Email</h6>-->
                                            <h3> Vi·ªác g√¨ kh√≥ ƒë√£ c√≥ AGRIKHO</h3>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <script>document.addEventListener("DOMContentLoaded", function () {

                                const CONTEXT_PATH = "/AgriculturalWarehouseManagementApplication";

                                fetch(`${CONTEXT_PATH}/api/shipper/orders/count-stockout`)
                                    .then(res => res.json())
                                    .then(count => {
                                        document.getElementById("totalSTOCKOUTCount").textContent = count;
                                    });

                                fetch(`${CONTEXT_PATH}/api/shipper/orders/count-delivered`)
                                    .then(res => res.json())
                                    .then(count => {
                                        document.getElementById("totalDELIVEREDCount").textContent = count;
                                    });
                            });
                            </script>
                        </div>


                        <div class="tab-pane fade" id="pills-order" role="tabpanel">
                            <div class="dashboard-order">
                                <div class="title mb-3 d-flex justify-content-between align-items-center">
                                    <h2>T·∫•t C·∫£ ƒê∆°n H√†ng</h2>
                                    <div class="input-group" style="width: 300px;">
                                        <input type="text" id="searchInput" class="form-control"
                                               placeholder="Nh·∫≠p m√£ ƒë∆°n ho·∫∑c SƒêT">
                                        <button class="btn btn-success" onclick="searchOrder()">T√¨m ki·∫øm</button>
                                    </div>
                                    <ul id="searchRecommendations" class="list-group position-absolute"
                                        style="top: 50px; right: 0; width: 300px; z-index: 1000; display:none;"></ul>
                                </div>
                                <div class="mb-3 d-flex align-items-center gap-2">
                                    <label for="statusFilter" class="fw-bold mb-0">L·ªçc tr·∫°ng th√°i: </label>
                                    <select id="statusFilter" class="form-select form-select-sm" style="width: 170px; display: inline-block;">
                                        <option value="ALL">T·∫•t c·∫£</option>
                                        <option value="PENDING">Ch·ªù x√°c nh·∫≠n</option>
                                        <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
                                        <option value="CANCELLED">ƒê√£ hu·ª∑</option>
                                        <option value="STOCKOUT">ƒê√£ xu·∫•t kho</option>
                                        <option value="DELIVERED">ƒê√£ giao</option>
                                        <option value="COMPLETED">Ho√†n th√†nh</option>
                                    </select>
                                </div>

                                <table class="table" id="shipper-order-table">
                                    <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>M√£ ƒë∆°n h√†ng</th>
                                        <th style="white-space: nowrap;">
                                            <div class="d-flex align-items-center">
                                                <span>Ng√†y ƒë·∫∑t</span>
                                                <button id="sortDateBtn"
                                                        class="btn btn-sm ms-1 p-0 border-0 bg-transparent">
                                                    <i class="fa-solid fa-sort text-success"></i>
                                                </button>
                                            </div>
                                        </th>
                                        <th>SƒêT</th>
                                        <th>ƒê·ªãa ch·ªâ</th>
                                        <th>T·ªïng ti·ªÅn (VNƒê)</th>
                                        <th>Th√†nh ti·ªÅn (VNƒê)</th>
                                        <th>Tr·∫°ng th√°i</th>
                                        <th>Thao t√°c</th>
                                    </tr>
                                    </thead>
                                    <tbody id="shipper-orders-tbody">
                                    <!-- D·ªØ li·ªáu s·∫Ω render t·∫°i ƒë√¢y b·∫±ng JavaScript -->
                                    </tbody>
                                </table>
                                <!-- Ph√¢n trang -->
                                <nav aria-label="Page navigation">
                                    <ul class="pagination justify-content-center" id="pagination"></ul>
                                </nav>

                            </div>

                        </div>

                        <div class="tab-pane fade" id="pills-profile" role="tabpanel">
                            <div class="dashboard-profile">
                                <div class="title d-flex justify-content-between align-items-center">
                                    <h2>H·ªì s∆° ng∆∞·ªùi v·∫≠n chuy·ªÉn</h2>
                                </div>
                                <!-- Th√¥ng tin c∆° b·∫£n -->
                                <div class="profile-tab dashboard-bg-box mb-3">
                                    <h4 class="mb-3">üîπ Th√¥ng tin c∆° b·∫£n</h4>
                                    <ul>
                                        <li class="editable-row" data-key="userId">
                                            <h5>ID ng∆∞·ªùi d√πng:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text" readonly>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="username">
                                            <h5>T√™n ng∆∞·ªùi d√πng:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">T√™n ng∆∞·ªùi d√πng ph·∫£i c√≥
                                                t·ª´ 3 ƒë·∫øn 20 k√Ω t·ª±.</small>
                                        </li>

                                        <li class="editable-row" data-key="fullName">
                                            <h5>H·ªç v√† t√™n:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">H·ªç v√† t√™n kh√¥ng ƒë∆∞·ª£c
                                                ƒë·ªÉ tr·ªëng.</small>
                                        </li>

                                        <li class="editable-row" data-key="gender">
                                            <h5>Gi·ªõi t√≠nh:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <select class="form-select form-select-sm d-none field-input">
                                                    <option>Nam</option>
                                                    <option>N·ªØ</option>
                                                    <option>Kh√°c</option>
                                                </select>
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">Ch·ªçn gi·ªõi t√≠nh ph√π
                                                h·ª£p.</small>
                                        </li>

                                        <li class="editable-row" data-key="dob">
                                            <h5>Ng√†y sinh:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="date">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">Vui l√≤ng ch·ªçn ng√†y
                                                sinh h·ª£p l·ªá. Tu·ªïi ph·∫£i t·ª´ 10 ƒë·∫øn 100</small>
                                        </li>

                                        <li>
                                            <h5>Ng√†y t·∫°o t√†i kho·∫£n:</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="createdAt mb-0">--/--/----</h5>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Th√¥ng tin li√™n l·∫°c -->
                                <div class="profile-tab dashboard-bg-box mb-3">
                                    <h4 class="mb-3">üîπ Th√¥ng tin li√™n l·∫°c</h4>
                                    <ul>
                                        <li>
                                            <h5>Email:</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="email mb-0">example@email.com</h5>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="phone">
                                            <h5>S·ªë ƒëi·ªán tho·∫°i:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">S·ªë ƒëi·ªán tho·∫°i g·ªìm 10
                                                ch·ªØ s·ªë, b·∫Øt ƒë·∫ßu b·∫±ng 0.</small>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Th√¥ng tin ƒëƒÉng nh·∫≠p -->
                                <div class="profile-tab dashboard-bg-box">
                                    <h4 class="mb-3">üîπ Th√¥ng tin ƒëƒÉng nh·∫≠p</h4>
                                    <ul>
                                        <li>
                                            <h5>T√†i kho·∫£n (Email):</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="account-email mb-0">--</h5>
                                                <i class="bi bi-lock-fill text-muted ms-2"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="password">
                                            <h5>M·∫≠t kh·∫©u:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value">******</span>
                                                <!-- üîí Kh√¥ng cho ch·ªânh s·ª≠a tr·ª±c ti·∫øp -->
                                                <!-- C√≥ th·ªÉ gi·ªØ input n·∫øu b·∫°n c·∫ßn logic backend, nh∆∞ng n√™n disabled -->
                                                <input type="password"
                                                       class="form-control form-control-sm field-input d-none"
                                                       disabled/>

                                                <!-- üîó N√∫t ƒë·ªïi m·∫≠t kh·∫©u -->
                                                <button type="button" id="btnEditPassword"
                                                        class="btn btn-sm btn-outline-secondary ms-2"
                                                        title="ƒê·ªïi m·∫≠t kh·∫©u">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- N√∫t Hu·ª∑ & L∆∞u -->
                                <div class="d-flex justify-content-end mt-4 gap-2">
                                    <button id="cancel-edit" class="btn btn-outline-secondary" title="Hu·ª∑ c√°c thay ƒë·ªïi">
                                        <i class="bi bi-x-circle me-1"></i> Hu·ª∑
                                    </button>
                                    <button id="save-edit" class="btn btn-primary" title="L∆∞u c√°c thay ƒë·ªïi">
                                        <i class="bi bi-save me-1"></i> L∆∞u thay ƒë·ªïi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- User Dashboard Section End -->

<!-- Footer Section Start -->
<footer class="section-t-space">
    <div th:replace="FrontEnd/fragments/footer :: footer"></div>
</footer>
<!-- Footer Section End -->


<!-- Tap to top and theme setting button start -->
<div class="theme-option">
    <div class="setting-box">
        <button class="btn setting-button">
            <i class="fa-solid fa-gear"></i>
        </button>

        <div class="theme-setting-2">
            <div class="theme-box">
                <ul>
                    <li>
                        <div class="setting-name">
                            <h4>Color</h4>
                        </div>
                        <div class="theme-setting-button color-picker">
                            <form class="form-control">
                                <label for="colorPick" class="form-label mb-0">Theme Color</label>
                                <input type="color" class="form-control form-control-color" id="colorPick"
                                       value="#0da487" title="Choose your color">
                            </form>
                        </div>
                    </li>

                    <li>
                        <div class="setting-name">
                            <h4>Dark</h4>
                        </div>
                        <div class="theme-setting-button">
                            <button class="btn btn-2 outline" id="darkButton">Dark</button>
                            <button class="btn btn-2 unline" id="lightButton">Light</button>
                        </div>
                    </li>

                    <li>
                        <div class="setting-name">
                            <h4>RTL</h4>
                        </div>
                        <div class="theme-setting-button rtl">
                            <button class="btn btn-2 rtl-unline">LTR</button>
                            <button class="btn btn-2 rtl-outline">RTL</button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="back-to-top">
        <a id="back-to-top" href="#">
            <i class="fas fa-chevron-up"></i>
        </a>
    </div>
</div>
<!-- Tap to top and theme setting button end -->

<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->


<!-- latest jquery-->
<script th:src="@{FrontEnd/assets/js/jquery-3.6.0.min.js}"></script>

<!-- jquery ui-->
<script th:src="@{FrontEnd/assets/js/jquery-ui.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{FrontEnd/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>
<script th:src="@{FrontEnd/assets/js/bootstrap/bootstrap-notify.min.js}"></script>
<script th:src="@{FrontEnd/assets/js/bootstrap/popper.min.js}"></script>

<!-- feather icon js-->
<script th:src="@{FrontEnd/assets/js/feather/feather.min.js}"></script>
<script th:src="@{FrontEnd/assets/js/feather/feather-icon.js}"></script>

<!-- Lazyload Js -->
<script th:src="@{FrontEnd/assets/js/lazysizes.min.js}"></script>

<!-- Slick js-->
<script th:src="@{FrontEnd/assets/js/slick/slick.js}"></script>
<script th:src="@{FrontEnd/assets/js/slick/custom_slick.js}"></script>

<!-- Quantity js -->
<script th:src="@{FrontEnd/assets/js/quantity-2.js}"></script>

<!-- Nav & tab upside js -->
<script th:src="@{FrontEnd/assets/js/nav-tab.js}"></script>

<!-- script js -->
<script th:src="@{FrontEnd/assets/js/script.js}"></script>

<!-- theme setting js -->
<script th:src="@{/FrontEnd/assets/js/theme-setting.js}"></script>

<!--Th√™m th∆∞ vi·ªán-->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<!-- Bootstrap 5.3.3 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- DataTables + mark.js -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.6/features/mark.js/datatables.mark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"></script>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!--Th√™m th∆∞ vi·ªán End-->

<!-- Modal ƒë·ªïi m·∫≠t kh·∫©u -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <form id="changePasswordForm" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">ƒê·ªïi m·∫≠t kh·∫©u</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="currentPassword" class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                    <input type="password" class="form-control" id="currentPassword" required minlength="6"/>
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" class="form-control" id="newPassword" required minlength="6"/>
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" class="form-control" id="confirmPassword" required minlength="6"/>
                </div>
                <div id="passwordError" class="text-danger d-none"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hu·ª∑</button>
                <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal xem ·∫£nh -->
<div class="modal fade" id="zoomAvatarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <img id="zoomAvatarImg" src="" alt="Zoomed Avatar" class="img-fluid rounded">
        </div>
    </div>
</div>

<!--1. Tab Profile-->
<!--CSS Profile-->
<style>

    #sortDateBtn {
        color: #19a877;
        padding: 2px 6px;
    }

    #sortDateBtn:hover {
        background-color: #e5f6ee;
        border-radius: 4px;
    }

    .zoom-avatar-btn {
        bottom: 8px;
        left: 8px;
        border-radius: 50%;
        padding: 6px 8px;
        font-size: 12px;
    }

    .avatar-wrapper {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        position: relative;
        margin: auto;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* üîπ ƒê·∫£m b·∫£o ·∫£nh l·∫•p ƒë·∫ßy khung */
        object-position: center; /* üîπ L·∫•y ph·∫ßn gi·ªØa ·∫£nh */
        border-radius: 50%;
        display: block;
    }


    .edit-avatar-btn {
        bottom: 8px;
        right: 8px;
        border-radius: 50%;
        padding: 6px 8px;
        font-size: 12px;
    }

    .edit-avatar-btn, .edit-cover-btn {
        border-radius: 50%;
        padding: 5px 7px;
    }

    /* üîπ N√∫t H·ªßy */
    #cancel-edit {
        background-color: #f8f9fa;
        color: #6c757d;
        border: 1px solid #ced4da;
        transition: all 0.2s ease-in-out;
    }

    #cancel-edit:hover {
        background-color: #e2e6ea;
        color: #495057;
        border-color: #adb5bd;
    }

    /* üîπ N√∫t L∆∞u */
    #save-edit {
        background-color: #198754;
        color: #fff;
        border: none;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
    }

    #save-edit:hover {
        background-color: #157347;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #save-edit:active {
        transform: scale(0.98);
    }

    /* üî∏ Responsive spacing n·∫øu c·∫ßn */
    .profile-tab .btn {
        min-width: 110px;
        font-weight: 500;
        letter-spacing: 0.3px;
    }
</style>

<style>
    .img-fluid {
        width: 250px;
        height: auto;
        object-fit: cover; /* ho·∫∑c 'contain' tu·ª≥ theo nhu c·∫ßu */
        border-radius: 10px;
    }

    .progtrckr li {
        margin-top: 10px;
    }

    .progtrckr {
        list-style: none;
        display: flex;
        justify-content: space-between;
        padding: 0;
        margin: 20px 0;
    }

    .progtrckr li {
        width: 100%;
        text-align: center;
        position: relative;
    }

    .progtrckr li::before {
        content: '‚óè';
        display: block;
        margin: 0 auto 10px;
        font-size: 20px;
    }

    .progtrckr-done::before {
        color: green;
    }

    .progtrckr-todo::before {
        color: lightgray;
    }

    .progtrckr li:not(:last-child)::after {
        content: '';
        position: absolute;
        top: 10px;
        left: 50%;
        height: 2px;
        width: 100%;
        background-color: lightgray;
        z-index: -1;
    }

    .progtrckr-done + li::after {
        background-color: green;
    }


</style>

<!--CRUD profile-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const BASE_URL = "/AgriculturalWarehouseManagementApplication/api/shipper/user";
        const originalValues = {};
        let isEditing = false;
        const userId = "[[${session.accountIdShipper}]]";

        function loadUserData() {
            fetch(`${BASE_URL}/by-id/${userId}`)
                .then(res => res.json())
                .then(data => {
                    setField("userId", data.userId, true);
                    setField("fullName", data.fullName);
                    setField("gender", data.gender);
                    setField("dob", data.dob);
                    setField("phone", data.phone);
                    setField("password", data.password);
                    setField("username", data.username);

                    document.querySelector(".createdAt").textContent = data.createdAt;
                    document.querySelector(".email").textContent = data.email;
                    document.querySelector(".account-email").textContent = data.email;
                    document.getElementById('usernameDisplay').textContent = data.username;
                    document.getElementById('emailDisplay').textContent = data.email;

                    document.querySelectorAll(".editable-row").forEach(row => {
                        const key = row.dataset.key;
                        originalValues[key] = row.querySelector(".field-value").textContent.trim();
                    });

                    // ‚úÖ L∆∞u userId v√†o localStorage
                    localStorage.setItem("userId", data.userId);

                    updateActionButtons();
                })
                .catch(err => {
                    console.error("L·ªói khi l·∫•y d·ªØ li·ªáu:", err);
                    showAlert("B·∫°n c·∫ßn c·∫≠p nh√¢t ƒë·∫ßy ƒë·ªß th√¥ng tin ng∆∞·ªùi d√πng!", "info");
                });
        }

        function setField(key, value, readOnly = false) {
            const row = document.querySelector(`.editable-row[data-key="${key}"]`);
            if (!row) return;

            const span = row.querySelector(".field-value");
            const input = row.querySelector(".field-input");

            if (key === "dob") {
                span.textContent = value;
                input.value = convertToInputDate(value);
            } else if (key === "password") {
                span.textContent = "*".repeat(value.length);
                input.value = value;
            } else {
                span.textContent = value;
                input.value = value;
            }

            if (readOnly) {
                const btn = row.querySelector(".btn-edit");
                if (btn) btn.disabled = true;
            }
        }

        function toggleEdit(button) {
            const row = button.closest(".editable-row");
            const key = row.dataset.key;
            const span = row.querySelector(".field-value");
            const input = row.querySelector(".field-input");
            const hint = row.querySelector(".field-hint");

            const isViewing = !span.classList.contains("d-none");

            if (isViewing) {
                span.classList.add("d-none");
                input.classList.remove("d-none");
                if (hint) hint.classList.remove("d-none");
                button.innerHTML = '<i class="bi bi-check-lg"></i>';
                input.focus();

                // ƒê√£ b·∫Øt ƒë·∫ßu ch·ªânh s·ª≠a
                isEditing = true;
                updateActionButtons();
            } else {
                let value = input.value.trim();
                if (input.tagName === "SELECT") {
                    value = input.options[input.selectedIndex].text;
                }

                if (key === "dob") {
                    span.textContent = convertToDisplayDate(value);
                } else if (key === "password") {
                    span.textContent = "*".repeat(value.length);
                } else {
                    span.textContent = value;
                }

                span.classList.remove("d-none");
                input.classList.add("d-none");
                if (hint) hint.classList.add("d-none");
                button.innerHTML = '<i class="bi bi-pencil-square"></i>';
            }
        }

        document.getElementById("cancel-edit").addEventListener("click", () => {
            for (const key in originalValues) {
                const row = document.querySelector(`.editable-row[data-key="${key}"]`);
                const span = row.querySelector(".field-value");
                const input = row.querySelector(".field-input");
                const hint = row.querySelector(".field-hint");

                span.classList.remove("d-none");
                input.classList.add("d-none");
                if (hint) hint.classList.add("d-none");

                const value = originalValues[key];
                input.value = (key === "dob") ? convertToInputDate(value) : value;
                span.textContent = (key === "password") ? "*".repeat(value.length) : value;

                const btn = row.querySelector(".btn-edit");
                if (btn && !btn.disabled) btn.innerHTML = '<i class="bi bi-pencil-square"></i>';
            }

            isEditing = false;
            updateActionButtons();
            // showAlert("ƒê√£ hu·ª∑ ch·ªânh s·ª≠a!", "info");
        });

        document.getElementById("save-edit").addEventListener("click", () => {
            const updatedData = {};
            let isValid = true;
            let errorMessage = "";

            document.querySelectorAll(".editable-row").forEach(row => {
                const key = row.dataset.key;
                const input = row.querySelector(".field-input");
                let value = input.value.trim();

                if (input.tagName === "SELECT") {
                    value = input.options[input.selectedIndex].text;
                }

                switch (key) {
                    case "fullName":
                        if (!value.match(/^[A-Za-z√Ä-·ªπ\s]+$/)) {
                            isValid = false;
                            errorMessage = "H·ªç v√† t√™n kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "gender":
                        if (!["Nam", "N·ªØ", "Kh√°c"].includes(value)) {
                            isValid = false;
                            errorMessage = "Gi·ªõi t√≠nh kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "dob":
                        if (!value) {
                            isValid = false;
                            errorMessage = "Ng√†y sinh kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
                        } else {
                            const today = new Date();
                            const dob = new Date(value);
                            const age = today.getFullYear() - dob.getFullYear();
                            if (dob > today) {
                                isValid = false;
                                errorMessage = "Ng√†y sinh kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n ng√†y hi·ªán t·∫°i.";
                            } else if (age < 10 || age > 100) {
                                isValid = false;
                                errorMessage = "Tu·ªïi ph·∫£i t·ª´ 10 ƒë·∫øn 100.";
                            }
                        }
                        break;
                    case "phone":
                        if (!value.match(/^0\d{9}$/)) {
                            isValid = false;
                            errorMessage = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "username":
                        if (value.length < 4 || /\s/.test(value)) {
                            isValid = false;
                            errorMessage = "T√™n ƒëƒÉng nh·∫≠p ph·∫£i t·ªëi thi·ªÉu 4 k√Ω t·ª± v√† kh√¥ng c√≥ kho·∫£ng tr·∫Øng.";
                        }
                        break;
                    case "password":
                        if (value.length < 6) {
                            isValid = false;
                            errorMessage = "M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.";
                        }
                        break;
                }

                if (!isValid) return;

                updatedData[key] = (key === "dob") ? convertToDisplayDate(value) : value;
            });

            if (!isValid) {
                showAlert(errorMessage, "error");
                return;
            }

            fetch(BASE_URL, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(updatedData)
            })
                .then(res => {
                    if (!res.ok) throw new Error("L·ªói khi l∆∞u");
                    return res.json();
                })
                .then(() => {
                    showAlert("L∆∞u thay ƒë·ªïi th√†nh c√¥ng!", "success");
                    isEditing = false;
                    updateActionButtons();
                    setTimeout(() => location.reload(), 1500);
                })
                .catch(err => {
                    console.error(err);
                    showAlert("ƒê√£ x·∫£y ra l·ªói khi l∆∞u!", "error");
                });
        });

        document.addEventListener("keypress", function (e) {
            if (e.key === "Enter" && e.target.classList.contains("field-input")) {
                const row = e.target.closest(".editable-row");
                toggleEdit(row.querySelector(".btn-edit"));
            }
        });

        document.addEventListener("click", function (e) {
            const btn = e.target.closest(".btn-edit");
            if (btn) toggleEdit(btn);
        });

        function convertToInputDate(str) {
            const [d, m, y] = str.split("/");
            return `${y}-${m.padStart(2, "0")}-${d.padStart(2, "0")}`;
        }

        function convertToDisplayDate(str) {
            const [y, m, d] = str.split("-");
            return `${d}/${m}/${y}`;
        }

        function updateActionButtons() {
            const saveBtn = document.getElementById("save-edit");
            const cancelBtn = document.getElementById("cancel-edit");

            if (isEditing) {
                saveBtn.removeAttribute("disabled");
                cancelBtn.removeAttribute("disabled");
                saveBtn.classList.remove("btn-outline-secondary");
                saveBtn.classList.add("btn-primary");
            } else {
                saveBtn.setAttribute("disabled", true);
                cancelBtn.setAttribute("disabled", true);
                saveBtn.classList.remove("btn-primary");
                saveBtn.classList.add("btn-outline-secondary");
            }
        }

        function showAlert(message, type = 'success') {
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: type,
                title: message,
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                background: '#fefefe',
                color: '#333'
            });
        }

        const changePasswordModal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
        const changePasswordForm = document.getElementById('changePasswordForm');
        const passwordErrorDiv = document.getElementById('passwordError');

        document.getElementById('btnEditPassword').addEventListener('click', () => {
            changePasswordForm.reset();
            passwordErrorDiv.classList.add('d-none');
            passwordErrorDiv.textContent = '';
            changePasswordModal.show();
        });

        changePasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const userId = "[[${session.accountIdShipper}]]";
            ; // thay th√†nh ID user th·ª±c t·∫ø
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (newPassword !== confirmPassword) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n kh√¥ng kh·ªõp.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }

            if (newPassword.length < 6) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }

            if (newPassword === currentPassword) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c tr√πng m·∫≠t kh·∫©u hi·ªán t·∫°i.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }


            fetch('/AgriculturalWarehouseManagementApplication/api/shipper/user/change-password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    userId: userId,
                    currentPassword: currentPassword,
                    newPassword: newPassword
                })
            })
                .then(async res => {
                    const data = await res.json();

                    if (!res.ok) {
                        const errorMessage = data.error || 'L·ªói khi ƒë·ªïi m·∫≠t kh·∫©u';
                        throw new Error(errorMessage);
                    }

                    // ‚úÖ Hi·ªÉn th·ªã alert th√†nh c√¥ng
                    Swal.fire({
                        icon: 'success',
                        title: 'ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!',
                        timer: 1500,
                        showConfirmButton: false,
                        willClose: () => {
                            // ‚úÖ Reload sau khi alert ƒë√≥ng
                            location.reload();
                        }
                    });

                    changePasswordModal.hide();
                })
                .catch(err => {
                    passwordErrorDiv.textContent = err.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh.";
                    passwordErrorDiv.classList.remove('d-none');
                });

        });

        loadUserData();
    });
</script>

<!--Avatar-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userId = "[[${session.accountIdShipper}]]"; // ‚ö†Ô∏è Replace with dynamic userId if needed
        const BASE = "/AgriculturalWarehouseManagementApplication";

        const avatarImg = document.getElementById("avatarImage");
        const input = document.getElementById("avatarInput");
        const editBtn = document.querySelector(".edit-avatar-btn");

        // üìå G·∫Øn s·ª± ki·ªán click ƒë·ªÉ m·ªü input
        if (editBtn && input) {
            editBtn.addEventListener("click", () => input.click());
        }

        // üìå G·∫Øn s·ª± ki·ªán change ƒë·ªÉ upload
        input.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("file", file);

            fetch(`${BASE}/api/seller/user/${userId}/avatar`, {
                method: "POST",
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    if (data.avatarUrl) {
                        // ‚úÖ C·∫≠p nh·∫≠t src avatar v√† th√™m timestamp ƒë·ªÉ tr√°nh cache
                        avatarImg.src = BASE + data.avatarUrl + "?t=" + new Date().getTime();
                        Swal.fire({
                            icon: 'success',
                            title: 'Th√†nh c√¥ng',
                            text: 'C·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán th√†nh c√¥ng!',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'L·ªói hi·ªÉn th·ªã ·∫£nh',
                            text: 'ƒê·ªãnh d·∫°ng ·∫£nh c√≥ th·ªÉ kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£.'
                        });
                    }
                })
                .catch(err => {
                    console.error("L·ªói khi upload ·∫£nh:", err);
                    Swal.fire({
                        icon: 'error',
                        title: 'L·ªói upload',
                        text: 'Kh√¥ng th·ªÉ upload ·∫£nh.'
                    });
                });

        });

        // üìå Load avatar ban ƒë·∫ßu
        fetch(`${BASE}/api/shipper/user/by-id/${userId}`)
            .then(res => res.json())
            .then(data => {
                if (data.image) {
                    avatarImg.src = BASE + `/seller/${data.userId}/${data.image}?t=` + new Date().getTime();
                } else {
                    avatarImg.src = BASE + `/Backend/assets/images/user/default-avatar.png?t=` + new Date().getTime();
                    // avatarImg.src = data.image
                }

            });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const zoomBtn = document.querySelector(".zoom-avatar-btn");
        const zoomImg = document.getElementById("zoomAvatarImg");
        const avatarImg = document.getElementById("avatarImage");

        if (zoomBtn && zoomImg && avatarImg) {
            zoomBtn.addEventListener("click", () => {
                zoomImg.src = avatarImg.src;
                new bootstrap.Modal(document.getElementById("zoomAvatarModal")).show();
            });
        }
    });

</script>
<!--Tab Profile End-->

<script>
    let sortAsc = true;

    document.getElementById("sortDateBtn").addEventListener("click", function () {
        allOrders.sort((a, b) => {
            const dateA = new Date(a.orderDate);
            const dateB = new Date(b.orderDate);
            return sortAsc ? dateA - dateB : dateB - dateA;
        });

        sortAsc = !sortAsc;
        gotoPage(1); // render l·∫°i trang ƒë·∫ßu ti√™n sau khi sort
    });
</script>


<!-- ƒê∆°n H√†ng-->
<script>
    const CONTEXT_PATH = "/AgriculturalWarehouseManagementApplication";
    const PAGE_SIZE = 5;
    let allOrders = [];

    document.addEventListener("DOMContentLoaded", function () {
        fetch(`${CONTEXT_PATH}/api/shipper/orders`)
            .then(res => res.json())
            .then(data => {
                allOrders = data || [];
                if (allOrders.length === 0) {
                    document.getElementById("shipper-orders-tbody").innerHTML =
                        `<tr><td colspan="9" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o.</td></tr>`;
                    document.getElementById("pagination").innerHTML = "";
                    return;
                }
                gotoPage(1);
            })
            .catch(err => {
                console.error("L·ªói khi t·∫£i d·ªØ li·ªáu:", err);
                document.getElementById("shipper-orders-tbody").innerHTML =
                    `<tr><td colspan="9" class="text-danger text-center">L·ªói khi t·∫£i d·ªØ li·ªáu.</td></tr>`;
            });
    });

    function gotoPage(pageNumber) {
        const startIndex = (pageNumber - 1) * PAGE_SIZE;
        const endIndex = startIndex + PAGE_SIZE;
        const pageData = allOrders.slice(startIndex, endIndex);

        renderTable(pageData);
        renderPagination(pageNumber, Math.ceil(allOrders.length / PAGE_SIZE));
    }

    function translateStatus(status) {
        const translations = {
            "PENDING": "CH·ªú X√ÅC NH·∫¨N",
            "CONFIRMED": "ƒê√É X√ÅC NH·∫¨N",
            "CANCELLED": "ƒê√É HU·ª∂",
            "STOCKOUT": "ƒê√É XU·∫§T KHO",
            "DELIVERED": "ƒê√É GIAO",
            "COMPLETED": "HO√ÄN TH√ÄNH"
        };
        return translations[status] || status;
    }

    function getStatusBadgeClass(status) {
        switch (status) {
            case "PENDING":    return "badge bg-warning-subtle text-warning-emphasis";
            case "CONFIRMED":  return "badge bg-primary-subtle text-primary-emphasis";
            case "CANCELLED":  return "badge bg-danger-subtle text-danger-emphasis";
            case "STOCKOUT":   return "badge bg-secondary-subtle text-secondary-emphasis";
            case "DELIVERED":  return "badge bg-info-subtle text-info-emphasis";
            case "COMPLETED":  return "badge bg-success-subtle text-success-emphasis";
            default:           return "badge bg-light text-dark";
        }
    }

    function renderTable(orders) {
        const tbody = document.getElementById("shipper-orders-tbody");
        tbody.innerHTML = "";

        orders.forEach((order, index) => {
            // L·∫•y class badge status
            const statusBadge = getStatusBadgeClass(order.status);

            // N·∫øu l√† STOCKOUT th√¨ hi·ªán 2 n√∫t, c√≤n l·∫°i ƒë·ªÉ tr·ªëng ho·∫∑c c√≥ th·ªÉ disable n√∫t (n·∫øu mu·ªën)
            let actionButtons = "";
            if (order.status === "STOCKOUT") {
                actionButtons = `
                <button class="btn btn-success btn-sm me-1" onclick="confirmDelivery(${order.orderId})">‚úî Giao th√†nh c√¥ng</button>
                <button class="btn btn-danger btn-sm" onclick="cancelOrder(${order.orderId})">‚úñ Hu·ª∑ ƒë∆°n</button>
            `;
            }

            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${order.orderId}</td>
            <td>${order.orderCode || "N/A"}</td>
            <td>${order.orderDate || "N/A"}</td>
            <td>${order.phone || "N/A"}</td>
            <td>${order.address || "N/A"}</td>
            <td class="text-success"><i><b>${order.totalAmount.toLocaleString()} VND</b></i></td>
            <td class="text-danger"><i><b>${order.finalAmount.toLocaleString()} VND</b></i></td>
            <td><span class="${statusBadge}">${translateStatus(order.status)}</span></td>
            <td>
                ${actionButtons}
            </td>
        `;
            tbody.appendChild(row);
        });
    }


    // L·ªçc tr·∫°ng th√°i Start JS
    let currentFilterStatus = "ALL";

    document.addEventListener("DOMContentLoaded", function () {
        // ... code fetch allOrders nh∆∞ tr∆∞·ªõc ...
        const statusFilter = document.getElementById("statusFilter");
        if (statusFilter) {
            statusFilter.addEventListener("change", function () {
                currentFilterStatus = this.value;
                gotoPage(1);
            });
        }
    });

    function getFilteredOrders() {
        if (currentFilterStatus === "ALL") return allOrders;
        return allOrders.filter(order => order.status === currentFilterStatus);
    }

    function gotoPage(pageNumber) {
        const ordersToDisplay = getFilteredOrders();
        const startIndex = (pageNumber - 1) * PAGE_SIZE;
        const endIndex = startIndex + PAGE_SIZE;
        const pageData = ordersToDisplay.slice(startIndex, endIndex);
        renderTable(pageData);
        renderPagination(pageNumber, Math.ceil(ordersToDisplay.length / PAGE_SIZE));
    }

    function searchOrder() {
        const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
        const ordersToSearch = getFilteredOrders();
        const filteredOrders = ordersToSearch.filter(order =>
            order.orderCode.toLowerCase().includes(keyword) ||
            order.phone.includes(keyword)
        );

        if (filteredOrders.length === 0) {
            document.getElementById("shipper-orders-tbody").innerHTML =
                `<tr><td colspan="9" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ph√π h·ª£p.</td></tr>`;
            document.getElementById("pagination").innerHTML = "";
            return;
        }

        renderTable(filteredOrders.slice(0, PAGE_SIZE));
        renderPaginationSearch(filteredOrders, 1);
    }

    // L·ªçc tr·∫°ng th√°i End JS


    function renderPagination(currentPage, totalPages) {
        let html = '';

        if (currentPage > 1) {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="gotoPage(${currentPage - 1});return false;">&lt; TRANG TR∆Ø·ªöC</a></li>`;
        }

        html += `<li class="page-item${currentPage === 1 ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(1);return false;">1</a></li>`;

        if (currentPage > 3) {
            html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }

        for (let i = Math.max(2, currentPage - 1); i <= Math.min(totalPages - 1, currentPage + 1); i++) {
            html += `<li class="page-item${i === currentPage ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(${i});return false;">${i}</a></li>`;
        }

        if (currentPage < totalPages - 2) {
            html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
        }

        if (totalPages > 1) {
            html += `<li class="page-item${currentPage === totalPages ? " active" : ""}"><a class="page-link" href="#" onclick="gotoPage(${totalPages});return false;">${totalPages}</a></li>`;
        }

        if (currentPage < totalPages) {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="gotoPage(${currentPage + 1});return false;">TRANG SAU &gt;</a></li>`;
        }

        document.getElementById("pagination").innerHTML = html;
    }

    function confirmDelivery(orderId) {
        if (confirm("X√°c nh·∫≠n ƒë∆°n h√†ng n√†y ƒë√£ giao th√†nh c√¥ng?")) {
            fetch(`${CONTEXT_PATH}/api/shipper/orders/${orderId}/confirm`, {
                method: "PUT"
            })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    location.reload();
                })
                .catch(err => alert("X·∫£y ra l·ªói khi x√°c nh·∫≠n"));
        }
    }

    function cancelOrder(orderId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën hu·ª∑ ƒë∆°n h√†ng n√†y kh√¥ng?")) {
            fetch(`${CONTEXT_PATH}/api/shipper/orders/${orderId}/cancel`, {
                method: "PUT"
            })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    location.reload();
                })
                .catch(err => alert("X·∫£y ra l·ªói khi hu·ª∑"));
        }
    }
</script>
<!-- ƒê∆°n H√†ng End-->

<!-- ƒê∆°n H√†ng Search Recomment End-->
<script>
    document.getElementById("searchInput").addEventListener("input", function () {
        const keyword = this.value.trim().toLowerCase();
        const recommendationBox = document.getElementById("searchRecommendations");

        if (keyword.length === 0) {
            recommendationBox.style.display = "none";
            return;
        }

        const matchedOrders = allOrders.filter(order =>
            order.orderCode.toLowerCase().includes(keyword) || order.phone.includes(keyword)
        );

        if (matchedOrders.length > 0) {
            recommendationBox.innerHTML = matchedOrders.slice(0, 10).map(order => `
            <li class="list-group-item" onclick="selectRecommendation('${order.orderCode}')">
                <strong>${order.orderCode}</strong> - ${order.phone}
            </li>
        `).join('');
            recommendationBox.style.display = "block";
        } else {
            recommendationBox.innerHTML = `<li class="list-group-item text-muted">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</li>`;
            recommendationBox.style.display = "block";
        }
    });

    function selectRecommendation(orderCode) {
        document.getElementById("searchInput").value = orderCode;
        document.getElementById("searchRecommendations").style.display = "none";
        searchOrder();
    }

    // ·∫®n recommendations khi click ra ngo√†i
    document.addEventListener('click', function (event) {
        const recommendationBox = document.getElementById('searchRecommendations');
        if (!document.getElementById('searchInput').contains(event.target) &&
            !recommendationBox.contains(event.target)) {
            recommendationBox.style.display = 'none';
        }
    });

    function renderPaginationSearch(filteredOrders, currentPage) {
        const totalPages = Math.ceil(filteredOrders.length / PAGE_SIZE);
        let html = '';

        if (currentPage > 1) {
            html += `<li class="page-item"><a class="page-link" onclick="changePageSearch(${currentPage - 1}, ${filteredOrders})">Trang tr∆∞·ªõc</a></li>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item${i === currentPage ? " active" : ""}">
                   <a class="page-link" onclick="changePageSearch(${i}, ${filteredOrders})">${i}</a>
                 </li>`;
        }

        if (currentPage < totalPages) {
            html += `<li class="page-item"><a class="page-link" onclick="changePageSearch(${currentPage + 1}, ${filteredOrders})">Trang sau</a></li>`;
        }

        document.getElementById("pagination").innerHTML = html;
    }

    function changePageSearch(pageNumber, filteredOrders) {
        const startIndex = (pageNumber - 1) * PAGE_SIZE;
        const pageData = filteredOrders.slice(startIndex, startIndex + PAGE_SIZE);
        renderTable(pageData);
        renderPaginationSearch(filteredOrders, pageNumber);
    }

</script>

<!-- ƒê∆°n H√†ng Search End-->
<script>
    function searchOrder() {
        const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
        const filteredOrders = allOrders.filter(order =>
            order.orderCode.toLowerCase().includes(keyword) ||
            order.phone.includes(keyword)
        );

        if (filteredOrders.length === 0) {
            document.getElementById("shipper-orders-tbody").innerHTML =
                `<tr><td colspan="9" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ph√π h·ª£p.</td></tr>`;
            document.getElementById("pagination").innerHTML = "";
            return;
        }

        renderTable(filteredOrders.slice(0, PAGE_SIZE));
        renderPaginationSearch(filteredOrders, 1);
    }

    function renderPaginationSearch(filteredOrders, currentPage) {
        const totalPages = Math.ceil(filteredOrders.length / PAGE_SIZE);
        let html = '';

        if (currentPage > 1) {
            html += `<li class="page-item"><a class="page-link" onclick="changePageSearch(${currentPage - 1}, ${filteredOrders})">Trang tr∆∞·ªõc</a></li>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item${i === currentPage ? " active" : ""}">
                   <a class="page-link" onclick="changePageSearch(${i}, ${filteredOrders})">${i}</a>
                 </li>`;
        }

        if (currentPage < totalPages) {
            html += `<li class="page-item"><a class="page-link" onclick="changePageSearch(${currentPage + 1}, ${filteredOrders})">Trang sau</a></li>`;
        }

        document.getElementById("pagination").innerHTML = html;
    }

    function changePageSearch(pageNumber, filteredOrders) {
        const startIndex = (pageNumber - 1) * PAGE_SIZE;
        const pageData = filteredOrders.slice(startIndex, startIndex + PAGE_SIZE);
        renderTable(pageData);
        renderPaginationSearch(filteredOrders, pageNumber);
    }

</script>

<!--Reload gi·ªØ nguy√™n tab-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabLinks = document.querySelectorAll('.user-nav-pills .nav-link');

        // G·ª° class active/show ƒë·ªÉ ƒë·∫£m b·∫£o reset tr∆∞·ªõc
        document.querySelectorAll('.user-nav-pills .nav-link, .tab-pane').forEach(el => {
            el.classList.remove("active", "show");
        });

        // K√≠ch ho·∫°t tab ƒë√£ l∆∞u
        const savedTabId = localStorage.getItem("activeSidebarTab");
        const savedTab = savedTabId ? document.getElementById(savedTabId) : null;

        if (savedTab) {
            new bootstrap.Tab(savedTab).show(); // Bootstrap t·ª± x·ª≠ l√Ω class active/show
        } else {
            const defaultTab = document.querySelector('.user-nav-pills .nav-link');
            if (defaultTab) new bootstrap.Tab(defaultTab).show();
        }

        // Ghi l·∫°i khi chuy·ªÉn tab
        tabLinks.forEach(tab => {
            tab.addEventListener("shown.bs.tab", function (e) {
                localStorage.setItem("activeSidebarTab", e.target.getAttribute("id"));
            });
        });
    });
</script>


<!-- Alert th√¥ng b√°o start-->
<script>
    function confirmDelivery(orderId) {
        Swal.fire({
            title: "X√°c nh·∫≠n giao th√†nh c√¥ng?",
            text: "B·∫°n c√≥ ch·∫Øc mu·ªën x√°c nh·∫≠n ƒë∆°n h√†ng n√†y ƒë√£ giao th√†nh c√¥ng?",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "‚úî Giao th√†nh c√¥ng",
            cancelButtonText: "Hu·ª∑",
            confirmButtonColor: "#19a877",
            cancelButtonColor: "#e74c3c",
            customClass: {
                confirmButton: 'btn btn-success mx-2',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`${CONTEXT_PATH}/api/shipper/orders/${orderId}/confirm`, {
                    method: "PUT"
                })
                    .then(res => res.text())
                    .then(msg => {
                        Swal.fire({
                            icon: "success",
                            title: "Th√†nh c√¥ng!",
                            text: msg,
                            timer: 1800,
                            showConfirmButton: false
                        });
                        setTimeout(() => location.reload(), 1200);
                    })
                    .catch(err => Swal.fire("L·ªói!", "X·∫£y ra l·ªói khi x√°c nh·∫≠n", "error"));
            }
        });
    }

    function cancelOrder(orderId) {
        Swal.fire({
            title: "Hu·ª∑ ƒë∆°n h√†ng?",
            text: "B·∫°n ch·∫Øc ch·∫Øn mu·ªën hu·ª∑ ƒë∆°n h√†ng n√†y? H√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "‚úñ Hu·ª∑ ƒë∆°n",
            cancelButtonText: "ƒê√≥ng",
            confirmButtonColor: "#e74c3c",
            cancelButtonColor: "#6c757d",
            customClass: {
                confirmButton: 'btn btn-danger mx-2',
                cancelButton: 'btn btn-secondary'
            },
            buttonsStyling: false
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`${CONTEXT_PATH}/api/shipper/orders/${orderId}/cancel`, {
                    method: "PUT"
                })
                    .then(res => res.text())
                    .then(msg => {
                        Swal.fire({
                            icon: "success",
                            title: "ƒê√£ hu·ª∑!",
                            text: msg,
                            timer: 1800,
                            showConfirmButton: false
                        });
                        setTimeout(() => location.reload(), 1200);
                    })
                    .catch(err => Swal.fire("L·ªói!", "X·∫£y ra l·ªói khi hu·ª∑", "error"));
            }
        });
    }

</script>
<!-- Alert th√¥ng b√°o End-->
</body>

</html>