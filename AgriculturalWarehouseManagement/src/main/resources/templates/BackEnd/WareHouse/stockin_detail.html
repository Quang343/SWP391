<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head th:replace="BackEnd/fragments/WareHouse/head::head"></head>

<body>
<!-- tap on top start -->
<div class="tap-top">
    <i data-feather="chevrons-up"></i>
</div>
<!-- tap on tap end -->

<!-- page-wrapper Start -->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <div th:replace="BackEnd/fragments/WareHouse/header::header"></div>
    <!-- Page Header Ends-->

    <!-- Page Body Start-->
    <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div th:replace="BackEnd/fragments/WareHouse/sidebar::sidebar"></div>
        <!-- Page Sidebar Ends-->

        <!-- tracking section start -->
        <div class="page-body">
            <!-- tracking table start -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="title-header title-header-block package-card">
                                    <div>
                                        <h5>StockIn #<span id="stockInId"></span></h5>
                                    </div>
                                    <div class="card-order-section">
                                        <ul>
                                            <li id="stockInDate"></li>
                                            <li id="itemCount"></li>
                                            <li id="totalAmount"></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="bg-inner cart-section order-details-table">
                                    <div class="row g-4">
                                        <div class="col-xl-8">
                                            <div class="table-responsive table-details">
                                                <table class="table cart-table table-borderless">
                                                    <thead>
                                                    <tr>
                                                        <th colspan="2">Items</th>
                                                        <th class="text-end" colspan="2">
                                                            <a href="javascript:void(0)"
                                                               class="theme-color">Edit
                                                                Items</a>
                                                        </th>
                                                    </tr>
                                                    </thead>

                                                    <tbody id="stockInDetailTable">
                                                    <!-- Dữ liệu sẽ được tải động bằng JavaScript -->
                                                    </tbody>

                                                    <tfoot>
                                                    <tr class="table-order">
                                                        <td colspan="3">
                                                            <h5>Subtotal :</h5>
                                                        </td>
                                                        <td>
                                                            <h4 id="subtotal">$0.00</h4>
                                                        </td>
                                                    </tr>

                                                    <tr class="table-order">
                                                        <td colspan="3">
                                                            <h5>Shipping :</h5>
                                                        </td>
                                                        <td>
                                                            <h4>$12.00</h4>
                                                        </td>
                                                    </tr>

                                                    <tr class="table-order">
                                                        <td colspan="3">
                                                            <h5>Tax(GST) :</h5>
                                                        </td>
                                                        <td>
                                                            <h4>$10.00</h4>
                                                        </td>
                                                    </tr>

                                                    <tr class="table-order">
                                                        <td colspan="3">
                                                            <h4 class="theme-color fw-bold">Total Price :</h4>
                                                        </td>
                                                        <td>
                                                            <h4 class="theme-color fw-bold" id="totalPrice">$0.00</h4>
                                                        </td>
                                                    </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>

                                        <div class="col-xl-4">
                                            <div class="order-success">
                                                <div class="row g-4">
                                                    <h4>Summery</h4>
                                                    <ul class="order-details">
                                                        <li>StockIn ID: <span id="stockInIdSummary"></span></li>
                                                        <li>StockIn Date: <span id="stockInDateSummary"></span></li>
                                                        <li>Order Total: $<span id="totalAmountSummary"></span></li>
                                                    </ul>

                                                    <h4>Shipping Address</h4>
                                                    <ul class="order-details">
                                                        <li id="warehouseName">Warehouse Name</li>
                                                        <li>568, Suite Ave.</li>
                                                        <li>Australia, 235153 Contact No. 48465465465</li>
                                                    </ul>

                                                    <div class="payment-mode">
                                                        <h4>Payment Method</h4>
                                                        <p>Pay on Delivery (Cash/Card). Cash on delivery (COD)
                                                            available. Card/Net banking acceptance subject to device
                                                            availability.</p>
                                                    </div>

                                                    <div class="delivery-sec">
                                                        <h3>Expected Date of Delivery: <span id="expectedDeliveryDate"></span>
                                                        </h3>
                                                        <a href="order-tracking.html">Track Order</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- section end -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- tracking table end -->

            <div class="container-fluid">
                <!-- footer start-->
                <footer class="footer">
                    <div class="row">
                        <div class="col-md-12 footer-copyright text-center">
                            <p class="mb-0">Copyright 2022 © Fastkart theme by pixelstrap</p>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <!-- tracking section End -->
    </div>
</div>
<!-- page-wrapper End -->

<!-- Modal start -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                <p>Are you sure you want to log out?</p>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="button-box">
                    <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                    <button type="button" th:onclick="|window.location='@{backend/login}'|" class="btn btn--yes btn-primary">Yes</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal end -->

<!-- latest js -->
<script th:src="@{/Backend/assets/js/jquery-3.6.0.min.js}"></script>
<script th:src="@{/Backend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather.min.js}"></script>
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather-icon.js}"></script>
<script th:src="@{/Backend/assets/js/scrollbar/simplebar.js}"></script>
<script th:src="@{/Backend/assets/js/scrollbar/custom.js}"></script>
<script th:src="@{/Backend/assets/js/config.js}"></script>
<script th:src="@{/Backend/assets/js/customizer.js}"></script>
<script th:src="@{/Backend/assets/js/sidebar-menu.js}"></script>
<script th:src="@{/Backend/assets/js/notify/bootstrap-notify.min.js}"></script>
<script th:src="@{/Backend/assets/js/notify/index.js}"></script>
<script th:src="@{/Backend/assets/js/jquery.dataTables.js}"></script>
<script th:src="@{/Backend/assets/js/custom-data-table.js}"></script>
<script th:src="@{/Backend/assets/js/sidebareffect.js}"></script>
<script th:src="@{/Backend/assets/js/script.js}"></script>

<!-- Custom JavaScript -->
<script>
    $(document).ready(function() {
        // Kiểm tra stockInId từ URL
        const urlParams = new URLSearchParams(window.location.search);
        const stockInId = urlParams.get('stockInId');
        if (!stockInId) {
            alert('Please select a StockIn ID from the StockIn list first.');
            window.location.href = '/warehouse/stockin'; // Chuyển hướng về trang stockin-list
            return;
        }
        console.log('StockIn ID từ URL:', stockInId);

        // Hiển thị StockIn ID
        $('#stockInId').text(stockInId);
        $('#stockInIdSummary').text(stockInId);

        // Tải dữ liệu StockInDetail
        $.ajax({
            url: `http://localhost:8080/api/stockins/${stockInId}/details`,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                console.log('Danh sách StockInDetail được tải thành công:', data);
                const tbody = $('#stockInDetailTable');
                tbody.empty();
                let totalAmount = 0;
                let itemCount = data.length;

                $.each(data, function(index, detail) {
                    const unitPrice = parseFloat(detail.unitPrice) || 0;
                    const quantity = parseInt(detail.quantity) || 0;
                    const subTotal = unitPrice * quantity;
                    totalAmount += subTotal;

                    const row = `
                        <tr class="table-order">
                            <td>
                                <a href="javascript:void(0)">
                                    <img src="assets/images/profile/${index + 1}.jpg" class="img-fluid blur-up lazyload" alt="">
                                </a>
                            </td>
                            <td>
                                <p>Product Name</p>
                                <h5>${detail.productDetailID || 'N/A'}</h5>
                            </td>
                            <td>
                                <p>Quantity</p>
                                <h5>${quantity}</h5>
                            </td>
                            <td>
                                <p>Price</p>
                                <h5>$${unitPrice.toFixed(2)}</h5>
                            </td>
                        </tr>
                    `;
                    tbody.append(row);
                });

                // Cập nhật thông tin (thêm cột batchID vào bảng chi tiết)
                const stockInDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                $('#stockInDate').text(stockInDate);
                $('#stockInDateSummary').text(stockInDate);
                $('#itemCount').text(`${itemCount} items`);
                $('#totalAmount').text(`$${totalAmount.toFixed(2)}`);
                $('#totalAmountSummary').text(totalAmount.toFixed(2));
                $('#subtotal').text(`$${totalAmount.toFixed(2)}`);
                $('#totalPrice').text(`$${((totalAmount + 12 + 10).toFixed(2))}`); // Subtotal + Shipping + Tax
                $('#expectedDeliveryDate').text(new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }));
                $('#warehouseName').text(`Warehouse ${stockInId}`);

                // Thêm cột batchID vào bảng chi tiết
                $.each(data, function(index, detail) {
                    const batchId = detail.batchID || 'N/A';
                    $('#stockInDetailTable tr:nth-child(' + (index + 1) + ')').append(`
                        <td>
                            <p>Batch ID</p>
                            <h5>${batchId}</h5>
                        </td>
                    `);
                });
            },
            error: function(xhr, status, error) {
                console.error('Lỗi khi tải StockInDetail:', {
                    status: status,
                    error: error,
                    response: xhr.responseText
                });
                $('#stockInDetailTable').html('<tr><td colspan="4">Failed to load details. Check console.</td></tr>');
            }
        });
    });
</script>

</body>
</html>