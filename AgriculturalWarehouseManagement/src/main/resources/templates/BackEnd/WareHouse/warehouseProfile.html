<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Fastkart admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords"
          content="admin template, Fastkart admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="assets/images/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon">
    <title>AgriKho - Dashboard</title>

    <!-- Google font -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link
            href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

    <!-- Linear Icon css -->
    <link rel="stylesheet" th:href="@{/Backend/assets/css/linearicon.css}">

    <!-- remixicon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/remixicon.css}">

    <!-- fontawesome css  -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/font-awesome.css}">

    <!-- Themify icon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/themify.css}">

    <!--Drop zon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/dropzone.css}">

    <!-- Feather icon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/feather-icon.css}">

    <!-- Select2 css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/select2.min.css}">

    <!-- Plugins css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/scrollbar.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/animate.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/chartist.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/date-picker.css}">

    <!-- Bootstrap css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/bootstrap.css}">

    <!-- Bootstrap-tag input css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/bootstrap-tagsinput.css}">

    <!-- App css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/style.css}">

    <link href="https://cdn.materialdesignicons.com/4.4.95/css/materialdesignicons.min.css" rel="stylesheet" />

    <style>
        body {
            background-color: #f8f9fa;
        }

        .profile-card {
            margin-bottom: 40px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color: #fff;
        }

        .profile-header {
            background: linear-gradient(135deg, rgb(110 211 191), rgb(110 211 191));
            color: #fff;
            text-align: center;
            padding: 40px 20px;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
        }

        .profile-form {
            padding: 30px;
        }

        .profile-form label {
            font-weight: 600;
        }

        .profile-actions {
            padding: 20px 30px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
        }

        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, .25);
        }

        .btn-primary {
            background-color: rgb(76, 210, 181) !important;
            border-color: rgb(76, 210, 181) !important;
        }

        .btn-primary:hover {
            background-color: rgb(59, 190, 162) !important;
            border-color: rgb(59, 190, 162) !important;
        }

        .avatar-wrapper {
            position: relative;
            display: inline-block;
        }

        .edit-avatar-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            border-radius: 50%;
            padding: 5px 7px;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .edit-avatar-btn i {
            color: #333;
            font-size: 14px;
        }

        .edit-avatar-btn:hover {
            background-color: #6ed3bf;
            transform: scale(1.1);
        }

        .edit-avatar-btn:hover i {
            color: #000;
        }

        .form-control:focus {
            box-shadow: 1px 2px 2px rgba(13, 110, 253, .25);
            border-color: #ccc;
        }
        .nav{
            font-size: 1rem;
            padding-left: 0 !important;
        }

        #changePasswordMessage.alert-danger {
            color: #842029;
            background-color: #f8d7da;
            border-color: #f5c2c7;
        }

        .styled-tab .nav-link {
            background: transparent;
            color: #333;
            border: none;
            border-radius: 0;                      /* bo góc vuông */
            padding: 10px 20px;
            font-weight: 500;
            transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease;
        }
        .nav-tabs .nav-link.active{
            border: none;
        }

        .styled-tab .nav-link:hover {
            background-color: #e2f6f1;
            color: #000;
            border-color: #b8eee1;
            border-bottom: 2px solid #15cba4;
        }

        .styled-tab .nav-link.active {
            color: #6f5757;
            border-bottom: 2px solid #15cba4;
            background: linear-gradient(360deg, rgb(110 211 191 / 75%) 30%, rgb(0 255 196 / 19%) 100%);
        }

        .styled-tab i {
            font-size: 16px;
            vertical-align: middle;
        }

        @media (max-width: 576px) {
            .styled-tab .nav-link {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        .change-password-form{
            padding: 20px;
        }

        .change-password-form label{
            font-weight: 600;
        }

    </style>
</head>

<body>
<!-- tap on top start-->
<div class="tap-top">
    <span class="lnr lnr-chevron-up"></span>
</div>
<!-- tap on tap end-->

<!-- page-wrapper Start-->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <div th:replace="BackEnd/fragments/Admin/header::header"></div>
    <!-- Page Header Ends-->

    <!-- Page Body Start-->
    <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div th:replace="BackEnd/fragments/Admin/sidebar::sidebar"></div>
        <!-- Page Sidebar Ends-->

        <!-- Settings Section Start -->
        <div class="page-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-12">
                                <!-- Details Start -->
                                <!--
                                <div class="card">
                                    <div class="card-body">
                                        <div class="title-header option-title">
                                            <h5>Profile Setting</h5>
                                        </div>
                                        <form class="theme-form theme-form-2 mega-form">
                                            <div class="row">
                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">First Name</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="text"
                                                               placeholder="Enter Your First Name">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">Last Name</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="text"
                                                               placeholder="Enter Your Last Name">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">Your Phone
                                                        Number</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="number"
                                                               placeholder="Enter Your Number">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">Enter Email
                                                        Address</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="email"
                                                               placeholder="Enter Your Email Address">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label
                                                            class="col-sm-2 col-form-label form-label-title">Photo</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control form-choose" type="file"
                                                               id="formFileMultiple" multiple>
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">Password</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="password"
                                                               placeholder="Enter Your Password">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <label class="form-label-title col-sm-2 mb-0">Confirm
                                                        Password</label>
                                                    <div class="col-sm-10">
                                                        <input class="form-control" type="password"
                                                               placeholder="Enter Your Confirm Passowrd">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                -->

                                <!-- Tabs điều hướng -->
                                <ul class="nav nav-tabs styled-tab mb-3 px-4 pt-4" id="profileTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit" type="button" role="tab">
                                            <i class="bi bi-person-lines-fill me-1"></i> Thông tin cá nhân
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="password-tab" data-bs-toggle="tab" data-bs-target="#password" type="button" role="tab">
                                            <i class="ri-lock-2-fill"></i> Thay đổi mật khẩu
                                        </button>
                                    </li>
                                </ul>

                                <!-- Tab nội dung -->
                                <div class="tab-content" id="profileTabContent">
                                    <!-- Tab 1: Chỉnh sửa thông tin -->
                                    <div class="tab-pane fade show active" id="edit" role="tabpanel">
                                        <div class="cart profile-card">
                                            <!-- Avatar + Header -->
                                            <div class="profile-header position-relative">
                                                <div class="avatar-wrapper">
                                                    <img id="avatarPreview" th:src="@{'/admin/' + ${user.getImage()}}"
                                                         alt="Admin Avatar" class="profile-avatar mb-3">
                                                    <button type="button" class="btn btn-sm btn-light edit-avatar-btn"
                                                            onclick="document.getElementById('avatarInput').click()">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                </div>
                                                <h2 class="mb-0" th:text="${user.fullName}">Admin Name</h2>
                                                <small class="text-light">Administrator</small>
                                            </div>

                                            <!-- Form -->
                                            <form class="profile-form" method="post"
                                                  th:action="@{/admin/profile/update}" enctype="multipart/form-data">
                                                <input type="hidden" name="_method" value="put"/>
                                                <input type="file" id="avatarInput" name="image" accept="image/*"
                                                       style="display: none;">
                                                <div class="row g-3">
                                                    <!-- giữ nguyên toàn bộ input như bạn đã có -->
                                                    <div class="col-md-6">
                                                        <label>Họ và tên</label>
                                                        <input type="text" name="fullName" class="form-control"
                                                               th:value="${user.fullName}" placeholder="Nhập họ và tên">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Email</label>
                                                        <input type="email" name="email" class="form-control"
                                                               th:value="${user.email}" placeholder="Nhập email">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Số điện thoại</label>
                                                        <input type="text" name="phone" class="form-control"
                                                               th:value="${user.phone}"
                                                               placeholder="Nhập số điện thoại">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Địa chỉ</label>
                                                        <input type="text" name="address" class="form-control"
                                                               th:value="${user.address}" placeholder="Nhập địa chỉ">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Giới tính</label>
                                                        <select class="form-select" name="gender">
                                                            <option disabled value="">Chọn...</option>
                                                            <option value="Male" th:selected="${user.gender == 'Male'}">
                                                                Nam
                                                            </option>
                                                            <option value="Female"
                                                                    th:selected="${user.gender == 'Female'}">Nữ
                                                            </option>
                                                            <option value="Other"
                                                                    th:selected="${user.gender == 'Other'}">Khác
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label>Ngày sinh</label>
                                                        <input type="date" name="dob" class="form-control"
                                                               th:value="${user.dob}">
                                                    </div>
                                                </div>

                                                <div class="mb-4 row align-items-center">
                                                    <div id="error-message"
                                                         class="alert alert-danger d-none"
                                                         role="alert"></div>
                                                </div>

                                                <div class="profile-actions mt-4">
                                                    <button type="submit" class="save-btn btn btn-primary">
                                                        <i class="bi bi-save me-1"></i> Lưu thay đổi
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Tab 2: Đổi mật khẩu -->
                                    <div class="tab-pane fade" id="password" role="tabpanel">
                                        <div class="cart profile-card">
                                            <div class="change-password-form">
                                                <form id="changePasswordForm" method="post"
                                                      th:action="@{/admin/profile/change-password}">
                                                    <input type="hidden" name="_method" value="put"/>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label>Mật khẩu hiện tại</label>
                                                            <input type="password" name="currentPassword"
                                                                   class="form-control"
                                                                   placeholder="Nhập mật khẩu hiện tại" required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label>Mật khẩu mới</label>
                                                            <input type="password" name="newPassword"
                                                                   class="form-control" placeholder="Nhập mật khẩu mới"
                                                                   required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label>Xác nhận mật khẩu mới</label>
                                                            <input type="password" name="confirmPassword"
                                                                   class="form-control"
                                                                   placeholder="Nhập lại mật khẩu mới" required>
                                                        </div>
                                                    </div>
                                                    <!-- Thông báo -->
                                                    <div class="mt-3">
                                                        <div id="changePasswordMessage" class="alert d-none"
                                                             role="alert">
                                                        </div>
                                                    </div>
                                                    <div class="profile-actions mt-4">
                                                        <button type="submit" class="save-btn btn btn-primary">
                                                            <i class="bi bi-shield-lock me-1"></i> Đổi mật khẩu
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <!-- Details End -->

                                <!-- Address Start -->
                                <div class="card">
                                    <div class="card-body">
                                        <div class="card-header-2 mb-3">
                                            <h5>Address</h5>
                                        </div>

                                        <div class="save-details-box">
                                            <div class="row g-4" th:each="address : ${user.getMyAddressBooks()}">
                                                <div class="col-xl-4 col-md-6">
                                                    <div class="save-details">
                                                        <div class="save-name">
                                                            <h5 th:text="${address.getFullName()}">Mark Jugal</h5>
                                                        </div>

                                                        <div class="save-position">
                                                            <h6 th:text="${address.setToAddress}">Home</h6>
                                                        </div>

                                                        <div class="save-address">
                                                            <p th:text="'Địa chỉ: ' +  ${address.address}">549 Sulphur Springs Road</p>
                                                            <p th:text="'Ghi chú: ' +  ${address.note}">Downers Grove, IL</p>
                                                        </div>

                                                        <div class="mobile">
                                                            <p class="mobile" th:text="'Phone: ' + ${address.phone}">Mobile No. +1-123-456-7890</p>
                                                        </div>

                                                        <div class="email">
                                                            <p class="email" th:text="'Email: ' + ${address.email}">Mobile No. +1-123-456-7890</p>
                                                        </div>

                                                        <div class="button">
                                                            <a href="javascript:void(0)" class="btn btn-sm">Edit</a>
                                                            <a href="javascript:void(0)"
                                                               class="btn btn-sm">Remove</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Address End -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Settings Section End -->
    </div>
    <!-- Page Body End-->

    <!-- footer start-->
    <div th:replace="BackEnd/fragments/Admin/footer::footer"></div>
    <!-- footer End-->
</div>
<!-- page-wrapper End-->

<!-- Modal Start -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                <p>Are you sure you want to log out?</p>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="button-box">
                    <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                    <button type="button" onclick="location.href = 'login.html';"
                            class="btn  btn--yes btn-primary">Yes
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal End -->

<!-- Modal thông báo tái sử dụng -->
<div class="modal fade theme-modal remove-coupon" id="resultModal" aria-hidden="true" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center" id="resultModalTitle">Done</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="remove-box text-center">
                    <div id="resultModalIcon" class="wrapper">
                        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    <h4 id="resultModalMessage" class="text-content">It's Removed.</h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<!-- Delete Modal Box End -->


<!-- latest jquery-->
<script th:src="@{/Backend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{/Backend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>

<!-- feather icon js-->
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather.min.js}"></script>
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather-icon.js}"></script>

<!-- scrollbar simplebar js-->
<script th:src="@{/Backend/assets/js/scrollbar/simplebar.js}"></script>
<script th:src="@{/Backend/assets/js/scrollbar/custom.js}"></script>

<!-- Sidebar jquery-->
<script th:src="@{/Backend/assets/js/config.js}"></script>
<!-- Plugins JS start-->

<!-- bootstrap tag-input JS start-->
<script th:src="@{/Backend/assets/js/bootstrap-tagsinput.min.js}"></script>
<script th:src="@{/Backend/assets/js/sidebar-menu.js}"></script>

<!-- customizer js start  -->
<script th:src="@{/Backend/assets/js/customizer.js}"></script>
<!-- customizer js end -->

<!--Dropzon start-->
<script th:src="@{/Backend/assets/js/dropzone/dropzone.js}"></script>
<script th:src="@{/Backend/assets/js/dropzone/dropzone-script.js}"></script>

<!--Dropzon start-->
<script th:src="@{/Backend/assets/js/notify/bootstrap-notify.min.js}"></script>
<script th:src="@{/Backend/assets/js/notify/index.js}"></script>
<!-- Plugins JS Ends-->

<!-- Theme js-->
<script th:src="@{/Backend/assets/js/script.js}"></script>

<script>
    function showModal(status, message) {
        const title = document.getElementById('resultModalTitle');
        const icon = document.getElementById('resultModalIcon');
        const msg = document.getElementById('resultModalMessage');

        title.innerText = status === 'success' ? 'Hoàn tất' : 'Thất bại!';

        icon.innerHTML = status === 'success' ?
            `<svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>` :
            `<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                <path fill="#f44336" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path><path fill="#fff" d="M29.656,15.516l2.828,2.828l-14.14,14.14l-2.828-2.828L29.656,15.516z"></path><path fill="#fff" d="M32.484,29.656l-2.828,2.828l-14.14-14.14l2.828-2.828L32.484,29.656z"></path>
                </svg>`;
        msg.innerText = message;

        const modalElement = document.getElementById('resultModal');
        const modal = new bootstrap.Modal(modalElement);
        modal.show();

        setTimeout(() => {
            const existing = bootstrap.Modal.getInstance(modalElement);
            if (existing) {
                existing.hide();
            }
        }, 1000);
    }
</script>

<script>
    document.getElementById('avatarInput').addEventListener('change', function (event) {
        const file = event.target.files[0];
        const preview = document.getElementById('avatarPreview');

        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>

<script>

    document.querySelector('.profile-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = this;

        const formData = new FormData(form);

        // if (selectedImageFile) {
        //     formData.set("image", selectedImageFile);
        // }

        const errorDiv = document.getElementById('error-message');
        errorDiv.classList.add('d-none');
        errorDiv.textContent = "";

        try {
            const response = await fetch(form.action, {
                method: "PUT",
                body: formData,
            });
            if (!response.ok) {
                const contentType = response.headers.get("content-type");
                let msg = "Lỗi không xác định";

                if (contentType && contentType.includes("application/json")) {
                    const errorData = await response.json();
                    msg = typeof errorData === 'object'
                        ? Object.values(errorData).join('\n')
                        : JSON.stringify(errorData);
                } else {
                    msg = await response.text();
                }
                errorDiv.textContent = msg;
                errorDiv.classList.remove('d-none');
                console.error("Chi tiết lỗi cập nhật:", msg);
                throw new Error("Lỗi khi update user");
            }
            showModal("success", "Cập nhật thành công");
            setTimeout(() => {
                location.reload();
            }, 1000);
        } catch (e) {
            console.error("Lỗi khi gửi form:", e);
        }
    })

</script>

<script>
    const passwordForm = document.getElementById("changePasswordForm");
    if (passwordForm) {
        passwordForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const messageBox = document.getElementById("changePasswordMessage");

            fetch(form.action, {
                method: "PUT",
                body: new URLSearchParams(formData),
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                }
            })
                .then(res => res.json())
                .then(data => {
                    messageBox.classList.remove("d-none", "alert-danger", "alert-success");
                    if (data.success) {
                        showModal("success", data.message);
                        form.reset(); // Clear form if successful
                        messageBox.innerHTML = '';
                    } else {
                        messageBox.classList.add("alert-danger");
                        messageBox.innerHTML =
                            `${data.success ? '' :
                                '<i class="fa fa-exclamation-circle me-2" style="font-size: 18px; color: #bb0032;"></i>'}
                        ${data.message}
                    `;
                        form.reset();
                    }
                })
                .catch(err => {
                    messageBox.classList.remove("d-none");
                    messageBox.classList.add("alert-danger");
                    messageBox.textContent = "Có lỗi xảy ra. Vui lòng thử lại.";
                });
        });
    }
</script>


</body>

</html>