
<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{BackEnd/fragments/WareHouse/head::head}"></head>

<body>
<!-- tap on top start -->
<div class="tap-top">
    <span class="lnr lnr-chevron-up"></span>
</div>
<!-- tap on tap end -->

<!-- page-wrapper start -->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <div th:replace="~{BackEnd/fragments/WareHouse/header::header}"></div>
    <!-- Page Header Ends-->

    <!-- Page Body start -->
    <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div th:replace="~{BackEnd/fragments/WareHouse/sidebar::sidebar}"></div>
        <!-- Page Sidebar Ends-->

        <div class="page-body">

            <!-- New Product Add Start -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-8 m-auto">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="card-header-2">
                                            <h5>Add Supplier Information</h5>
                                        </div>

                                        <div class="theme-form theme-form-2 mega-form">
                                            <!-- Supplier Name -->
                                            <div class="mb-4 row align-items-center">
                                                <label class="form-label-title col-sm-3 mb-0">Supplier Name</label>
                                                <div class="col-sm-9">
                                                    <input id="supplierName" class="form-control" type="text" placeholder="Supplier Name">
                                                </div>
                                            </div>

                                            <!-- Contact Information -->
                                            <div class="mb-4 row align-items-center">
                                                <label class="form-label-title col-sm-3 mb-0">Contact Information</label>
                                                <div class="col-sm-9">
                                                    <input id="contactInfo" class="form-control" type="text" placeholder="Contact Information">
                                                </div>
                                            </div>

                                            <!-- Supplier Logo (Image Upload) -->
                                            <div class="mb-4 row align-items-center">
                                                <label class="col-sm-3 col-form-label form-label-title">Supplier Logo</label>
                                                <div class="form-group col-sm-9">
                                                    <form class="dropzone custom-dropzone" id="logoUpload" action="/api/suppliers/uploadLogo" method="POST" enctype="multipart/form-data">
                                                        <div class="dropzone-wrapper">
                                                            <div class="dz-message needsclick">
                                                                <div>
                                                                    <i class="icon-cloud-up"></i>
                                                                    <h6>Drop files here or click to upload.</h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="card-submit-button">
                                        <button id="submitButton" class="btn btn-animation ms-auto" type="button">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- New Product Add End -->

            <!-- footer Start -->
            <div class="container-fluid">
                <footer class="footer">
                    <div class="row">
                        <div class="col-md-12 footer-copyright text-center">
                            <p class="mb-0">Copyright 2022 © Fastkart theme by pixelstrap</p>
                        </div>
                    </div>
                </footer>
            </div>
            <!-- footer En -->
        </div>
        <!-- Container-fluid End -->
    </div>
    <!-- Page Body End -->
</div>
<!-- page-wrapper End -->

<!-- Modal Start -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                <p>Are you sure you want to log out?</p>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="button-box">
                    <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                    <button type="button" onclick="location.href = 'login.html';"
                            class="btn  btn--yes btn-primary">Yes</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal End -->

<script>
    document.getElementById('submitButton').addEventListener('click', function () {
        // Lấy các giá trị từ các trường nhập liệu
        const supplierName = document.getElementById('supplierName').value;
        const contactInfo = document.getElementById('contactInfo').value;

        // Lấy logo (sử dụng Dropzone để lấy file)
        const logoFile = document.querySelector('.dropzone .dz-preview .dz-image img');

        // Kiểm tra nếu tất cả thông tin đều hợp lệ
        if (!supplierName || !contactInfo || !logoFile) {
            alert('Please fill in all fields and upload a logo.');
            return;
        }

        // Tạo đối tượng FormData
        const formData = new FormData();
        formData.append('file', logoFile.src);  // Đảm bảo là trường 'file' tương ứng với tham số trong controller

        // Tạo một đối tượng SupplierDTO (chứa tên và thông tin nhà cung cấp)
        const supplierDTO = {
            supplierName: supplierName,
            contactInfo: contactInfo,
        };

        // Gửi yêu cầu POST tới API upload logo
        fetch('/api/suppliers/uploadLogo', {
            method: 'POST',
            body: formData  // Gửi formData chứa file
        })
            .then(response => response.json())
            .then(data => {
                console.log('File uploaded successfully:', data);

                // Sau khi upload thành công, gửi dữ liệu nhà cung cấp
                return fetch('/api/suppliers/createSupplier', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(supplierDTO)
                });
            })
            .then(response => response.json())
            .then(data => {
                alert('Supplier created successfully!');
                // Reset form sau khi thành công
                document.getElementById('supplierName').value = '';
                document.getElementById('contactInfo').value = '';
                Dropzone.forElement("#logoUpload").removeAllFiles();  // Reset Dropzone
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while uploading the logo or creating the supplier.');
            });
    });

</script>



<!-- latest js -->
<script th:src="@{/Backend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- Bootstrap js -->
<script th:src="@{/Backend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>

<!-- feather icon js -->
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather.min.js}"></script>
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather-icon.js}"></script>

<!-- scrollbar simplebar js -->
<script th:src="@{/Backend/assets/js/scrollbar/simplebar.js}"></script>
<script th:src="@{/Backend/assets/js/scrollbar/custom.js}"></script>

<!-- Sidebar js -->
<script th:src="@{/Backend/assets/js/config.js}"></script>

<!-- customizer js -->
<script th:src="@{/Backend/assets/js/customizer.js}"></script>

<!-- Plugins js -->
<script th:src="@{/Backend/assets/js/sidebar-menu.js}"></script>
<script th:src="@{/Backend/assets/js/notify/bootstrap-notify.min.js}"></script>
<script th:src="@{/Backend/assets/js/notify/index.js}"></script>

<!-- Data table js -->
<script th:src="@{/Backend/assets/js/jquery.dataTables.js}"></script>
<script th:src="@{/Backend/assets/js/custom-data-table.js}"></script>

<!-- sidebar effect -->
<script th:src="@{/Backend/assets/js/sidebareffect.js}"></script>

<!-- Theme js -->
<script th:src="@{/Backend/assets/js/script.js}"></script>

<!--Dropzon js -->
<script th:src="@{/Backend/assets/js/dropzone/dropzone.js}"></script>
<script th:src="@{/Backend/assets/js/dropzone/dropzone-script.js}"></script>



<!-- select2 js -->
<script th:src="@{/Backend/assets/js/select2.min.js}"></script>
<script th:src="@{/Backend/assets/js/select2-custom.js}"></script>


</body>

</html>