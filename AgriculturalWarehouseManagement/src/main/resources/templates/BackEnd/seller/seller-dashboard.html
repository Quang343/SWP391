<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="FrontEnd/fragments/head::head"></head>


<body>

<!-- Loader Start -->
<div class="fullpage-loader">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>
<!-- Loader End -->

<!-- Header Start -->
<!--<header th:replace="FrontEnd/fragments/header::header"></header>-->
<!-- Header End -->

<!-- mobile fix menu start -->
<div class="mobile-menu d-md-none d-block mobile-cart">
    <ul>
        <li>
            <a href="index.html">
                <i class="iconly-Home icli"></i>
                <span>Home</span>
            </a>
        </li>

        <li class="mobile-category">
            <a href="javascript:void(0)">
                <i class="iconly-Category icli js-link"></i>
                <span>Category</span>
            </a>
        </li>

        <li>
            <a href="search.html" class="search-box">
                <i class="iconly-Search icli"></i>
                <span>Search</span>
            </a>
        </li>

        <li>
            <a href="wishlist.html" class="notifi-wishlist">
                <i class="iconly-Heart icli"></i>
                <span>My Wish</span>
            </a>
        </li>

        <li>
            <a href="cart.html">
                <i class="iconly-Bag-2 icli fly-cate"></i>
                <span>Cart</span>
            </a>
        </li>
    </ul>
</div>
<!-- mobile fix menu end -->

<!-- Breadcrumb Section Start -->
<section class="breadcrumb-section pt-0">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb-contain">
                    <h2>Qu·∫£n L√Ω B√°n H√†ng</h2>
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="home">
                                    <i class="fa-solid fa-house" title="Trang ch·ªß"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active">
                                <a href="seller-dashboard">
                                    Qu·∫£n l√Ω b√°n h√†ng
                                </a>
                            </li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- User Dashboard Section Start -->
<section class="user-dashboard-section section-b-space">
    <div class="container-fluid-lg">
        <div class="row">
            <div class="col-xxl-3 col-lg-4">
                <div class="dashboard-left-sidebar">
                    <div class="close-button d-flex d-lg-none">
                        <button class="close-sidebar">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    <div class="profile-box">
                        <div class="cover-image position-relative">
                            <img id="coverImage"
                                 src="/AgriculturalWarehouseManagementApplication/Backend/assets/images/user/default-cover.jpg"
                                 class="img-fluid blur-up lazyload" alt="">

                            <!-- N√∫t ch·ªânh s·ª≠a ·∫£nh b√¨a (sau n√†y d√πng ti·∫øp ƒë∆∞·ª£c) -->
                            <!--                            <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-2 edit-cover-btn" title="ƒê·ªïi ·∫£nh b√¨a">-->
                            <!--                                <i class="fa-solid fa-pen"></i>-->
                            <!--                            </button>-->
                        </div>


                        <div class="profile-contain">
                            <div class="profile-image">
                                <div class="position-relative avatar-wrapper">
                                    <img id="avatarImage"
                                         src="/AgriculturalWarehouseManagementApplication/Backend/assets/images/user/default-avatar.png"
                                         class="avatar-img" alt="">

                                    <!-- N√∫t ch·ªânh s·ª≠a ·∫£nh avatar -->
                                    <button class="btn btn-sm btn-light position-absolute edit-avatar-btn"
                                            title="ƒê·ªïi ·∫£nh ƒë·∫°i di·ªán">
                                        <i class="fa-solid fa-camera"></i>
                                    </button>


                                    <!-- üîç N√∫t zoom -->
                                    <button class="btn btn-sm btn-light position-absolute zoom-avatar-btn"
                                            title="Ph√≥ng to ·∫£nh">
                                        <i class="fa-solid fa-magnifying-glass-plus"></i>
                                    </button>

                                    <!-- File input -->
                                    <input type="file" id="avatarInput" style="display: none;" accept="image/*">
                                </div>
                            </div>


                            <div class="profile-name">
                                <h3 id="usernameDisplay">username m·∫∑c ƒë·ªãnh</h3>
                                <h6 class="text-content" id="emailDisplay">email@example.com</h6>
                            </div>

                        </div>
                    </div>

                    <ul class="nav nav-pills user-nav-pills" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-profile" type="button" role="tab">
                                <i data-feather="user"></i> H·ªì s∆°
                            </button>
                        </li>

                        <!--                        <li class="nav-item" role="presentation">-->
                        <!--                            <a href="#pills-tabContent" class="nav-link" id="pills-dashboard-tab"-->
                        <!--                               data-bs-toggle="pill" data-bs-target="#pills-dashboard" role="tab">-->
                        <!--                                <i data-feather="layout"></i> T·ªïng quan-->
                        <!--                            </a>-->
                        <!--                        </li>-->

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-product-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-product" type="button" role="tab">
                                <i data-feather="package"></i> S·∫£n ph·∫©m
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-product-detail-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-product-detail" type="button" role="tab">
                                <i data-feather="file-text"></i> Chi ti·∫øt s·∫£n ph·∫©m
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-order" type="button" role="tab">
                                <i data-feather="clipboard"></i> ƒê∆°n h√†ng
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="pills-out-tab"
                               href="http://localhost:8080/AgriculturalWarehouseManagementApplication/logoutUser"
                               role="tab">
                                <i data-feather="log-out"></i> ƒêƒÉng xu·∫•t
                            </a>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="col-xxl-9 col-lg-8">
                <button class="btn left-dashboard-show btn-animation btn-md fw-bold d-block mb-4 d-lg-none">Show
                    Menu
                </button>
                <div class="dashboard-right-sidebar">

                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show" id="pills-dashboard" role="tabpanel">
                            <div class="dashboard-home">
                                <div class="title">
                                    <h2>T·ªïng Quan</h2>
                                    <span class="title-leaf">
                                            <svg class="icon-width bg-gray">
                                                <use xlink:href="../assets/svg/leaf.svg#leaf"></use>
                                            </svg>
                                        </span>
                                </div>

                                <div class="dashboard-user-name">
                                    <h6 class="text-content">Hello, <b class="text-title">Vicki E. Pope</b></h6>
                                    <p class="text-content">From your My Account Dashboard you have the ability to
                                        view a snapshot of your recent account activity and update your account
                                        information. Select a link below to view or edit information.</p>
                                </div>

                                <div class="total-box">
                                    <div class="row g-sm-4 g-3">
                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/order.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/order.svg" class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>Total Products</h5>
                                                    <h3>25</h3>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/pending.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/pending.svg" class="blur-up lazyload"
                                                     alt="">
                                                <div class="total-detail">
                                                    <h5>Total Sales</h5>
                                                    <h3>12550</h3>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xxl-4 col-lg-6 col-md-4 col-sm-6">
                                            <div class="total-contain">
                                                <img src="../assets/images/svg/wishlist.svg"
                                                     class="img-1 blur-up lazyload" alt="">
                                                <img src="../assets/images/svg/wishlist.svg"
                                                     class="blur-up lazyload" alt="">
                                                <div class="total-detail">
                                                    <h5>Order Pending</h5>
                                                    <h3>36</h3>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row g-4">
                                    <div class="col-xxl-6">
                                        <div class="dashboard-bg-box">
                                            <div id="chart"></div>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="dashboard-bg-box">
                                            <div id="sale"></div>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="table-responsive dashboard-bg-box">
                                            <div class="dashboard-title mb-4">
                                                <h3>Trending Products</h3>
                                            </div>

                                            <table class="table product-table">
                                                <thead>
                                                <tr>
                                                    <th scope="col">·∫¢nh</th>
                                                    <th scope="col">T√™n</th>
                                                    <th scope="col">Gi√°</th>
                                                    <th scope="col">Sales</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/1.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Fantasy Crunchy Choco Chip Cookies</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$25.69</h6>
                                                    </td>
                                                    <td>
                                                        <h6>152</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/2.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Peanut Butter Bite Premium Butter Cookies 600 g</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$35.36</h6>
                                                    </td>
                                                    <td>
                                                        <h6>34</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/3.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>Yumitos Chilli Sprinkled Potato Chips 100 g</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$78.55</h6>
                                                    </td>
                                                    <td>
                                                        <h6>78</h6>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td class="product-image">
                                                        <img src="../assets/images/vegetable/product/4.png"
                                                             class="img-fluid" alt="">
                                                    </td>
                                                    <td>
                                                        <h6>healthy Long Life Toned Milk 1 L</h6>
                                                    </td>
                                                    <td>
                                                        <h6>$32.98</h6>
                                                    </td>
                                                    <td>
                                                        <h6>135</h6>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="col-xxl-6">
                                        <div class="order-tab dashboard-bg-box">
                                            <div class="dashboard-title mb-4">
                                                <h3>Recent Order</h3>
                                            </div>

                                            <div class="table-responsive">
                                                <table class="table order-table">
                                                    <thead>
                                                    <tr>
                                                        <th scope="col">Order ID</th>
                                                        <th scope="col">Product Name</th>
                                                        <th scope="col">Status</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td class="product-image">#254834</td>
                                                        <td>
                                                            <h6>Choco Chip Cookies</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#355678</td>
                                                        <td>
                                                            <h6>Premium Butter Cookies</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#647536</td>
                                                        <td>
                                                            <h6>Sprinkled Potato Chips</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#125689</td>
                                                        <td>
                                                            <h6>Milk 1 L</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#215487</td>
                                                        <td>
                                                            <h6>Raw Mutton Leg</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#365474</td>
                                                        <td>
                                                            <h6>Instant Coffee</h6>
                                                        </td>
                                                        <td>
                                                            <label class="success">Shipped</label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td class="product-image">#368415</td>
                                                        <td>
                                                            <h6>Jowar Stick and Jowar Chips</h6>
                                                        </td>
                                                        <td>
                                                            <label class="danger">Pending</label>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-product" role="tabpanel">
                            <div class="product-tab">
                                <div class="title"
                                     style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h2>T·∫•t C·∫£ S·∫£n Ph·∫©m</h2>

                                    </div>

                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">
                                        <button class="btn btn-success"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductModal"
                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">
                                            + Th√™m S·∫£n Ph·∫©m
                                        </button>
                                    </div>
                                </div>

                                <div class="table-responsive dashboard-bg-box">
                                    <table class="table product-table">
                                        <thead>
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">·∫¢nh</th>
                                            <th>
                                                <div class="header-with-sort">
                                                    <span>T√™n </span>
                                                    <div class="sort-buttons">
                                                        <button class="btn-sort" data-key="name" data-order="asc"
                                                                title="A-Z">‚ñ≤
                                                        </button>
                                                        <button class="btn-sort" data-key="name" data-order="desc"
                                                                title="Z-A">‚ñº
                                                        </button>
                                                    </div>
                                                </div>
                                            </th>
                                            <th>
                                                <div class="header-with-sort">
                                                    <span>Danh m·ª•c</span>
                                                    <div class="sort-buttons">
                                                        <button class="btn-sort" data-key="category" data-order="asc"
                                                                title="A-Z">‚ñ≤
                                                        </button>
                                                        <button class="btn-sort" data-key="category" data-order="desc"
                                                                title="Z-A">‚ñº
                                                        </button>
                                                    </div>
                                                </div>
                                            </th>
                                            <th scope="col">M√¥ t·∫£</th>
                                            <th scope="col">Tr·∫°ng th√°i</th>
                                            <th scope="col">Thao t√°c</th>
                                        </tr>
                                        </thead>
                                        <tbody id="productTable">
                                        <!-- B·ªè th:each ƒëi -->
                                        <!-- JS s·∫Ω t·ª± add t·ª´ng <tr> v√†o tbody -->


                                        </tbody>
                                    </table>

                                    <nav class="custom-pagination">
                                        <ul class="pagination justify-content-center" id="paginationContainer">
                                            <!-- C√°c li s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi b·∫±ng JS -->
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-product-detail" role="tabpanel">
                            <div class="product-detail-tab">
                                <div class="title"
                                     style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h2>Chi Ti·∫øt S·∫£n Ph·∫©m</h2>

                                    </div>

                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">
                                        <button class="btn btn-primary"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductDetailModal"
                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">
                                            + Th√™m Chi Ti·∫øt
                                        </button>
                                    </div>
                                </div>

                                <select id="productFilter" class="form-select mb-3" style="width: 200px">
                                    <option value="">T·∫•t c·∫£ s·∫£n ph·∫©m</option>
                                </select>

                                <div class="table-responsive dashboard-bg-box" id="productDetailContainer">

                                    <table class="table product-detail-table">
                                        <thead>
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">T√™n s·∫£n ph·∫©m</th>
                                            <th scope="col">Chi ti·∫øt</th>
                                            <th scope="col">Ng∆∞·ªùi b√°n</th>
                                            <th scope="col">Gi√° (VNƒê)</th>
                                            <th scope="col">H·∫°n s·ª≠ d·ª•ng (th√°ng)</th>
                                            <th scope="col">Tr·∫°ng th√°i</th>
                                            <th scope="col">Thao t√°c</th>
                                        </tr>
                                        </thead>
                                        <tbody id="productDetailTable">
                                        </tbody>
                                    </table>

                                    <nav class="custom-pagination mt-3">
                                        <ul class="pagination justify-content-center" id="paginationProductDetail"></ul>
                                    </nav>
                                </div>

                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-order" role="tabpanel">
                            <div class="dashboard-order">
                                <div class="title"
                                     style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h2>T·∫•t C·∫£ ƒê∆°n H√†ng</h2>
                                    </div>

                                    <!--                                    <div style="width: 200px; text-align: center; margin-top: 7px; position: relative; z-index: 0">-->
                                    <!--                                        <button class="btn btn-primary"-->
                                    <!--                                                data-bs-toggle="modal"-->
                                    <!--                                                data-bs-target="#addOrderModal"-->
                                    <!--                                                style="width:100%; background-color: #198754; color: white; border: none; padding: 8px 16px; font-weight: 500; border-radius: 4px">-->
                                    <!--                                            T·∫£i Xu·ªëng Danh S√°ch-->
                                    <!--                                        </button>-->

                                    <!--                                    </div>-->
                                </div>


                                <div class="order-tab dashboard-bg-box">
                                    <div class="table-responsive">
                                        <table id="orderTable" class="table order-table">
                                            <thead>
                                            <tr>
                                                <th scope="col">STT</th>
                                                <th scope="col">M√£ ƒë∆°n h√†ng</th>
                                                <th scope="col">Ng√†y ƒë·∫∑t</th>
                                                <th scope="col">SƒêT</th>
                                                <th scope="col">ƒê·ªãa ch·ªâ</th>
                                                <th scope="col">T·ªïng ti·ªÅn (VNƒê)</th>
                                                <th scope="col">Th√†nh ti·ªÅn (VNƒê)</th>
                                                <th scope="col" class="status-badge">Tr·∫°ng th√°i</th>
                                                <th scope="col">Thao t√°c</th>
                                            </tr>
                                            </thead>
                                            <tbody id="orderTableBody">
                                            <!-- D·ªØ li·ªáu ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c render b·∫±ng JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--                                    <nav class="custom-pagination">-->
                                    <!--                                        <ul class="pagination justify-content-center">-->
                                    <!--                                            <li class="page-item disabled">-->
                                    <!--                                                <a class="page-link" href="javascript:void(0)" tabindex="-1">-->
                                    <!--                                                    <i class="fa-solid fa-angles-left"></i>-->
                                    <!--                                                </a>-->
                                    <!--                                            </li>-->
                                    <!--                                            <li class="page-item active">-->
                                    <!--                                                <a class="page-link" href="javascript:void(0)">1</a>-->
                                    <!--                                            </li>-->
                                    <!--                                            <li class="page-item">-->
                                    <!--                                                <a class="page-link" href="javascript:void(0)">2</a>-->
                                    <!--                                            </li>-->
                                    <!--                                            <li class="page-item">-->
                                    <!--                                                <a class="page-link" href="javascript:void(0)">3</a>-->
                                    <!--                                            </li>-->
                                    <!--                                            <li class="page-item">-->
                                    <!--                                                <a class="page-link" href="javascript:void(0)">-->
                                    <!--                                                    <i class="fa-solid fa-angles-right"></i>-->
                                    <!--                                                </a>-->
                                    <!--                                            </li>-->
                                    <!--                                        </ul>-->
                                    <!--                                    </nav>-->
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="pills-profile" role="tabpanel">
                            <div class="dashboard-profile">
                                <div class="title d-flex justify-content-between align-items-center">
                                    <h2>H·ªì s∆°</h2>
                                </div>

                                <!-- Th√¥ng tin c∆° b·∫£n -->
                                <div class="profile-tab dashboard-bg-box mb-3">
                                    <h4 class="mb-3">üîπ Th√¥ng tin c∆° b·∫£n</h4>
                                    <ul>
                                        <li class="editable-row" data-key="userId">
                                            <h5>ID ng∆∞·ªùi d√πng:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text" readonly>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="username">
                                            <h5>T√™n ng∆∞·ªùi d√πng:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">T√™n ng∆∞·ªùi d√πng ph·∫£i c√≥
                                                t·ª´ 3 ƒë·∫øn 20 k√Ω t·ª±.</small>
                                        </li>

                                        <li class="editable-row" data-key="fullName">
                                            <h5>H·ªç v√† t√™n:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">H·ªç v√† t√™n kh√¥ng ƒë∆∞·ª£c
                                                ƒë·ªÉ tr·ªëng.</small>
                                        </li>

                                        <li class="editable-row" data-key="gender">
                                            <h5>Gi·ªõi t√≠nh:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <select class="form-select form-select-sm d-none field-input">
                                                    <option>Nam</option>
                                                    <option>N·ªØ</option>
                                                    <option>Kh√°c</option>
                                                </select>
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">Ch·ªçn gi·ªõi t√≠nh ph√π
                                                h·ª£p.</small>
                                        </li>

                                        <li class="editable-row" data-key="dob">
                                            <h5>Ng√†y sinh:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="date">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">Vui l√≤ng ch·ªçn ng√†y
                                                sinh h·ª£p l·ªá. Tu·ªïi ph·∫£i t·ª´ 10 ƒë·∫øn 100</small>
                                        </li>

                                        <li>
                                            <h5>Ng√†y t·∫°o t√†i kho·∫£n:</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="createdAt mb-0">--/--/----</h5>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Th√¥ng tin li√™n l·∫°c -->
                                <div class="profile-tab dashboard-bg-box mb-3">
                                    <h4 class="mb-3">üîπ Th√¥ng tin li√™n l·∫°c</h4>
                                    <ul>
                                        <li>
                                            <h5>Email:</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="email mb-0">example@email.com</h5>
                                                <i class="bi bi-lock-fill text-muted ms-3"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="phone">
                                            <h5>S·ªë ƒëi·ªán tho·∫°i:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value"></span>
                                                <input class="form-control form-control-sm d-none field-input"
                                                       type="text">
                                                <button class="btn btn-sm btn-outline-secondary ms-2 btn-edit"
                                                        title="Ch·ªânh s·ª≠a">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                            <small class="form-text text-muted d-none field-hint">S·ªë ƒëi·ªán tho·∫°i g·ªìm 10
                                                ch·ªØ s·ªë, b·∫Øt ƒë·∫ßu b·∫±ng 0.</small>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Th√¥ng tin ƒëƒÉng nh·∫≠p -->
                                <div class="profile-tab dashboard-bg-box">
                                    <h4 class="mb-3">üîπ Th√¥ng tin ƒëƒÉng nh·∫≠p</h4>
                                    <ul>
                                        <li>
                                            <h5>T√†i kho·∫£n (Email):</h5>
                                            <div class="d-flex align-items-center">
                                                <h5 class="account-email mb-0">--</h5>
                                                <i class="bi bi-lock-fill text-muted ms-2"
                                                   title="Kh√¥ng th·ªÉ ch·ªânh s·ª≠a"></i>
                                            </div>
                                        </li>

                                        <li class="editable-row" data-key="password">
                                            <h5>M·∫≠t kh·∫©u:</h5>
                                            <div class="d-flex align-items-center">
                                                <span class="field-value">******</span>

                                                <!-- üîí Kh√¥ng cho ch·ªânh s·ª≠a tr·ª±c ti·∫øp -->
                                                <!-- C√≥ th·ªÉ gi·ªØ input n·∫øu b·∫°n c·∫ßn logic backend, nh∆∞ng n√™n disabled -->
                                                <input type="password"
                                                       class="form-control form-control-sm field-input d-none"
                                                       disabled/>

                                                <!-- üîó N√∫t ƒë·ªïi m·∫≠t kh·∫©u -->
                                                <button type="button" id="btnEditPassword"
                                                        class="btn btn-sm btn-outline-secondary ms-2"
                                                        title="ƒê·ªïi m·∫≠t kh·∫©u">
                                                    <i class="bi bi-pencil-square"></i>
                                                </button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>


                                <!-- N√∫t Hu·ª∑ & L∆∞u -->
                                <div class="d-flex justify-content-end mt-4 gap-2">
                                    <button id="cancel-edit" class="btn btn-outline-secondary" title="Hu·ª∑ c√°c thay ƒë·ªïi">
                                        <i class="bi bi-x-circle me-1"></i> Hu·ª∑
                                    </button>
                                    <button id="save-edit" class="btn btn-primary" title="L∆∞u c√°c thay ƒë·ªïi">
                                        <i class="bi bi-save me-1"></i> L∆∞u thay ƒë·ªïi
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--CSS-->
    <style>
        .delete:hover {
            color: #dc3545 !important;
            transform: scale(1.1);
            transition: all 0.2s ease;
        }

        .product-info-card {
            border: 1px solid #dee2e6;
            background-color: #f8f9fa !important;
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .toast {
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
    </style>

</section>
<!-- User Dashboard Section End -->

<!-- Footer Section Start -->
<!--<footer th:replace="FrontEnd/fragments/footer::footer"></footer>-->
<!-- Footer Section End -->

<!-- Tap to top and theme setting button start -->
<div class="theme-option">
    <!--    <div class="setting-box">-->
    <!--        <button class="btn setting-button">-->
    <!--            <i class="fa-solid fa-gear"></i>-->
    <!--        </button>-->

    <!--        <div class="theme-setting-2">-->
    <!--            <div class="theme-box">-->
    <!--                <ul>-->
    <!--                    <li>-->
    <!--                        <div class="setting-name">-->
    <!--                            <h4>Color</h4>-->
    <!--                        </div>-->
    <!--                        <div class="theme-setting-button color-picker">-->
    <!--                            <form class="form-control">-->
    <!--                                <label for="colorPick" class="form-label mb-0">Theme Color</label>-->
    <!--                                <input type="color" class="form-control form-control-color" id="colorPick"-->
    <!--                                       value="#0da487" title="Choose your color">-->
    <!--                            </form>-->
    <!--                        </div>-->
    <!--                    </li>-->

    <!--                    <li>-->
    <!--                        <div class="setting-name">-->
    <!--                            <h4>Dark</h4>-->
    <!--                        </div>-->
    <!--                        <div class="theme-setting-button">-->
    <!--                            <button class="btn btn-2 outline" id="darkButton">Dark</button>-->
    <!--                            <button class="btn btn-2 unline" id="lightButton">Light</button>-->
    <!--                        </div>-->
    <!--                    </li>-->

    <!--                    <li>-->
    <!--                        <div class="setting-name">-->
    <!--                            <h4>RTL</h4>-->
    <!--                        </div>-->
    <!--                        <div class="theme-setting-button rtl">-->
    <!--                            <button class="btn btn-2 rtl-unline">LTR</button>-->
    <!--                            <button class="btn btn-2 rtl-outline">RTL</button>-->
    <!--                        </div>-->
    <!--                    </li>-->
    <!--                </ul>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--    </div>-->

    <div class="back-to-top">
        <a id="back-to-top" href="#">
            <i class="fas fa-chevron-up"></i>
        </a>
    </div>
</div>
<!-- Tap to top and theme setting button end -->

<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->

<!--Th√™m th∆∞ vi·ªán-->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<!--Th√™m th∆∞ vi·ªán End-->

<!--Reset Tab Data-->
<script>
    let preventResetProductDetail = false; // üëà Flag ƒë·ªÉ ch·∫∑n reset t·∫°m th·ªùi

    function resetProductTab() {
        currentSort = {key: null, order: null};
        document.querySelectorAll(".btn-sort").forEach(btn => btn.classList.remove("active-sort"));
        loadProducts(1);
    }

    function resetProductDetailTab() {
        const filterSelect = document.getElementById("productFilter");
        if (filterSelect) {
            filterSelect.value = "";
        }
        selectedProductId = null;
        selectedCategoryId = null;
        loadProductDetails();
        const selectedNameDisplay = document.getElementById("selectedProductName");
        if (selectedNameDisplay) {
            selectedNameDisplay.innerText = "T·∫•t c·∫£ s·∫£n ph·∫©m";
        }
    }

    function resetProfileTab() {
        const cancelBtn = document.getElementById("cancel-edit");
        if (cancelBtn) {
            cancelBtn.click(); // üëà Gi·∫£ l·∫≠p click n√∫t "Hu·ª∑"
        }
    }

    document.querySelectorAll('button[data-bs-toggle="pill"]').forEach(btn => {
        btn.addEventListener('shown.bs.tab', function (e) {
            const targetId = e.target.getAttribute('data-bs-target');

            switch (targetId) {
                case '#pills-product':
                    resetProductTab();
                    break;
                case '#pills-product-detail':
                    if (preventResetProductDetail) {
                        preventResetProductDetail = false;
                    } else {
                        resetProductDetailTab();
                    }
                    break;
                case '#pills-order':
                    resetOrderTab();
                    break;
                case '#pills-profile':
                    resetProfileTab();
                    break;
            }
        });
    });
</script>
<!--Reset Tab Data End-->

<!--1. Tab Profile-->
<!--CSS Profile-->
<style>
    .zoom-avatar-btn {
        bottom: 8px;
        left: 8px;
        border-radius: 50%;
        padding: 6px 8px;
        font-size: 12px;
    }

    .avatar-wrapper {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        position: relative;
        margin: auto;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* üîπ ƒê·∫£m b·∫£o ·∫£nh l·∫•p ƒë·∫ßy khung */
        object-position: center; /* üîπ L·∫•y ph·∫ßn gi·ªØa ·∫£nh */
        border-radius: 50%;
        display: block;
    }


    .edit-avatar-btn {
        bottom: 8px;
        right: 8px;
        border-radius: 50%;
        padding: 6px 8px;
        font-size: 12px;
    }

    .edit-avatar-btn, .edit-cover-btn {
        border-radius: 50%;
        padding: 5px 7px;
    }

    /* üîπ N√∫t H·ªßy */
    #cancel-edit {
        background-color: #f8f9fa;
        color: #6c757d;
        border: 1px solid #ced4da;
        transition: all 0.2s ease-in-out;
    }

    #cancel-edit:hover {
        background-color: #e2e6ea;
        color: #495057;
        border-color: #adb5bd;
    }

    /* üîπ N√∫t L∆∞u */
    #save-edit {
        background-color: #198754;
        color: #fff;
        border: none;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
    }

    #save-edit:hover {
        background-color: #157347;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    #save-edit:active {
        transform: scale(0.98);
    }

    /* üî∏ Responsive spacing n·∫øu c·∫ßn */
    .profile-tab .btn {
        min-width: 110px;
        font-weight: 500;
        letter-spacing: 0.3px;
    }
</style>

<!-- Modal ƒë·ªïi m·∫≠t kh·∫©u -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <form id="changePasswordForm" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">ƒê·ªïi m·∫≠t kh·∫©u</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="currentPassword" class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                    <input type="password" class="form-control" id="currentPassword" required minlength="6"/>
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" class="form-control" id="newPassword" required minlength="6"/>
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                    <input type="password" class="form-control" id="confirmPassword" required minlength="6"/>
                </div>
                <div id="passwordError" class="text-danger d-none"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hu·ª∑</button>
                <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal xem ·∫£nh -->
<div class="modal fade" id="zoomAvatarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <img id="zoomAvatarImg" src="" alt="Zoomed Avatar" class="img-fluid rounded">
        </div>
    </div>
</div>

<!--CRUD profile-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const BASE_URL = "/AgriculturalWarehouseManagementApplication/api/seller/user";
        const originalValues = {};
        let isEditing = false;
        const userId = "[[${session.accountIdSeller}]]";

        function loadUserData() {
            fetch(`${BASE_URL}/by-id/${userId}`)
                .then(res => res.json())
                .then(data => {
                    setField("userId", data.userId, true);
                    setField("fullName", data.fullName);
                    setField("gender", data.gender);
                    setField("dob", data.dob);
                    setField("phone", data.phone);
                    setField("password", data.password);
                    setField("username", data.username);

                    document.querySelector(".createdAt").textContent = data.createdAt;
                    document.querySelector(".email").textContent = data.email;
                    document.querySelector(".account-email").textContent = data.email;
                    document.getElementById('usernameDisplay').textContent = data.username;
                    document.getElementById('emailDisplay').textContent = data.email;

                    document.querySelectorAll(".editable-row").forEach(row => {
                        const key = row.dataset.key;
                        originalValues[key] = row.querySelector(".field-value").textContent.trim();
                    });

                    // ‚úÖ L∆∞u userId v√†o localStorage
                    localStorage.setItem("userId", data.userId);

                    updateActionButtons();
                })
                .catch(err => {
                    console.error("L·ªói khi l·∫•y d·ªØ li·ªáu:", err);
                    showAlert("B·∫°n c·∫ßn c·∫≠p nh√¢t ƒë·∫ßy ƒë·ªß th√¥ng tin ng∆∞·ªùi d√πng!", "info");
                });
        }

        function setField(key, value, readOnly = false) {
            const row = document.querySelector(`.editable-row[data-key="${key}"]`);
            if (!row) return;

            const span = row.querySelector(".field-value");
            const input = row.querySelector(".field-input");

            if (key === "dob") {
                span.textContent = value;
                input.value = convertToInputDate(value);
            } else if (key === "password") {
                span.textContent = "*".repeat(value.length);
                input.value = value;
            } else {
                span.textContent = value;
                input.value = value;
            }

            if (readOnly) {
                const btn = row.querySelector(".btn-edit");
                if (btn) btn.disabled = true;
            }
        }

        function toggleEdit(button) {
            const row = button.closest(".editable-row");
            const key = row.dataset.key;
            const span = row.querySelector(".field-value");
            const input = row.querySelector(".field-input");
            const hint = row.querySelector(".field-hint");

            const isViewing = !span.classList.contains("d-none");

            if (isViewing) {
                span.classList.add("d-none");
                input.classList.remove("d-none");
                if (hint) hint.classList.remove("d-none");
                button.innerHTML = '<i class="bi bi-check-lg"></i>';
                input.focus();

                // ƒê√£ b·∫Øt ƒë·∫ßu ch·ªânh s·ª≠a
                isEditing = true;
                updateActionButtons();
            } else {
                let value = input.value.trim();
                if (input.tagName === "SELECT") {
                    value = input.options[input.selectedIndex].text;
                }

                if (key === "dob") {
                    span.textContent = convertToDisplayDate(value);
                } else if (key === "password") {
                    span.textContent = "*".repeat(value.length);
                } else {
                    span.textContent = value;
                }

                span.classList.remove("d-none");
                input.classList.add("d-none");
                if (hint) hint.classList.add("d-none");
                button.innerHTML = '<i class="bi bi-pencil-square"></i>';
            }
        }

        document.getElementById("cancel-edit").addEventListener("click", () => {
            for (const key in originalValues) {
                const row = document.querySelector(`.editable-row[data-key="${key}"]`);
                const span = row.querySelector(".field-value");
                const input = row.querySelector(".field-input");
                const hint = row.querySelector(".field-hint");

                span.classList.remove("d-none");
                input.classList.add("d-none");
                if (hint) hint.classList.add("d-none");

                const value = originalValues[key];
                input.value = (key === "dob") ? convertToInputDate(value) : value;
                span.textContent = (key === "password") ? "*".repeat(value.length) : value;

                const btn = row.querySelector(".btn-edit");
                if (btn && !btn.disabled) btn.innerHTML = '<i class="bi bi-pencil-square"></i>';
            }

            isEditing = false;
            updateActionButtons();
            // showAlert("ƒê√£ hu·ª∑ ch·ªânh s·ª≠a!", "info");
        });

        document.getElementById("save-edit").addEventListener("click", () => {
            const updatedData = {};
            let isValid = true;
            let errorMessage = "";

            document.querySelectorAll(".editable-row").forEach(row => {
                const key = row.dataset.key;
                const input = row.querySelector(".field-input");
                let value = input.value.trim();

                if (input.tagName === "SELECT") {
                    value = input.options[input.selectedIndex].text;
                }

                switch (key) {
                    case "fullName":
                        if (!value.match(/^[A-Za-z√Ä-·ªπ\s]+$/)) {
                            isValid = false;
                            errorMessage = "H·ªç v√† t√™n kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "gender":
                        if (!["Nam", "N·ªØ", "Kh√°c"].includes(value)) {
                            isValid = false;
                            errorMessage = "Gi·ªõi t√≠nh kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "dob":
                        if (!value) {
                            isValid = false;
                            errorMessage = "Ng√†y sinh kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
                        } else {
                            const today = new Date();
                            const dob = new Date(value);
                            const age = today.getFullYear() - dob.getFullYear();
                            if (dob > today) {
                                isValid = false;
                                errorMessage = "Ng√†y sinh kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n ng√†y hi·ªán t·∫°i.";
                            } else if (age < 10 || age > 100) {
                                isValid = false;
                                errorMessage = "Tu·ªïi ph·∫£i t·ª´ 10 ƒë·∫øn 100.";
                            }
                        }
                        break;
                    case "phone":
                        if (!value.match(/^0\d{9}$/)) {
                            isValid = false;
                            errorMessage = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá.";
                        }
                        break;
                    case "username":
                        if (value.length < 4 || /\s/.test(value)) {
                            isValid = false;
                            errorMessage = "T√™n ƒëƒÉng nh·∫≠p ph·∫£i t·ªëi thi·ªÉu 4 k√Ω t·ª± v√† kh√¥ng c√≥ kho·∫£ng tr·∫Øng.";
                        }
                        break;
                    case "password":
                        if (value.length < 6) {
                            isValid = false;
                            errorMessage = "M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.";
                        }
                        break;
                }

                if (!isValid) return;

                updatedData[key] = (key === "dob") ? convertToDisplayDate(value) : value;
            });

            if (!isValid) {
                showAlert(errorMessage, "error");
                return;
            }

            fetch(BASE_URL, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(updatedData)
            })
                .then(res => {
                    if (!res.ok) throw new Error("L·ªói khi l∆∞u");
                    return res.json();
                })
                .then(() => {
                    showAlert("L∆∞u thay ƒë·ªïi th√†nh c√¥ng!", "success");
                    isEditing = false;
                    updateActionButtons();
                    setTimeout(() => location.reload(), 1500);
                })
                .catch(err => {
                    console.error(err);
                    showAlert("ƒê√£ x·∫£y ra l·ªói khi l∆∞u!", "error");
                });
        });

        document.addEventListener("keypress", function (e) {
            if (e.key === "Enter" && e.target.classList.contains("field-input")) {
                const row = e.target.closest(".editable-row");
                toggleEdit(row.querySelector(".btn-edit"));
            }
        });

        document.addEventListener("click", function (e) {
            const btn = e.target.closest(".btn-edit");
            if (btn) toggleEdit(btn);
        });

        function convertToInputDate(str) {
            const [d, m, y] = str.split("/");
            return `${y}-${m.padStart(2, "0")}-${d.padStart(2, "0")}`;
        }

        function convertToDisplayDate(str) {
            const [y, m, d] = str.split("-");
            return `${d}/${m}/${y}`;
        }

        function updateActionButtons() {
            const saveBtn = document.getElementById("save-edit");
            const cancelBtn = document.getElementById("cancel-edit");

            if (isEditing) {
                saveBtn.removeAttribute("disabled");
                cancelBtn.removeAttribute("disabled");
                saveBtn.classList.remove("btn-outline-secondary");
                saveBtn.classList.add("btn-primary");
            } else {
                saveBtn.setAttribute("disabled", true);
                cancelBtn.setAttribute("disabled", true);
                saveBtn.classList.remove("btn-primary");
                saveBtn.classList.add("btn-outline-secondary");
            }
        }

        function showAlert(message, type = 'success') {
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: type,
                title: message,
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                background: '#fefefe',
                color: '#333'
            });
        }

        const changePasswordModal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
        const changePasswordForm = document.getElementById('changePasswordForm');
        const passwordErrorDiv = document.getElementById('passwordError');

        document.getElementById('btnEditPassword').addEventListener('click', () => {
            changePasswordForm.reset();
            passwordErrorDiv.classList.add('d-none');
            passwordErrorDiv.textContent = '';
            changePasswordModal.show();
        });

        changePasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const userId = "[[${session.accountIdSeller}]]";
            ; // thay th√†nh ID user th·ª±c t·∫ø
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (newPassword !== confirmPassword) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n kh√¥ng kh·ªõp.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }

            if (newPassword.length < 6) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }

            if (newPassword === currentPassword) {
                passwordErrorDiv.textContent = "M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c tr√πng m·∫≠t kh·∫©u hi·ªán t·∫°i.";
                passwordErrorDiv.classList.remove('d-none');
                return;
            }


            fetch('/AgriculturalWarehouseManagementApplication/api/seller/user/change-password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    userId: userId,
                    currentPassword: currentPassword,
                    newPassword: newPassword
                })
            })
                .then(async res => {
                    const data = await res.json();

                    if (!res.ok) {
                        const errorMessage = data.error || 'L·ªói khi ƒë·ªïi m·∫≠t kh·∫©u';
                        throw new Error(errorMessage);
                    }

                    // ‚úÖ Hi·ªÉn th·ªã alert th√†nh c√¥ng
                    Swal.fire({
                        icon: 'success',
                        title: 'ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!',
                        timer: 1500,
                        showConfirmButton: false,
                        willClose: () => {
                            // ‚úÖ Reload sau khi alert ƒë√≥ng
                            location.reload();
                        }
                    });

                    changePasswordModal.hide();
                })
                .catch(err => {
                    passwordErrorDiv.textContent = err.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh.";
                    passwordErrorDiv.classList.remove('d-none');
                });

        });

        loadUserData();
    });
</script>

<!--Avatar-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userId = "[[${session.accountIdSeller}]]"; // ‚ö†Ô∏è Replace with dynamic userId if needed
        const BASE = "/AgriculturalWarehouseManagementApplication";

        const avatarImg = document.getElementById("avatarImage");
        const input = document.getElementById("avatarInput");
        const editBtn = document.querySelector(".edit-avatar-btn");

        // üìå G·∫Øn s·ª± ki·ªán click ƒë·ªÉ m·ªü input
        if (editBtn && input) {
            editBtn.addEventListener("click", () => input.click());
        }

        // üìå G·∫Øn s·ª± ki·ªán change ƒë·ªÉ upload
        input.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("file", file);

            fetch(`${BASE}/api/seller/user/${userId}/avatar`, {
                method: "POST",
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    if (data.avatarUrl) {
                        // ‚úÖ C·∫≠p nh·∫≠t src avatar v√† th√™m timestamp ƒë·ªÉ tr√°nh cache
                        avatarImg.src = BASE + data.avatarUrl + "?t=" + new Date().getTime();
                        Swal.fire({
                            icon: 'success',
                            title: 'Th√†nh c√¥ng',
                            text: 'C·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán th√†nh c√¥ng!',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'L·ªói hi·ªÉn th·ªã ·∫£nh',
                            text: 'ƒê·ªãnh d·∫°ng ·∫£nh c√≥ th·ªÉ kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£.'
                        });
                    }
                })
                .catch(err => {
                    console.error("L·ªói khi upload ·∫£nh:", err);
                    Swal.fire({
                        icon: 'error',
                        title: 'L·ªói upload',
                        text: 'Kh√¥ng th·ªÉ upload ·∫£nh.'
                    });
                });

        });

        // üìå Load avatar ban ƒë·∫ßu
        fetch(`${BASE}/api/seller/user/by-id/${userId}`)
            .then(res => res.json())
            .then(data => {
                if (data.image) {
                    avatarImg.src = BASE + `/seller/${data.userId}/${data.image}?t=` + new Date().getTime();
                } else {
                    avatarImg.src = BASE + `/Backend/assets/images/user/default-avatar.png?t=` + new Date().getTime();
                    // avatarImg.src = data.image
                }

            });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const zoomBtn = document.querySelector(".zoom-avatar-btn");
        const zoomImg = document.getElementById("zoomAvatarImg");
        const avatarImg = document.getElementById("avatarImage");

        if (zoomBtn && zoomImg && avatarImg) {
            zoomBtn.addEventListener("click", () => {
                zoomImg.src = avatarImg.src;
                new bootstrap.Modal(document.getElementById("zoomAvatarModal")).show();
            });
        }
    });

</script>
<!--Tab Profile End-->

<!--3. Tab Product-->
<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="addProductForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Th√™m S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="form-label-title col-sm-3 mb-0">T√™n</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" placeholder="T√™n s·∫£n ph·∫©m" id="productName"
                                   required>
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label form-label-title">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="categoryId" required>
                                <option value="" disabled selected>ƒêang t·∫£i danh m·ª•c...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">M√¥ t·∫£</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m ·ªü ƒë√¢y..."
                                      id="description" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row">
                        <label class="col-sm-3 col-form-label form-label-title">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select id="status" class="form-select" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>


                    <!-- Upload Images -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">H√¨nh ·∫£nh</label>
                        <div class="col-sm-9">
                            <div class="custom-upload-box">
                                <label for="galleries" class="upload-label">
                                    <i class="fa fa-upload me-2"></i>Ch·ªçn ·∫£nh (t·ªëi ƒëa 5)
                                </label>
                                <input type="file" id="galleries" class="form-control visually-hidden"
                                       accept="image/*" multiple>
                                <p class="text-muted mt-2 mb-0" id="fileUploadNote">Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.</p>
                                <div id="previewContainer" class="d-flex flex-wrap gap-2 mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy
                    </button>
                    <button class="btn btn-success" type="submit" id="submitBtn">ƒê·ªìng √Ω
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Add Product Modal End-->

<!-- View Images Modal -->

<!-- Modal Xem & Qu·∫£n L√Ω ·∫¢nh -->
<div class="modal fade" id="viewImageModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">·∫¢nh S·∫£n Ph·∫©m</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body text-center">
                <!-- Khu v·ª±c ·∫£nh -->
                <div id="imageContainer" class="d-flex flex-wrap gap-3 justify-content-center mb-3"></div>

                <!-- C·∫£nh b√°o -->
                <p class="text-muted">Ch·ªçn t·ªëi ƒëa 5 ·∫£nh.</p>

                <!-- N√∫t th√™m ·∫£nh -->
                <button class="btn btn-outline-danger mt-2" id="deleteAllBtn">üóë X√≥a t·∫•t c·∫£</button>

                <!-- File input ·∫©n -->
                <input type="file" id="imageUploader" accept="image/*" multiple hidden/>
            </div>
        </div>
    </div>
</div>

<!-- View Images Modal End -->

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editProductForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">Ch·ªânh S·ª≠a</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="form-label-title col-sm-3 mb-0">T√™n</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" placeholder="T√™n s·∫£n ph·∫©m" id="editProductName"
                                   required>
                        </div>
                    </div>

                    <!-- Category -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label form-label-title">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="editCategoryId" required>
                                <option value="" disabled selected>ƒêang t·∫£i danh m·ª•c...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-4 row">
                        <label class="form-label-title col-sm-3 mb-0">M√¥ t·∫£</label>
                        <div class="col-sm-9">
                            <textarea class="form-control" placeholder="Nh·∫≠p m√¥ t·∫£ s·∫£n ph·∫©m ·ªü ƒë√¢y..."
                                      id="editDescription" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row">
                        <label class="col-sm-3 col-form-label form-label-title">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select id="editStatus" class="form-select" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button class="btn btn-success" type="submit" id="editSubmitBtn">C·∫≠p Nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Edit Product Modal End -->

<!--Logic Tab Product-->

<!--CSS Product-->
<style>
    .product-table th,
    .product-table td {
        border-right: 1px solid #dee2e6;
    }

    .product-table th:last-child,
    .product-table td:last-child {
        border-right: none;
    }

    .product-table {
        border-collapse: collapse;
    }

    /* N√∫t H·ªßy - m√†u trung t√≠nh n·ªïi b·∫≠t nh·∫π */
    .btn.btn-secondary {
        background-color: #6c757d;
        border: none;
        color: #fff;
        font-weight: 500;
        transition: 0.3s ease;
        padding: 6px 16px;
    }

    .btn.btn-secondary:hover {
        background-color: #5a6268;
        box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.3);
    }

    /* N√∫t ƒê·ªìng √Ω - m√†u xanh n·ªïi b·∫≠t */
    .btn.btn-success {
        background-color: #198754;
        border: none;
        color: #fff;
        font-weight: 500;
        transition: 0.3s ease;
        padding: 6px 16px;
    }

    .btn.btn-success:hover {
        background-color: #157347;
        box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.3);
    }

    /* Icon trong button c√°ch ch·ªØ m·ªôt ch√∫t */
    .btn i {
        margin-right: 6px;
    }

    .btn-sort.active-sort {
        color: #dc3545; /* ƒë·ªè nh·∫π */
        font-weight: bold;
        text-decoration: underline;
    }

    .header-with-sort {
        display: flex;
        align-items: center; /* CƒÉn gi·ªØa ngang */
        justify-content: center; /* CƒÉn gi·ªØa d·ªçc */
        text-align: center;
    }

    .sort-buttons {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .btn-sort {
        font-size: 10px;
        padding: 0;
        border: none;
        background: transparent;
        cursor: pointer;
        line-height: 1;
        color: #333;
    }

    .btn-sort:hover {
        color: #0d6efd;
        font-weight: bold;
    }

    .custom-pagination .page-item.disabled .page-link {
        color: #999 !important; /* m√†u ch·ªØ m·ªù */
        background-color: #f8f9fa; /* n·ªÅn nh·∫π */
        border-color: #dee2e6; /* vi·ªÅn m·ªù */
        pointer-events: none; /* kh√¥ng cho b·∫•m */
        cursor: not-allowed; /* hi·ªÉn th·ªã con tr·ªè ch√©o */
        opacity: 0.6; /* m·ªù t·ªïng th·ªÉ */
        transition: 0.3s;
    }

    .preview-image-box {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 6px;
        overflow: hidden;
        border: 1px solid #ccc;
    }

    .preview-image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
    }

    .preview-image-box button {
        position: absolute;
        top: 4px;
        right: 4px;
        background-color: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
    }

    .wrap-text {
        white-space: normal !important;
        word-wrap: break-word;
        word-break: break-word;
        max-width: 200px;
    }

    #productTable tbody {
        display: block;
        min-height: calc(5 * 48px);
    }

    #productTable thead,
    #productTable tbody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
    }

    #productTable {
        border-collapse: collapse;
        width: 100%;
    }

    #imageContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .image-box {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f8f8;
    }

    .image-box img {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
    }

    .image-box .delete-btn {
        position: absolute;
        top: 4px;
        right: 6px;
        background-color: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 14px;
        line-height: 18px;
        cursor: pointer;
        padding: 0;
    }

    .image-box.add-btn {
        font-size: 28px;
        font-weight: bold;
        color: #888;
        border: 2px dashed #ced4da;
        cursor: pointer;
    }

    #deleteAllBtn {
        font-weight: bold;
        color: red;
    }

    .custom-upload-box {
        border: 2px dashed #ced4da;
        border-radius: 8px;
        padding: 16px;
        text-align: center;
        background-color: #f9f9f9;
        transition: background-color 0.3s ease;
    }

    .custom-upload-box:hover {
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .upload-label {
        cursor: pointer;
        font-weight: 500;
        color: #0d6efd;
        font-size: 16px;
        display: inline-block;
    }

    .upload-label i {
        font-size: 18px;
    }

    .image-wrapper {
        position: relative;
        display: inline-block;
        margin: 10px;
    }

    .image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
    }


    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }

</style>

<!--Upload file Add Modal-->
<script>

    let selectedFiles = [];

    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("galleries");
        const note = document.getElementById("fileUploadNote");
        const previewContainer = document.getElementById("previewContainer");
        const modalEl = document.getElementById("addProductModal");


        // üßπ Khi modal ƒë√≥ng ‚Üí reset
        modalEl.addEventListener("hidden.bs.modal", () => {
            selectedFiles = [];
            // input.value = "";
            previewContainer.innerHTML = "";
            note.textContent = "Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.";
        });

        input.addEventListener("change", function () {
            const newFiles = Array.from(this.files);
            if (newFiles.length === 0) return;

            const totalFiles = selectedFiles.length + newFiles.length;

            if (totalFiles > 5) {
                alert(`B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 5 ·∫£nh. Hi·ªán t·∫°i ƒë√£ c√≥ ${selectedFiles.length} ·∫£nh.`);
                this.value = "";
                return;
            }

            // üëâ Th√™m file m·ªõi v√†o danh s√°ch c≈©
            selectedFiles = selectedFiles.concat(newFiles);
            renderPreviews();
            this.value = ""; // reset input ƒë·ªÉ l·∫ßn sau onchange ho·∫°t ƒë·ªông l·∫°i
        });

        function renderPreviews() {
            previewContainer.innerHTML = "";
            note.textContent = selectedFiles.length > 0
                ? `ƒê√£ ch·ªçn ${selectedFiles.length} t·ªáp.`
                : "Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.";

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();

                reader.onload = function (e) {
                    const box = document.createElement("div");
                    box.className = "preview-image-box";

                    const img = document.createElement("img");
                    img.src = e.target.result;

                    const delBtn = document.createElement("button");
                    delBtn.innerHTML = "√ó";
                    delBtn.title = "Xo√° ·∫£nh n√†y";

                    delBtn.onclick = () => {
                        selectedFiles.splice(index, 1);
                        renderPreviews();
                    };

                    box.appendChild(img);
                    box.appendChild(delBtn);
                    previewContainer.appendChild(box);
                };

                reader.readAsDataURL(file);
            });
        }

        // üß† (G·ª£i √Ω): N·∫øu b·∫°n d√πng `selectedFiles` ƒë·ªÉ submit ‚Üí c·∫ßn s·ª≠a ph·∫ßn upload ·∫£nh l·∫°i ƒë·ªÉ d√πng selectedFiles
    });
</script>

<!--CRUD Product-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadCategories();
        loadStatuses();
        loadProducts();
        setupProductSortButtons();
        setupAddFormSubmit();
        setupEditFormSubmit();
    });

    function loadCategories() {
        const selects = [document.getElementById('categoryId'), document.getElementById('editCategoryId')];

        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/categories')
            .then(res => {
                const categories = res.data;

                selects.forEach(select => {
                    select.innerHTML = '<option value="" disabled selected>Ch·ªçn danh m·ª•c...</option>';
                    categories.forEach(cat => {
                        const option = document.createElement("option");
                        option.value = cat.categoryId;
                        option.textContent = cat.name;
                        select.appendChild(option);
                    });
                });
            })
            .catch(err => {
                console.error("L·ªói khi load categories:", err);
            });
    }

    function loadStatuses() {
        const selects = [document.getElementById('status'), document.getElementById('editStatus')];
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/statuses')
            .then(res => {
                selects.forEach(select => {
                    select.innerHTML = '<option value="" disabled selected>Ch·ªçn tr·∫°ng th√°i...</option>';
                    res.data.forEach(status => {
                        const text = status.replace(/_/g, ' ');
                        const option = new Option(text, status);
                        select.add(option);
                    });
                });
            });
    }

    function loadProducts(page = 1) {
        currentPage = page;

        const requiredItems = page * pageSize;

        // N·∫øu ch∆∞a ƒë·ªß d·ªØ li·ªáu ‚Üí g·ªçi l·∫°i API ƒë·ªÉ l·∫•y th√™m
        if (!allProducts || allProducts.length < requiredItems) {
            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    allProducts = res.data;
                    renderPageFromData(allProducts, page);
                });
        } else {
            renderPageFromData(allProducts, page);
        }
    }

    function renderPageFromData(data, page) {
        totalPages = Math.ceil(data.length / pageSize);
        const pageItems = data.slice((page - 1) * pageSize, page * pageSize);

        const tbody = document.getElementById("productTable");
        tbody.innerHTML = "";
        pageItems.forEach((product, i) => {
            const stt = (page - 1) * pageSize + i + 1;
            appendProductToTable(product, stt);
        });

        renderPaginationTemplate(data.length, page);
        addActionListeners();
        addViewImageListeners();
    }

    let currentSort = {key: null, order: null};

    function setupProductSortButtons() {
        document.querySelectorAll(".btn-sort").forEach(btn => {
            btn.addEventListener("click", () => {
                const key = btn.dataset.key;
                const order = btn.dataset.order;

                currentSort = {key, order};

                // Xo√° active ·ªü t·∫•t c·∫£ c√°c n√∫t
                document.querySelectorAll(".btn-sort").forEach(b => b.classList.remove("active-sort"));

                // G√°n active cho n√∫t v·ª´a click
                btn.classList.add("active-sort");

                renderSortedProducts();
            });
        });
    }

    function renderSortedProducts(page = 1) {
        currentPage = page; // üëà th√™m d√≤ng n√†y

        let sorted = [...allProducts];

        if (currentSort.key && currentSort.order) {
            sorted.sort((a, b) => {
                const valA = currentSort.key === "category"
                    ? (a.category?.name || "")
                    : (a.name || "");
                const valB = currentSort.key === "category"
                    ? (b.category?.name || "")
                    : (b.name || "");

                return currentSort.order === "asc"
                    ? valA.localeCompare(valB, 'vi', {sensitivity: 'base'})
                    : valB.localeCompare(valA, 'vi', {sensitivity: 'base'});
            });
        }

        const pageItems = sorted.slice((currentPage - 1) * pageSize, currentPage * pageSize);

        const tbody = document.getElementById("productTable");
        tbody.innerHTML = "";

        pageItems.forEach((product, i) => {
            const stt = (currentPage - 1) * pageSize + i + 1;
            appendProductToTable(product, stt);
        });

        addActionListeners();
        addViewImageListeners();
        renderPaginationTemplate(sorted.length, currentPage); // ‚úÖ v·∫´n ƒë√∫ng
    }

    function appendProductToTable(product, index) {
        const tbody = document.getElementById("productTable");
        const row = document.createElement('tr');
        row.setAttribute('data-id', product.id);

        // ƒê·ªãnh nghƒ©a m√†u theo status
        let statusColor = "black";
        switch (product.status) {
            case "ACTIVE":
                statusColor = "green";
                break;
            case "INACTIVE":
                statusColor = "red";
                break;
            case "OUT_OF_STOCK":
                statusColor = "orange";
                break;
        }

        row.innerHTML = `
  <td>${index}</td>
  <td class="text-center align-middle">
    <button type="button" class="btn btn-sm btn-outline-info btn-view-images" title="Qu·∫£n l√Ω ·∫£nh" data-id="${product.id}">
      <i class="ri-image-line p-1 rounded-circle bg-light"></i>
    </button>
  </td>
  <td class="wrap-text fw-bold">${product.name}</td>
  <td class="wrap-text">${product.category?.name || 'Unknown'}</td>
  <td class="wrap-text text-muted">${product.description || ''}</td>
  <td>
    <span class="badge px-3 py-2 fw-semibold text-white"
          style="background-color: ${statusColor}; text-transform: capitalize;">
      ${product.status.replace(/_/g, ' ')}
    </span>
  </td>
  <td class="text-center align-middle">
    <ul class="option-list d-flex justify-content-center gap-2 list-unstyled m-0">
      <li>
        <button type="button" class="btn btn-sm btn-outline-info btn-view" title="Chi ti·∫øt s·∫£n ph·∫©m" data-id="${product.id}">
          <i class="ri-eye-line"></i>
        </button>
      </li>
      <li>
        <button class="btn btn-sm btn-outline-primary btn-edit" title="Ch·ªânh s·ª≠a" data-id="${product.id}">
          <i class="ri-pencil-line"></i>
        </button>
      </li>
      <li>
        <button class="btn btn-sm btn-outline-danger btn-delete"
                title="${product.status === 'INACTIVE' ? 'S·∫£n ph·∫©m ƒë√£ ng·ª´ng kinh doanh' : 'Ng·ª´ng kinh doanh'}"
                data-id="${product.id}"
                ${product.status === 'INACTIVE' ? 'disabled' : ''}>
          <i class="ri-delete-bin-line"></i>
        </button>
      </li>
    </ul>
  </td>
`;

        tbody.appendChild(row);
        setupProductViewButtons();
    }

    function addActionListeners() {
        document.querySelectorAll(".btn-edit").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = this.dataset.id;
                axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                    .then(res => {
                        const product = res.data.find(p => p.id == id);
                        if (product) {
                            document.getElementById('editProductName').value = product.name;
                            document.getElementById('editDescription').value = product.description || '';
                            document.getElementById('editCategoryId').value = product.category.categoryId;
                            document.getElementById('editStatus').value = product.status;

                            document.getElementById('editProductForm').setAttribute("data-edit-id", id);
                            const modal = new bootstrap.Modal(document.getElementById('editProductModal'));
                            modal.show();
                        }
                    });
            });
        });

        document.querySelectorAll(".btn-delete").forEach(btn => {
            btn.addEventListener("click", function () {
                const id = this.dataset.id;
                axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                    .then(res => {
                        const product = res.data.find(p => p.id == id);

                        if (!product || product.status === "INACTIVE") {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Th√¥ng b√°o',
                                text: 'S·∫£n ph·∫©m n√†y ƒë√£ ng·ª´ng kinh doanh',
                            });
                            return;
                        }

                        Swal.fire({
                            title: 'X√°c nh·∫≠n',
                            text: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ng·ª´ng kinh doanh s·∫£n ph·∫©m n√†y kh√¥ng?",
                            icon: 'question',
                            showCancelButton: true,
                            confirmButtonText: 'ƒê·ªìng √Ω',
                            cancelButtonText: 'Hu·ª∑'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/products/${id}`, {status: "INACTIVE"})
                                    .then(() => {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Th√†nh c√¥ng',
                                            text: 'ƒê√£ chuy·ªÉn s·∫£n ph·∫©m sang tr·∫°ng th√°i INACTIVE.',
                                            timer: 2000,
                                            showConfirmButton: false
                                        });

                                        // ‚úÖ C·∫≠p nh·∫≠t ngay trong m·∫£ng allProducts
                                        const index = allProducts.findIndex(p => p.id == id);
                                        if (index !== -1) {
                                            allProducts[index].status = "INACTIVE";
                                        }

                                        // ‚úÖ Render l·∫°i danh s√°ch ƒë√∫ng theo tr·∫°ng th√°i m·ªõi
                                        if (currentSort.key) {
                                            renderSortedProducts();
                                        } else {
                                            renderPageFromData(allProducts, currentPage);
                                        }
                                    })
                                    .catch(err => {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'L·ªói',
                                            text: 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i!'
                                        });
                                    });
                            }
                        });

                    });
            });
        });
    }


    function setupAddFormSubmit() {
        const form = document.getElementById('addProductForm');
        const btn = document.getElementById('submitBtn');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";

            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('description').value.trim();
            const categoryId = document.getElementById('categoryId').value;
            const status = document.getElementById('status').value;
            if (!selectedFiles || selectedFiles.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Thi·∫øu ·∫£nh s·∫£n ph·∫©m',
                    text: 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ·∫£nh cho s·∫£n ph·∫©m.'
                });
                btn.disabled = false;
                btn.innerText = "ƒê·ªìng √Ω";
                return;
            }


            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    const isDuplicate = res.data.some(p => p.name.toLowerCase() === name.toLowerCase());
                    if (isDuplicate) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Tr√πng t√™n s·∫£n ph·∫©m',
                            text: 'T√™n s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i. Vui l√≤ng ch·ªçn t√™n kh√°c.'
                        });
                        btn.disabled = false;
                        btn.innerText = "ƒê·ªìng √Ω";
                        return;
                    }

                    const data = {name, description, categoryId, status};
                    axios.post('/AgriculturalWarehouseManagementApplication/api/seller/products', data)
                        .then(response => {
                            const productId = response.data.id;
                            if (!productId) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'L·ªói',
                                    text: 'Kh√¥ng l·∫•y ƒë∆∞·ª£c productId sau khi t·∫°o.'
                                });
                                return;
                            }

                            const files = selectedFiles.slice(0, 5);
                            const uploads = [];

                            for (const file of files) {
                                const formData = new FormData();
                                formData.append("file", file);
                                uploads.push(
                                    axios.post(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/upload-image`, formData)
                                );
                            }

                            Promise.all(uploads)
                                .then(() => {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Th√†nh c√¥ng',
                                        text: 'S·∫£n ph·∫©m & ·∫£nh ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng.'
                                    });
                                    bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                                    form.reset();
                                    axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                                        .then(res => {
                                            const totalItems = res.data.length;
                                            const lastPage = Math.ceil(totalItems / pageSize);
                                            loadProducts(lastPage);
                                        });
                                })
                                .catch(() => {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'L·ªói upload ·∫£nh',
                                        text: 'M·ªôt s·ªë ·∫£nh c√≥ th·ªÉ kh√¥ng ƒë∆∞·ª£c upload th√†nh c√¥ng.'
                                    });
                                })
                                .finally(() => {
                                    btn.disabled = false;
                                    btn.innerText = "ƒê·ªìng √Ω";
                                });
                        })
                        .catch(err => {
                            Swal.fire({
                                icon: 'error',
                                title: 'L·ªói',
                                text: 'Th√™m s·∫£n ph·∫©m th·∫•t b·∫°i.'
                            });
                            console.error(err);
                            btn.disabled = false;
                            btn.innerText = "ƒê·ªìng √Ω";
                        });
                });
        });
    }

    function setupEditFormSubmit() {
        const form = document.getElementById('editProductForm');
        const btn = document.getElementById('editSubmitBtn');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";

            const id = this.getAttribute("data-edit-id");
            const name = document.getElementById('editProductName').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const categoryId = document.getElementById('editCategoryId').value;
            const status = document.getElementById('editStatus').value;

            axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
                .then(res => {
                    const isDuplicate = res.data.some(p => p.name.toLowerCase() === name.toLowerCase() && p.id != id);
                    if (isDuplicate) {
                        Swal.fire({
                            icon: "warning",
                            title: "T√™n s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i!",
                            text: "Vui l√≤ng ch·ªçn t√™n kh√°c.",
                        });
                        btn.disabled = false;
                        btn.innerText = "C·∫≠p Nh·∫≠t";
                        return;
                    }

                    const data = {name, description, categoryId, status};
                    axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/products/${id}`, data)
                        .then(() => {
                            Swal.fire({
                                icon: "success",
                                title: "C·∫≠p nh·∫≠t th√†nh c√¥ng!",
                                showConfirmButton: false,
                                timer: 1500
                            });

                            bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();

                            const index = allProducts.findIndex(p => p.id == id);
                            if (index !== -1) {
                                allProducts[index] = {
                                    ...allProducts[index],
                                    name,
                                    description,
                                    category: {
                                        id: categoryId,
                                        name: document.querySelector(`#editCategoryId option[value="${categoryId}"]`)?.innerText || ""
                                    },
                                    status
                                };
                            }

                            if (currentSort.key) {
                                renderSortedProducts();
                            } else {
                                renderPageFromData(allProducts, currentPage);
                            }
                        })
                        .catch(err => {
                            Swal.fire({
                                icon: "error",
                                title: "L·ªói khi c·∫≠p nh·∫≠t s·∫£n ph·∫©m",
                                text: err.response?.data?.message || "Kh√¥ng r√µ l·ªói",
                            });
                        })
                        .finally(() => {
                            btn.disabled = false;
                            btn.innerText = "C·∫≠p Nh·∫≠t";
                        });
                });
        });
    }

    function addViewImageListeners() {

        document.querySelectorAll(".btn-view-images").forEach(btn => {
            btn.addEventListener("click", function () {
                const productId = this.dataset.id;
                const imageContainer = document.getElementById("imageContainer");
                const fileInput = document.getElementById("imageUploader");
                const deleteAllBtn = document.getElementById("deleteAllBtn");

                imageContainer.innerHTML = "";

                deleteAllBtn.onclick = () => {
                    axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/${productId}/images`)
                        .then(res => {
                            const images = res.data;
                            if (images.length === 0) {
                                Swal.fire("Th√¥ng b√°o", "Kh√¥ng c√≥ ·∫£nh n√†o ƒë·ªÉ xo√°.", "info");
                                return;
                            }

                            Swal.fire({
                                title: "X√°c nh·∫≠n xo√°?",
                                text: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° t·∫•t c·∫£ ·∫£nh c·ªßa s·∫£n ph·∫©m n√†y kh√¥ng?",
                                icon: "warning",
                                showCancelButton: true,
                                confirmButtonText: "Xo√° t·∫•t c·∫£",
                                cancelButtonText: "Hu·ª∑"
                            }).then(result => {
                                if (result.isConfirmed) {
                                    const deletePromises = images.map(img =>
                                        axios.delete(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/images/${img.id}`)
                                    );

                                    Promise.all(deletePromises)
                                        .then(() => {
                                            imageContainer.innerHTML = "";
                                            renderAddSlots(imageContainer, fileInput);
                                            Swal.fire("Th√†nh c√¥ng", "ƒê√£ xo√° t·∫•t c·∫£ ·∫£nh.", "success");
                                        })
                                        .catch(err => {
                                            console.error(err);
                                            Swal.fire("L·ªói", "Xo√° ·∫£nh l·ªói", "error");
                                        });
                                }
                            });
                        });
                };

                axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/${productId}/images`)
                    .then(res => {
                        const images = res.data;

                        images.forEach(img => {
                            const box = createImageBox(img.imageUrl, img.id, productId);
                            imageContainer.appendChild(box);
                        });

                        renderAddSlots(imageContainer, fileInput);

                        fileInput.onchange = () => {
                            const files = Array.from(fileInput.files);
                            if (files.length === 0) return;

                            const currentImages = imageContainer.querySelectorAll(".image-box:not(.add-btn)").length;
                            const availableSlots = 5 - currentImages;

                            if (files.length > availableSlots) {
                                Swal.fire("Gi·ªõi h·∫°n", `Ch·ªâ c√≥ th·ªÉ t·∫£i t·ªëi ƒëa ${availableSlots} ·∫£nh n·ªØa.`, "warning");
                                return;
                            }

                            const filesToUpload = files.slice(0, availableSlots);

                            filesToUpload.forEach(file => {
                                const formData = new FormData();
                                formData.append("file", file);

                                axios.post(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/upload-image`, formData)
                                    .then(res => {
                                        const imageId = res.data.id;
                                        const imageUrl = res.data.imageUrl;
                                        const newBox = createImageBox(imageUrl, imageId, productId);
                                        const addBtn = imageContainer.querySelector(".add-btn");

                                        if (addBtn) {
                                            imageContainer.replaceChild(newBox, addBtn);
                                        } else {
                                            imageContainer.appendChild(newBox);
                                        }

                                        renderAddSlots(imageContainer, fileInput);
                                    })
                                    .catch(err => {
                                        console.error(err);
                                        Swal.fire("L·ªói", "T·∫£i ·∫£nh th·∫•t b·∫°i", "error");
                                    });
                            });

                            fileInput.value = "";
                        };

                        const modalInstance = new bootstrap.Modal(document.getElementById('viewImageModal'), {
                            backdrop: 'static',
                            keyboard: false
                        });
                        modalInstance.show();
                    });
            });
        });

        // ‚úÖ t·∫°o √¥ hi·ªÉn th·ªã ·∫£nh t·ª´ server
        function createImageBox(imageUrl, imageId, productId) {
            const wrapper = document.createElement("div");
            wrapper.className = "image-wrapper text-center";

            const box = document.createElement("div");
            box.className = "image-box";

            const image = document.createElement("img");
            image.src = "/AgriculturalWarehouseManagementApplication/seller/" + imageUrl;
            image.alt = "Product Image";

            box.appendChild(image);

            // T·∫°o h·ªôp ch·ª©a n√∫t ƒëi·ªÅu khi·ªÉn (x√≥a + zoom)
            const controlBox = document.createElement("div");
            controlBox.className = "image-controls mt-2 d-flex justify-content-center gap-2";

            // ‚ùå N√∫t x√≥a (icon X)
            const delBtn = document.createElement("button");
            delBtn.className = "btn btn-sm btn-outline-danger";
            delBtn.innerHTML = "<i class='bi bi-x-lg'></i>"; // Bootstrap icon X
            delBtn.title = "Delete Image";

            delBtn.addEventListener("click", () => {
                axios.delete(`/AgriculturalWarehouseManagementApplication/api/seller/product/${productId}/images/${imageId}`)
                    .then(() => {
                        const box = delBtn.closest(".image-box");
                        const wrapper = delBtn.closest(".image-wrapper");

                        if (wrapper.classList.contains("from-slot")) {
                            box.innerHTML = "+";
                            box.className = "image-box add-btn";
                            box.onclick = () => document.getElementById("imageUploader").click();

                            wrapper.classList.remove("from-slot");
                            wrapper.innerHTML = "";
                            wrapper.appendChild(box);
                        } else {
                            wrapper.remove();
                        }

                        renderAddSlots(document.getElementById("imageContainer"), document.getElementById("imageUploader"));
                    })
                    .catch(err => alert("Xo√° ·∫£nh l·ªói"));
            });

            // üîç N√∫t zoom (ph√≥ng ·∫£nh to)
            const zoomBtn = document.createElement("button");
            zoomBtn.className = "btn btn-sm btn-outline-primary";
            zoomBtn.innerHTML = "<i class='bi bi-zoom-in'></i>"; // Bootstrap icon zoom
            zoomBtn.title = "Zoom Image";

            zoomBtn.addEventListener("click", () => {
                const zoomWindow = window.open(image.src, "_blank");
                zoomWindow.focus();
            });

            // G·∫Øn n√∫t v√†o controlBox
            controlBox.appendChild(zoomBtn);
            controlBox.appendChild(delBtn);

            // Th√™m v√†o wrapper
            wrapper.appendChild(box);
            wrapper.appendChild(controlBox);

            return wrapper;
        }

        // ‚úÖ render slot "+"
        function renderAddSlots(container, fileInput) {
            // ‚ùå Xo√° t·∫•t c·∫£ slot "+" c≈© n·∫øu c√≤n
            container.querySelectorAll(".add-btn").forEach(btn => btn.remove());

            const currentImageCount = container.querySelectorAll(".image-box:not(.add-btn)").length;
            const availableSlots = 5 - currentImageCount;

            for (let i = 0; i < availableSlots; i++) {
                const plusBox = document.createElement("div");
                plusBox.className = "image-box add-btn";
                plusBox.innerText = "+";
                plusBox.addEventListener("click", () => fileInput.click());
                container.appendChild(plusBox);
            }
        }

        // ‚úÖ G·∫Øn s·ª± ki·ªán ngƒÉn modal ƒë√≥ng n·∫øu kh√¥ng c√≥ ·∫£nh
        document.getElementById('viewImageModal').addEventListener('hide.bs.modal', function (e) {
            const imageContainer = document.getElementById("imageContainer");
            const imageCount = imageContainer.querySelectorAll(".image-box:not(.add-btn)").length;

            if (imageCount === 0) {
                e.preventDefault();
                Swal.fire({
                    icon: 'warning',
                    title: 'C·∫ßn √≠t nh·∫•t m·ªôt ·∫£nh',
                    text: 'B·∫°n ph·∫£i th√™m √≠t nh·∫•t m·ªôt ·∫£nh cho s·∫£n ph·∫©m tr∆∞·ªõc khi ƒë√≥ng.'
                });
            }
        });
    }

    window.addEventListener("beforeunload", function (e) {
        const imageContainer = document.getElementById("imageContainer");
        const modal = document.getElementById("viewImageModal");
        const isOpen = modal.classList.contains("show");

        if (isOpen && imageContainer) {
            const imageCount = imageContainer.querySelectorAll(".image-box:not(.add-btn)").length;
            if (imageCount === 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        }
    });

</script>

<!--Filter theo view detail-->
<script>
    function setupProductViewButtons() {
        const viewButtons = document.querySelectorAll('.btn-view');
        viewButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const productId = this.dataset.id;

                // üëâ 1. Chuy·ªÉn tab sang "Product Detail"
                const detailTab = new bootstrap.Tab(document.getElementById('pills-product-detail-tab'));
                detailTab.show();

                // üëâ 2. Set dropdown filter b√™n Product Detail
                const filterDropdown = document.getElementById('productFilter');
                filterDropdown.value = productId;

                // üëâ 3. G·ªçi h√†m load Product Detail theo productId
                loadProductDetails(productId);

                // üëâ 4. Scroll xu·ªëng b·∫£ng chi ti·∫øt (n·∫øu mu·ªën)
                setTimeout(() => {
                    document.getElementById('pills-product-detail').scrollIntoView({behavior: 'smooth'});
                }, 300);
            });
        });
    }

    document.addEventListener("click", function (e) {
        const viewBtn = e.target.closest(".btn-view");
        if (viewBtn) {
            const productId = viewBtn.dataset.id;

            preventResetProductDetail = true; // üëà B·∫≠t c·ªù

            const detailTab = new bootstrap.Tab(document.getElementById('pills-product-detail-tab'));
            detailTab.show();

            document.getElementById('productFilter').value = productId;
            selectedProductId = productId;
            loadProductDetails(productId);

            setTimeout(() => {
                document.getElementById('pills-product-detail').scrollIntoView({behavior: 'smooth'});
            }, 300);
        }
    });

</script>

<!--Ph√¢n trang Product-->
<script>
    let currentPage = 1;
    const pageSize = 5;
    let allProducts = [];

    function renderPaginationTemplate(totalItems, currentPage) {
        const totalPages = Math.ceil(totalItems / pageSize);
        const paginationUl = document.querySelector(".custom-pagination ul");
        paginationUl.innerHTML = "";

        if (totalPages <= 1) return;

        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = startPage + maxVisiblePages - 1;

        if (endPage > totalPages) {
            endPage = totalPages;
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        function goToPage(page) {
            currentPage = page;
            if (currentSort.key) {
                renderSortedProducts(page);
            } else {
                loadProducts(page);
            }
        }

        // <<< V·ªÅ ƒë·∫ßu
        const firstLi = document.createElement("li");
        firstLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        firstLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="V·ªÅ trang ƒë·∫ßu"><i class="fa-solid fa-angles-left"></i></a>`;
        if (currentPage !== 1) {
            firstLi.onclick = () => {
                if (currentSort.key && currentSort.order) {
                    renderSortedProducts(1);
                } else {
                    loadProducts(1);
                }
            };
        }
        paginationUl.appendChild(firstLi);

        // << Trang tr∆∞·ªõc
        const prevLi = document.createElement("li");
        prevLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        prevLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="Trang tr∆∞·ªõc"><i class="fa-solid fa-angle-left"></i></a>`;
        if (currentPage !== 1) prevLi.onclick = () => goToPage(currentPage - 1);
        paginationUl.appendChild(prevLi);

        // ... ƒë·∫ßu n·∫øu c·∫ßn
        if (startPage > 1) {
            const dots = document.createElement("li");
            dots.className = "page-item disabled";
            dots.innerHTML = `<span class="page-link">...</span>`;
            paginationUl.appendChild(dots);
        }

        // C√°c trang gi·ªØa
        for (let i = startPage; i <= endPage; i++) {
            const li = document.createElement("li");
            li.className = "page-item" + (i === currentPage ? " active" : "");
            li.innerHTML = `<a class="page-link" href="javascript:void(0)">${i}</a>`;
            li.onclick = () => {
                if (currentSort.key && currentSort.order) {
                    renderSortedProducts(i); // üëâ d√πng sort
                } else {
                    loadProducts(i);        // üëâ m·∫∑c ƒë·ªãnh
                }
            };
            paginationUl.appendChild(li);
        }

        // ... cu·ªëi n·∫øu c·∫ßn
        if (endPage < totalPages) {
            const dots = document.createElement("li");
            dots.className = "page-item disabled";
            dots.innerHTML = `<span class="page-link">...</span>`;
            paginationUl.appendChild(dots);
        }

        // >> Trang sau
        const nextLi = document.createElement("li");
        nextLi.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        nextLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="Trang ti·∫øp theo"><i class="fa-solid fa-angle-right"></i></a>`;
        if (currentPage !== totalPages) nextLi.onclick = () => goToPage(currentPage + 1);
        paginationUl.appendChild(nextLi);

        // >>> T·ªõi cu·ªëi
        const lastLi = document.createElement("li");
        lastLi.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        lastLi.innerHTML = `<a class="page-link" href="javascript:void(0)" title="T·ªõi trang cu·ªëi"><i class="fa-solid fa-angles-right"></i></a>`;
        if (currentPage !== totalPages) lastLi.onclick = () => goToPage(totalPages);
        paginationUl.appendChild(lastLi);
    }
</script>

<!--Logic Tab Product End-->
<!--Tab Product End-->

<!--4. Tab Product Detail-->
<!--Modal Add Product Detail-->
<div class="modal fade" id="addProductDetailModal" tabindex="-1" aria-labelledby="addProductDetailModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="addProductDetailForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductDetailModalLabel">Th√™m Chi Ti·∫øt S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">T√™n</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="productId" required>
                                <option value="" disabled selected>Ch·ªçn s·∫£n ph·∫©m...</option>
                                <!-- S·∫Ω ƒë∆∞·ª£c JS load -->
                            </select>
                        </div>
                    </div>

                    <!-- Category (readonly) -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Danh m·ª•c</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="categoryName" readonly>
                            <input type="hidden" id="categoryIdHidden"> <!-- d√πng cho JS -->
                        </div>
                    </div>

                    <!-- Radio ch·ªçn ch·∫ø ƒë·ªô -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Ch·ªçn ch·∫ø ƒë·ªô kh·ªëi l∆∞·ª£ng</label><br/>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="weightMode" id="availableWeightOption"
                                   checked/>
                            <label class="form-check-label" for="availableWeightOption">Kh·ªëi l∆∞·ª£ng c√≥ s·∫µn c·ªßa danh
                                m·ª•c</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="weightMode" id="customWeightOption"/>
                            <label class="form-check-label" for="customWeightOption">T√πy ch·ªânh kh·ªëi l∆∞·ª£ng / ƒë∆°n
                                v·ªã</label>
                        </div>
                    </div>

                    <!-- Available -->
                    <div id="availableWeightSection" class="mb-3">
                        <label class="form-label fw-bold">Kh·ªëi l∆∞·ª£ng c√≥ s·∫µn c·ªßa danh m·ª•c</label>
                        <div id="weightUnitSelectContainer" class="d-flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Custom -->
                    <div id="customWeightSection" class="mb-3" style="display: none;">
                        <label class="form-label fw-bold">T√πy ch·ªânh kh·ªëi l∆∞·ª£ng / ƒë∆°n v·ªã</label>
                        <div class="d-flex align-items-center flex-wrap gap-2" required>
                            <input type="number" step="0.01" id="weight" class="form-control"
                                   placeholder="Nh·∫≠p kh·ªëi l∆∞·ª£ng..." style="max-width: 150px;"/>

                            <div id="unitButtonGroup" class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary" data-unit="g">g</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="kg">kg</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="ml">ml</button>
                                <button type="button" class="btn btn-outline-secondary" data-unit="l">l</button>
                            </div>

                            <input type="hidden" id="unit"/>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Gi√° (VNƒê)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="price" min="0" required>
                        </div>
                    </div>

                    <!-- Expiry -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">H·∫°n s·ª≠ d·ª•ng (th√°ng)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="expiry" min="1" required>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="productDetailStatus" required>
                                <option value="" disabled selected>ƒêang t·∫£i tr·∫°ng th√°i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-success">ƒê·ªìng √Ω</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--Modal Add Product Detail End-->

<!--Modal Edit Product Detail-->
<div class="modal fade" id="editProductDetailModal" tabindex="-1" aria-labelledby="editProductDetailModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editProductDetailForm" class="theme-form theme-form-2 mega-form">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductDetailModalLabel">Ch·ªânh S·ª≠a Chi Ti·∫øt S·∫£n Ph·∫©m</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Product Name -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">T√™n s·∫£n ph·∫©m</label>
                        <div class="col-sm-9">
                            <input type="text" id="editProductNameInDetail" class="form-control" readonly>
                        </div>
                    </div>

                    <!-- Weight + Unit -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Chi ti·∫øt</label>
                        <div class="col-sm-4">
                            <input type="number" step="0.01" id="editWeight" class="form-control"
                                   placeholder="Kh·ªëi l∆∞·ª£ng (vd: 150)">
                        </div>
                        <div class="col-sm-5">
                            <select id="editUnit" class="form-select">
                                <option value="g">g</option>
                                <option value="kg">kg</option>
                                <option value="ml">ml</option>
                                <option value="l">l</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 text-muted small fst-italic text-end me-3">
                        Vui l√≤ng kh√¥ng nh·∫≠p tr√πng v·ªõi nh·ªØng chi ti·∫øt c√≥ s·∫µn c·ªßa s·∫£n ph·∫©m n√†y.
                    </div>

                    <!-- Price -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Gi√° (VNƒê)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="editPrice" min="0" required>
                        </div>
                    </div>

                    <!-- Expiry -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">H·∫°n s·ª≠ d·ª•ng (th√°ng)</label>
                        <div class="col-sm-9">
                            <input type="number" class="form-control" id="editExpiry" min="1" required>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="mb-4 row align-items-center">
                        <label class="col-sm-3 col-form-label">Tr·∫°ng th√°i</label>
                        <div class="col-sm-9">
                            <select class="form-select" id="editStatusInDetail" required>
                                <option value="">ƒêang t·∫£i...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-success">C·∫≠p Nh·∫≠t</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--Modal Edit Product Detail End-->

<!--CSS Product Detail-->
<style>
    .product-detail-table th,
    .product-detail-table td {
        border-right: 1px solid #dee2e6;
    }

    .product-detail-table th:last-child,
    .product-detail-table td:last-child {
        border-right: none;
    }

    .product-detail-table {
        border-collapse: collapse;
    }

    .product-detail-table {
        width: 100%;
        border-collapse: collapse;
        background-color: #fff;
    }

    .product-detail-table thead th {
        font-weight: 600;
        padding: 12px 10px;
        color: #333;
        text-align: center;
        border-bottom: 1px solid #eee !important; /* ‚úÖ CH·ªàNH L·∫†I ƒê·ªò ƒê·∫¨M */
    }

    .product-detail-table tbody td {
        border-bottom: 1px solid #eee;
        padding: 12px 10px;
        vertical-align: middle;
        color: #444;
    }

    .product-detail-table tbody tr:hover {
        background-color: #f9f9f9;
    }

    .product-detail-table tbody td {
        text-align: center;
    }

    /* D√πng chung cho c·∫£ unit buttons v√† available weight buttons */
    .btn.weight-unit-btn,
    #unitButtonGroup .btn {
        padding: 4px 10px;
        font-size: 0.85rem;
        min-width: 50px;
        height: 32px;
        border: 2px solid #000000;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
        background-color: white;
        color: #000000;
    }

    .btn.weight-unit-btn:hover,
    #unitButtonGroup .btn:hover {
        background-color: #000000;
        color: #fff;
    }

    .btn.weight-unit-btn.active,
    #unitButtonGroup .btn.active,
    #unitButtonGroup .btn.btn-primary {
        background-color: #000000;
        color: white;
        border-color: #000000;
    }
</style>

<!--CRUD Product Detail-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadProductDropdown();
        loadProductDetailStatuses();
        loadProductFilterOptions();      // üëà Th√™m d√≤ng n√†y
        setupProductFilter();            // üëà Th√™m d√≤ng n√†y
        setupProductDropdownChange();
        setupAddProductDetailForm();
        setupUnitButtons();
        setupWeightModeToggle();

        loadProductDetails(); // Load b·∫£ng ban ƒë·∫ßu
    });


    let selectedProductId = null;
    let selectedCategoryId = null;

    const modal = document.getElementById('addProductDetailModal');
    modal.addEventListener('hidden.bs.modal', function () {
        const form = document.getElementById("addProductDetailForm");
        form.reset();

        document.getElementById("productId").value = "";
        document.getElementById("categoryName").value = "";
        document.getElementById("unit").value = "";
        document.getElementById("productDetailStatus").value = "";
        document.getElementById("weightUnitSelectContainer").innerHTML = "";
        const detailNameInput = document.getElementById("detailName");
        if (detailNameInput) detailNameInput.value = "";

        document.querySelectorAll('#unitButtonGroup button[data-unit]').forEach(btn => {
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-outline-secondary');
        });

        document.querySelectorAll('.weight-unit-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById("availableWeightOption").checked = true;
        document.getElementById("customWeightOption").checked = false;
        document.getElementById("availableWeightSection").style.display = "block";
        document.getElementById("customWeightSection").style.display = "none";

        selectedProductId = null;
        selectedCategoryId = null;
    });

    function loadProductDropdown() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
            .then(res => {
                const select = document.getElementById('productId');
                select.innerHTML = '<option value="" disabled selected>Ch·ªçn s·∫£n ph·∫©m...</option>';
                res.data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    select.appendChild(option);
                });
            });
    }

    function loadProductDetailStatuses() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/statuses')
            .then(res => {
                const select = document.getElementById('productDetailStatus');
                select.innerHTML = '<option value="" disabled selected>Ch·ªçn tr·∫°ng th√°i...</option>';
                res.data.forEach(status => {
                    const text = status.replace(/_/g, ' ');
                    const option = new Option(text, status);
                    select.add(option);
                });
            });
    }

    function setupAvailableWeightSelection() {
        const buttons = document.querySelectorAll(".weight-unit-btn");
        buttons.forEach(btn => {
            btn.addEventListener("click", function () {
                buttons.forEach(b => b.classList.remove("active"));
                this.classList.add("active");
            });
        });
    }

    function setupProductDropdownChange() {
        document.getElementById("productId").addEventListener("change", function () {
            const productId = this.value;
            selectedProductId = productId;

            axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/products/${productId}`)
                .then(res => {
                    const product = res.data;
                    const category = product.category;
                    selectedCategoryId = category.categoryId;
                    document.getElementById("categoryName").value = category.name;

                    axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/category-weights/${selectedCategoryId}`)
                        .then(weightRes => {
                            const list = weightRes.data;
                            const container = document.getElementById("weightUnitSelectContainer");
                            container.innerHTML = "";

                            list.forEach((item, index) => {
                                const button = document.createElement("button");
                                button.type = "button";
                                button.className = "btn weight-unit-btn btn-outline-secondary";
                                if (index === 0) {
                                    button.classList.add("active");
                                }
                                button.textContent = `${item.weight} ${item.unit}`;
                                button.dataset.weight = item.weight;
                                button.dataset.unit = item.unit;
                                container.appendChild(button);
                            });
                            setupAvailableWeightSelection();
                        });

                    // ‚ùå D√≤ng n√†y g√¢y l·ªói filter ngo√†i b·∫£ng khi ch·ªçn trong modal
                    // loadProductDetails(productId);
                });
        });
    }

    function setupUnitButtons() {
        const unitButtons = document.querySelectorAll('#unitButtonGroup button[data-unit]');
        const unitInput = document.getElementById("unit");

        unitButtons.forEach(btn => {
            btn.addEventListener("click", function () {
                unitInput.value = this.dataset.unit;
                unitButtons.forEach(b => b.classList.remove("btn-primary", "btn-outline-secondary"));
                unitButtons.forEach(b => b.classList.add("btn-outline-secondary"));
                this.classList.remove("btn-outline-secondary");
                this.classList.add("btn-primary");
            });
        });
    }

    function setupAddProductDetailForm() {
        const form = document.getElementById("addProductDetailForm");
        const btn = form.querySelector("button[type='submit']");

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            btn.disabled = true;
            btn.innerText = "ƒêang l∆∞u...";
            let weight = null;
            let unit = null;

            const isAvailableMode = document.getElementById("availableWeightOption").checked;

            if (isAvailableMode) {
                const selectedBtn = document.querySelector("#weightUnitSelectContainer .weight-unit-btn.active");
                if (!selectedBtn) {
                    Swal.fire("Th√¥ng b√°o", "Vui l√≤ng ch·ªçn Available Weight!", "warning");
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                    return;
                }
                weight = parseFloat(selectedBtn.dataset.weight);
                unit = selectedBtn.dataset.unit;
            } else {
                const weightInput = document.getElementById("weight").value;
                const unitInput = document.getElementById("unit").value.trim();

                if (!weightInput || isNaN(parseFloat(weightInput))) {
                    Swal.fire("Th√¥ng b√°o", "Vui l√≤ng nh·∫≠p kh·ªëi l∆∞·ª£ng h·ª£p l·ªá.", "warning");
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                    return;
                }

                if (!unitInput) {
                    Swal.fire("Th√¥ng b√°o", "Vui l√≤ng ch·ªçn ƒë∆°n v·ªã.", "warning");
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                    return;
                }

                weight = parseFloat(weightInput);
                unit = unitInput;
            }

            const userId = "[[${session.accountIdSeller}]]";

            const dto = {
                productId: selectedProductId,
                weight: weight,
                unit: unit,
                price: parseFloat(document.getElementById("price").value),
                expiry: parseInt(document.getElementById("expiry").value),
                status: document.getElementById("productDetailStatus").value,
                userId: parseInt(userId)
            };

            axios.post('/AgriculturalWarehouseManagementApplication/api/seller/product-details', dto)
                .then(() => {
                    Swal.fire("Th√†nh c√¥ng", "Th√™m chi ti·∫øt m·ªõi th√†nh c√¥ng.", "success");
                    bootstrap.Modal.getInstance(document.getElementById('addProductDetailModal')).hide();

                    form.reset();
                    document.getElementById("productId").value = "";
                    document.getElementById("categoryName").value = "";
                    document.getElementById("unit").value = "";
                    document.getElementById("productDetailStatus").value = "";
                    document.getElementById("weightUnitSelectContainer").innerHTML = "";
                    const detailNameInput = document.getElementById("detailName");
                    if (detailNameInput) detailNameInput.value = "";

                    document.querySelectorAll('#unitButtonGroup button[data-unit]').forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-outline-secondary');
                    });

                    selectedProductId = null;
                    selectedCategoryId = null;

                    // üëá T·∫£i l·∫°i to√†n b·ªô ƒë·ªÉ t√≠nh trang cu·ªëi
                    axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/all-dto')
                        .then(res => {
                            document.getElementById("productFilter").value = "";
                            const totalItems = res.data.length;
                            const lastPage = Math.ceil(totalItems / pageSizeDetail);
                            loadProductDetails(null, lastPage);
                        });
                })
                .catch(err => {
                    if (err.response?.data?.message) {
                        Swal.fire("L·ªói", "L·ªói khi th√™m Product Detail: " + err.response.data.message, "error");
                    } else {
                        Swal.fire("L·ªói", "L·ªói khi th√™m Product Detail.", "error");
                        console.error(err);
                    }
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerText = "Th√™m Chi Ti·∫øt";
                });
        });
    }

    function setupWeightModeToggle() {
        const availableRadio = document.getElementById("availableWeightOption");
        const customRadio = document.getElementById("customWeightOption");
        const availableSection = document.getElementById("availableWeightSection");
        const customSection = document.getElementById("customWeightSection");

        document.querySelectorAll('input[name="weightMode"]').forEach(radio => {
            radio.addEventListener("change", () => {
                if (availableRadio.checked) {
                    availableSection.style.display = "block";
                    customSection.style.display = "none";

                    // ‚ùå Reset unit khi quay l·∫°i ch·∫ø ƒë·ªô available
                    document.getElementById("unit").value = "";
                    document.querySelectorAll('#unitButtonGroup button[data-unit]').forEach(btn => {
                        btn.classList.remove("btn-primary");
                        btn.classList.add("btn-outline-secondary");
                    });

                } else {
                    availableSection.style.display = "none";
                    customSection.style.display = "block";

                    // ‚úÖ M·∫∑c ƒë·ªãnh ch·ªçn "g" n·∫øu ch∆∞a ch·ªçn ƒë∆°n v·ªã n√†o
                    const unitInput = document.getElementById("unit");
                    if (!unitInput.value) {
                        const defaultBtn = document.querySelector('#unitButtonGroup button[data-unit="g"]');
                        if (defaultBtn) {
                            defaultBtn.click(); // G·ªçi s·ª± ki·ªán click ƒë·ªÉ set ƒë∆°n v·ªã v√† ƒë·ªïi m√†u n√∫t
                        }
                    }
                }
            });
        });
    }

    function loadProductDetails(productId = null, page = 1) {
        currentPageDetail = page;

        const url = productId
            ? `/AgriculturalWarehouseManagementApplication/api/seller/product-details/product-dto/${productId}`
            : `/AgriculturalWarehouseManagementApplication/api/seller/product-details/all-dto`;

        axios.get(url)
            .then(res => {
                allProductDetails = res.data;

                const start = (page - 1) * pageSizeDetail;
                const end = start + pageSizeDetail;
                const paginated = allProductDetails.slice(start, end);

                const tbody = document.getElementById("productDetailTable");
                tbody.innerHTML = "";

                paginated.forEach((item, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
        <td>${start + index + 1}</td>
        <td class="fw-bold">${item.productName}</td>
        <td class="fw-medium">${item.detailName}</td>
        <td class="text-muted">${item.sellerEmail || 'N/A'}</td>
        <td><strong style="color:#28a745;">${item.price.toLocaleString()}‚Ç´</strong></td>
        <td>${item.expiry}</td>
        <td><span class="badge px-3 py-2 fw-semibold text-white" style="background-color: ${getStatusColor(item.status)}; color: white;">${item.status.replace(/_/g, ' ')}</span></td>
    </span>
        <td class="text-center align-middle">
            <ul class="option-list d-flex justify-content-center gap-2 list-unstyled m-0">
                <li>
                    <button class="btn btn-sm btn-outline-primary btn-edit-detail" title="Ch·ªânh s·ª≠a" data-id="${item.id}">
                        <i class="ri-pencil-line"></i>
                    </button>
                </li>
                <li>
                    <button class="btn btn-sm btn-outline-danger btn-delete-product-detail"
                        title="${item.status === 'INACTIVE' ? 'Chi ti·∫øt s·∫£n ph·∫©m ƒë√£ ng·ª´ng kinh doanh' : 'Ng·ª´ng kinh doanh'}"
                        data-id="${item.id}"
                        ${item.status === 'INACTIVE' ? 'disabled' : ''}>
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </li>
            </ul>
        </td>
    `;
                    tbody.appendChild(row);
                });

                renderPaginationProductDetail(allProductDetails.length, page, (newPage) => {
                    loadProductDetails(productId, newPage);
                });

                setupProductDetailActions?.();
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi t·∫£i chi ti·∫øt s·∫£n ph·∫©m:", err);
            });
    }

    function getStatusColor(status) {
        switch (status) {
            case "ACTIVE":
                return "green";
            case "INACTIVE":
                return "red";
            default:
                return "black";
        }
    }

    // Set m·∫∑c ƒë·ªãnh cho radio
    document.getElementById("availableWeightOption").checked = true;
    document.getElementById("customWeightOption").checked = false;
    document.getElementById("availableWeightSection").style.display = "block";
    document.getElementById("customWeightSection").style.display = "none";

    function loadProductFilterOptions() {
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/products')
            .then(res => {
                const filterSelect = document.getElementById('productFilter');
                filterSelect.innerHTML = '<option value="">T·∫•t c·∫£ s·∫£n ph·∫©m</option>';
                res.data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    filterSelect.appendChild(option);
                });
            });
    }

    function setupProductFilter() {
        const filterSelect = document.getElementById("productFilter");
        filterSelect.addEventListener("change", function () {
            const productId = this.value;
            if (productId) {
                loadProductDetails(productId); // Load theo s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn
            } else {
                loadProductDetails(); // Load t·∫•t c·∫£
            }
        });
    }

    document.addEventListener("click", function (e) {
        const editBtn = e.target.closest(".btn-edit-detail");
        if (editBtn) {
            const id = editBtn.dataset.id;
            openEditProductDetailModal(id);
        }

        const deleteBtn = e.target.closest(".btn-delete-product-detail");
        if (deleteBtn) {
            const id = deleteBtn.dataset.id;

            Swal.fire({
                title: 'B·∫°n ch·∫Øc ch·ª©?',
                text: "Chi ti·∫øt s·∫£n ph·∫©m s·∫Ω ng·ª´ng kinh doanh!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'X√°c nh·∫≠n',
                cancelButtonText: 'Hu·ª∑'
            }).then((result) => {
                if (result.isConfirmed) {
                    softDeleteProductDetail(id);
                }
            });
        }
    });

    function openEditProductDetailModal(id) {
        // Load danh s√°ch tr·∫°ng th√°i tr∆∞·ªõc khi hi·ªÉn th·ªã modal
        axios.get('/AgriculturalWarehouseManagementApplication/api/seller/product-details/statuses')
            .then(res => {
                const select = document.getElementById('editStatusInDetail');
                select.innerHTML = '<option value="">Ch·ªçn tr·∫°ng th√°i...</option>';
                res.data.forEach(status => {
                    const text = status.replace(/_/g, ' ');
                    const option = new Option(text, status);
                    select.add(option);
                });

                // Sau khi load xong tr·∫°ng th√°i, m·ªõi ti·∫øp t·ª•c load chi ti·∫øt
                return axios.get(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/${id}`);
            })
            .then(res => {
                const detail = res.data;

                document.getElementById("editProductNameInDetail").value = detail.productName;
                document.getElementById("editWeight").value = detail.weight;
                document.getElementById("editUnit").value = detail.unit;
                document.getElementById("editPrice").value = detail.price;
                document.getElementById("editExpiry").value = detail.expiry;
                document.getElementById("editStatusInDetail").value = detail.status;

                // ‚úÖ L∆∞u l·∫°i d·ªØ li·ªáu g·ªëc ƒë·ªÉ so s√°nh sau
                const form = document.getElementById("editProductDetailForm");
                form.dataset.id = id;
                form.dataset.originalWeight = detail.weight;
                form.dataset.originalUnit = detail.unit;

                const modal = new bootstrap.Modal(document.getElementById("editProductDetailModal"));
                modal.show();
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi m·ªü modal ch·ªânh s·ª≠a:", err);
                alert("Kh√¥ng th·ªÉ hi·ªÉn th·ªã chi ti·∫øt s·∫£n ph·∫©m.");
            });
    }

    document.getElementById("editProductDetailForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const id = this.dataset.id;
        const dto = {
            weight: parseFloat(document.getElementById("editWeight").value),
            unit: document.getElementById("editUnit").value,
            price: parseFloat(document.getElementById("editPrice").value),
            expiry: parseInt(document.getElementById("editExpiry").value),
            status: document.getElementById("editStatusInDetail").value
        };

        axios.put(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/${id}`, dto)
            .then(() => {
                Swal.fire({
                    icon: "success",
                    title: "Th√†nh c√¥ng",
                    text: "C·∫≠p nh·∫≠t chi ti·∫øt s·∫£n ph·∫©m th√†nh c√¥ng.",
                    timer: 2000,
                    showConfirmButton: false
                });

                bootstrap.Modal.getInstance(document.getElementById("editProductDetailModal")).hide();

                const currentFilterId = document.getElementById("productFilter").value;
                loadProductDetails(currentFilterId || null, currentPageDetail);
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t:", err);
                let msg = "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t chi ti·∫øt.";
                if (err.response?.data?.message) {
                    msg = "L·ªói khi c·∫≠p nh·∫≠t: " + err.response.data.message;
                }

                Swal.fire({
                    icon: "error",
                    title: "L·ªói",
                    text: msg
                });
            });
    });

    function softDeleteProductDetail(id) {
        axios.delete(`/AgriculturalWarehouseManagementApplication/api/seller/product-details/${id}`)
            .then(() => {
                Swal.fire({
                    icon: "success",
                    title: "ƒê√£ xo√° m·ªÅm",
                    text: "Chi ti·∫øt s·∫£n ph·∫©m ƒë√£ chuy·ªÉn sang INACTIVE.",
                    timer: 2000,
                    showConfirmButton: false
                });

                const currentFilterId = document.getElementById("productFilter").value;
                loadProductDetails(currentFilterId || null, currentPageDetail);
            })
            .catch(err => {
                console.error("‚ùå L·ªói khi x√≥a m·ªÅm:", err);
                Swal.fire({
                    icon: "error",
                    title: "L·ªói",
                    text: "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i."
                });
            });
    }


</script>

<!--Ph√¢n trang Product Detail-->
<script>
    let allProductDetails = [];
    let currentPageDetail = 1;
    const pageSizeDetail = 5;

    function renderPaginationProductDetail(totalItems, currentPage, callback) {
        const totalPages = Math.ceil(totalItems / pageSizeDetail);
        const paginationUl = document.getElementById("paginationProductDetail");
        paginationUl.innerHTML = "";

        if (totalPages <= 1) return;

        function createLi(page, label, isActive = false, isDisabled = false, title = "") {
            const li = document.createElement("li");
            li.className = `page-item${isActive ? " active" : ""}${isDisabled ? " disabled" : ""}`;
            li.innerHTML = `<a class="page-link" href="#" title="${title}">${label}</a>`;
            if (!isActive && !isDisabled) {
                li.querySelector("a").addEventListener("click", (e) => {
                    e.preventDefault();
                    callback(page);
                });
            }
            return li;
        }

        paginationUl.appendChild(createLi(1, '<i class="fa-solid fa-angles-left"></i>', false, currentPage === 1, "V·ªÅ trang ƒë·∫ßu"));
        paginationUl.appendChild(createLi(currentPage - 1, '<i class="fa-solid fa-angle-left"></i>', false, currentPage === 1, "Trang tr∆∞·ªõc"));

        const maxVisible = 5;
        let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
        let end = start + maxVisible - 1;
        if (end > totalPages) {
            end = totalPages;
            start = Math.max(1, end - maxVisible + 1);
        }

        for (let i = start; i <= end; i++) {
            paginationUl.appendChild(createLi(i, i, i === currentPage));
        }

        paginationUl.appendChild(createLi(currentPage + 1, '<i class="fa-solid fa-angle-right"></i>', false, currentPage === totalPages, "Trang sau"));
        paginationUl.appendChild(createLi(totalPages, '<i class="fa-solid fa-angles-right"></i>', false, currentPage === totalPages, "T·ªõi trang cu·ªëi"));
    }

</script>

<!--Tab Product Detail End-->

<!--5. Tab Order-->
<!--CRUD Order-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabLinks = document.querySelectorAll('.user-nav-pills .nav-link');
        let isOrderTableInitialized = false;

        const BASE_URL = "/AgriculturalWarehouseManagementApplication/api/seller/orders";

        function loadOrderData() {
            fetch(BASE_URL)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("orderTableBody");
                    tbody.innerHTML = ""; // reset

                    data.forEach((order, index) => {
                        const row = document.createElement("tr");

                        let statusColor = "#6c757d"; // default: gray
                        switch (order.status) {
                            case "PENDING":
                                statusColor = "#e8a512"; // v√†ng (warning)
                                break;
                            case "CONFIRMED":
                                statusColor = "#188552"; // xanh l√° c√¢y (green)
                                break;
                            case "CANCELLED":
                                statusColor = "#e55353"; // ƒë·ªè s√°ng h∆°n (danger)
                                break;
                            case "STOCKOUT":
                                statusColor = "#5c636e"; // x√°m nh·∫°t (secondary)
                                break;
                            case "DELIVERED":
                                statusColor = "#0d6efd"; // xanh d∆∞∆°ng Bootstrap
                                break;
                            case "COMPLETED":
                                statusColor = "#6610f2"; // t√≠m (ho√†n th√†nh)
                                break;
                        }


                        row.innerHTML = `
  <td>${index + 1}</td>
  <td class="text-secondary fw-medium">${order.orderCode}</td>
  <td>${new Date(order.orderDate).toLocaleString()}</td>
  <td>${order.phone}</td>
  <td class="text-body">${order.address}</td>
  <td class="text-success fw-bold">${order.totalAmount.toLocaleString()}</td>
  <td class="text-danger fw-bold">${order.finalAmount.toLocaleString()}</td>
  <td>
    <span class="order-status ${order.status}"
          style="color: white; background-color: ${statusColor}; font-weight: 600; padding: 4px 10px; border-radius: 12px; display: inline-block; text-transform: capitalize;">
      ${order.status.replace(/_/g, ' ')}
    </span>
  </td>
  <td class="text-center">
    <div class="d-flex justify-content-center align-items-center gap-2">
      <button class="btn btn-sm btn-primary confirm-btn ${order.status !== 'PENDING' ? 'disabled-btn' : ''}"
              data-order-id="${order.orderId}"
              title="X√°c nh·∫≠n"
              ${order.status !== 'PENDING' ? 'disabled' : ''}>
        <i class="bi bi-check-circle icon-circle me-1"></i>
      </button>
      <button class="btn btn-sm btn-tracking-custom ${order.status === 'CANCELLED' ? 'disabled-btn' : ''}"
              data-order-id="${order.orderId}"
              title="Theo d√µi ƒë∆°n h√†ng"
              ${order.status === 'CANCELLED' ? 'disabled' : ''}>
        Theo d√µi ƒë∆°n h√†ng
      </button>
    </div>
  </td>
`;
                        tbody.appendChild(row);
                    });

                    // Kh·ªüi t·∫°o DataTable sau khi c√≥ d·ªØ li·ªáu
                    if (!isOrderTableInitialized) {
                        $(document).ready(function () {
                            $.fn.DataTable.ext.pager.numbers_length = 7; // üëà Gi·ªõi h·∫°n 5 n√∫t trang

                            const table = $('#orderTable').DataTable({
                                pageLength: 5,
                                lengthMenu: [1, 3, 5, 7],
                                paging: true,
                                searching: true,
                                info: true,
                                ordering: true,
                                responsive: true, // üëà T·ªëi ∆∞u cho thi·∫øt b·ªã nh·ªè
                                autoWidth: false, // üëà Tr√°nh gi√£n c·ªôt b·∫•t h·ª£p l√Ω
                                mark: true,
                                language: {
                                    search: "üîç T√¨m ki·∫øm:",
                                    lengthMenu: "Hi·ªÉn th·ªã _MENU_ d√≤ng m·ªói trang",
                                    info: "Hi·ªÉn th·ªã _START_ ƒë·∫øn _END_ c·ªßa _TOTAL_ d√≤ng",
                                    infoEmpty: "Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã",
                                    zeroRecords: "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p",
                                    paginate: {
                                        previous: "<< Tr∆∞·ªõc",
                                        next: "Sau >>"
                                    },
                                },
                                columnDefs: [
                                    {targets: -1, orderable: false}
                                ]
                            });

                            table.on('order.dt search.dt draw.dt', function () {
                                let pageInfo = table.page.info();
                                table.column(0, {search: 'applied', order: 'applied', page: 'current'})
                                    .nodes()
                                    .each(function (cell, i) {
                                        cell.innerHTML = i + 1 + pageInfo.start;
                                    });
                            }).draw();
                        });
                        isOrderTableInitialized = true;
                    }
                })
                .catch(err => {
                    console.error("L·ªói khi t·∫£i ƒë∆°n h√†ng:", err);
                });
        }

        // X·ª≠ l√Ω load tab
        document.querySelectorAll('.user-nav-pills .nav-link, .tab-pane').forEach(el => {
            el.classList.remove("active", "show");
        });

        const savedTabId = localStorage.getItem("activeSidebarTab");
        const savedTab = savedTabId ? document.getElementById(savedTabId) : null;

        if (savedTab) {
            new bootstrap.Tab(savedTab).show();
        } else {
            const defaultTab = document.querySelector('.user-nav-pills .nav-link');
            if (defaultTab) new bootstrap.Tab(defaultTab).show();
        }

        tabLinks.forEach(tab => {
            tab.addEventListener("shown.bs.tab", function (e) {
                const tabId = e.target.getAttribute("id");
                localStorage.setItem("activeSidebarTab", tabId);

                if (tabId === "pills-order-tab" && !isOrderTableInitialized) {
                    loadOrderData();
                }
            });
        });
    });
    document.addEventListener("click", function (e) {
        const button = e.target.closest(".confirm-btn");
        if (!button) return;

        const orderId = button.getAttribute("data-order-id");
        if (!orderId) return;

        Swal.fire({
            title: "X√°c nh·∫≠n ƒë∆°n h√†ng?",
            text: "B·∫°n c√≥ ch·∫Øc mu·ªën x√°c nh·∫≠n ƒë∆°n h√†ng n√†y kh√¥ng?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "X√°c nh·∫≠n",
            cancelButtonText: "Hu·ª∑",
        }).then((result) => {
            if (!result.isConfirmed) return;

            fetch(`/AgriculturalWarehouseManagementApplication/api/seller/orders/${orderId}/confirm`, {
                method: "PUT"
            })
                .then(res => {
                    if (!res.ok) throw new Error("X√°c nh·∫≠n th·∫•t b·∫°i");
                    return res.text();
                })
                .then(msg => {
                    Swal.fire({
                        title: "Th√†nh c√¥ng",
                        text: msg,
                        icon: "success",
                        confirmButtonText: "OK"
                    }).then(() => {
                        location.reload(); // Reload l·∫°i sau khi nh·∫•n OK
                    });
                })
                .catch(err => {
                    Swal.fire({
                        title: "L·ªói",
                        text: err.message,
                        icon: "error"
                    });
                });
        });
    });
    document.addEventListener("click", function (e) {
        const trackingBtn = e.target.closest(".btn-tracking-custom");
        if (!trackingBtn) return;

        const orderId = trackingBtn.getAttribute("data-order-id");
        if (!orderId) return;

        window.location.href = `/AgriculturalWarehouseManagementApplication/order/orderTracking?orderId=${orderId}`;
    });

</script>

<!--CSS Order-->
<style>
    .icon-circle {
        background-color: #198754; /* m√†u xanh success */
        color: white; /* m√†u icon */
        width: 24px;
        height: 24px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 14px;
    }


    /* √Åp d·ª•ng border d·ªçc cho t·ª´ng √¥ */
    #orderTable th, #orderTable td {
        border-right: 1px solid #dee2e6; /* m√†u x√°m nh·∫°t gi·ªëng Bootstrap */
    }

    /* Xo√° border ph·∫£i c·ªßa c·ªôt cu·ªëi c√πng ƒë·ªÉ kh√¥ng b·ªã vi·ªÅn th·ª´a */
    #orderTable th:last-child,
    #orderTable td:last-child {
        border-right: none;
    }

    /* ƒê·∫£m b·∫£o c√≥ border ngang n·∫øu c·∫ßn */
    #orderTable {
        border-collapse: collapse;
    }

    /* TƒÉng kho·∫£ng c√°ch gi·ªØa c√°c control v√† b·∫£ng */
    .dataTables_length,
    .dataTables_filter,
    .dataTables_info,
    .dataTables_paginate {
        margin-top: 20px;
        margin-bottom: 25px;
    }

    /* N·∫øu c·∫ßn ƒë·∫©y control ra xa b·∫£ng h∆°n n·ªØa */
    .dataTables_wrapper .row {
        margin-bottom: 20px;
    }

    button.disabled-btn:disabled {
        background-color: transparent !important;
        border: 1px solid #ccc;
        color: #aaa !important;
        cursor: not-allowed;
    }

    .btn-tracking-custom {
        background-color: #198754 !important; /* Bootstrap green */
        color: #fff !important;
        border: 1px solid #198754 !important;
        font-weight: 500;
    }

    .btn-tracking-custom:hover,
    .btn-tracking-custom:focus,
    .btn-tracking-custom:active {
        background-color: #157347 !important;
        color: #fff !important;
        border-color: #157347 !important;
    }

    #orderTable thead th {
        text-align: center;
        vertical-align: middle; /* n·∫øu mu·ªën cƒÉn gi·ªØa theo chi·ªÅu d·ªçc lu√¥n */
    }

    /* B·∫£ng t·ªïng th·ªÉ */
    table.dataTable {
        border-collapse: separate !important;
        border-spacing: 0;
        width: 100% !important;
        background-color: #fff;
        border-radius: 12px;
        overflow: hidden;
        font-family: "Segoe UI", Roboto, sans-serif;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    /* Header */
    table.dataTable thead {
        background-color: #f8f9fa;
        text-align: center;
        font-weight: 600;
    }

    table.dataTable thead th {
        padding: 12px 16px;
        color: #343a40;
        vertical-align: middle;
    }

    /* D√≤ng d·ªØ li·ªáu */
    table.dataTable tbody td {
        padding: 10px 16px;
        vertical-align: middle;
        color: #212529;
    }

    table.dataTable tbody tr:hover {
        background-color: #f1f3f5;
        cursor: pointer;
    }

    /* CƒÉn ph·∫£i cho s·ªë */
    td.text-end,
    th.text-end {
        text-align: right !important;
    }

    /* CƒÉn gi·ªØa cho c√°c icon, h√†nh ƒë·ªông */
    td.text-center,
    th.text-center {
        text-align: center !important;
    }

    /* Pagination (n·∫øu c·∫ßn tinh ch·ªânh) */
    .dataTables_paginate {
        margin-top: 20px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 4px 10px;
        margin: 0 2px;
        background-color: white;
        color: #495057;
        font-weight: 500;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background-color: #007bff;
        color: white !important;
        border-color: #007bff;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background: #e9ecef;
        color: #212529 !important;
    }
</style>
<!--Tab Order End-->

<!-- Bg overlay Start -->
<div class="bg-overlay"></div>
<!-- Bg overlay End -->

<!-- latest jquery-->
<script th:src="@{/Frontend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- jquery ui-->
<script th:src="@{/Frontend/assets/js/jquery-ui.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/bootstrap-notify.min.js}"></script>
<script th:src="@{/Frontend/assets/js/bootstrap/popper.min.js}"></script>

<!-- feather icon js-->
<script th:src="@{/Frontend/assets/js/feather/feather.min.js}"></script>
<script th:src="@{/Frontend/assets/js/feather/feather-icon.js}"></script>

<!-- Lazyload Js -->
<script th:src="@{/Frontend/assets/js/lazysizes.min.js}"></script>

<!-- Slick js-->
<script th:src="@{/Frontend/assets/js/slick/slick.js}"></script>
<script th:src="@{/Frontend/assets/js/slick/custom_slick.js}"></script>

<!-- Apexcharts Js -->
<script th:src="@{/Frontend/assets/js/apexchart.js}"></script>
<script th:src="@{/Frontend/assets/js/custom-chart.js}"></script>

<!-- Nav & tab upside js -->
<script th:src="@{/Frontend/assets/js/nav-tab.js}"></script>

<!-- script js -->
<script th:src="@{/Frontend/assets/js/script.js}"></script>

<!-- DataTables + mark.js -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.6/features/mark.js/datatables.mark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"></script>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- theme setting js -->
<script th:src="@{/Frontend/assets/js/theme-setting.js}"></script>

<!--Reload gi·ªØ nguy√™n tab-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabLinks = document.querySelectorAll('.user-nav-pills .nav-link');

        // G·ª° class active/show ƒë·ªÉ ƒë·∫£m b·∫£o reset tr∆∞·ªõc
        document.querySelectorAll('.user-nav-pills .nav-link, .tab-pane').forEach(el => {
            el.classList.remove("active", "show");
        });

        // K√≠ch ho·∫°t tab ƒë√£ l∆∞u
        const savedTabId = localStorage.getItem("activeSidebarTab");
        const savedTab = savedTabId ? document.getElementById(savedTabId) : null;

        if (savedTab) {
            new bootstrap.Tab(savedTab).show(); // Bootstrap t·ª± x·ª≠ l√Ω class active/show
        } else {
            const defaultTab = document.querySelector('.user-nav-pills .nav-link');
            if (defaultTab) new bootstrap.Tab(defaultTab).show();
        }

        // Ghi l·∫°i khi chuy·ªÉn tab
        tabLinks.forEach(tab => {
            tab.addEventListener("shown.bs.tab", function (e) {
                localStorage.setItem("activeSidebarTab", e.target.getAttribute("id"));
            });
        });
    });
</script>

</body>

</html>