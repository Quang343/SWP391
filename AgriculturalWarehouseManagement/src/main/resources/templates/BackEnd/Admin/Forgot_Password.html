<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Cuba admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords"
          content="admin template, Cuba admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <link rel="icon" href="assets/images/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon">
    <title>Fastkart - Forgot PassWord</title>

    <!-- Google font-->
    <link
            href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

    <!-- Fontawesome css -->
    <link rel="stylesheet" type="text/css" th:href="@{/BackEnd/assets/css/vendors/font-awesome.css}">

    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" th:href="@{/BackEnd/assets/css/vendors/themify.css}">

    <!-- Feather icon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/BackEnd/assets/css/vendors/feather-icon.css}">

    <!-- Bootstrap css -->
    <link rel="stylesheet" type="text/css" th:href="@{/BackEnd/assets/css/vendors/bootstrap.css}">

    <!-- App css -->
    <link rel="stylesheet" type="text/css" th:href="@{/BackEnd/assets/css/style.css}">
</head>

<body>

<!-- forgot password start -->
<section class="log-in-section section-b-space">
    <a href="" class="logo-login"><img th:src="@{/BackEnd/assets/images/logo/1.png}" alt="" class="img-fluid"></a>
    <div class="container w-100">
        <div class="row">

            <div class="col-xl-5 col-lg-6 me-auto">
                <div class="log-in-box">
                    <div class="log-in-title">
                        <h3>Welcome To Fastkart</h3>
                        <h4>Forgot Password</h4>
                    </div>

                    <div class="input-box">
                        <form id="forgotForm" class="row g-4" method="post" th:action="@{/forgotPasswordAdmin/verify/}">
                            <div class="col-12">
                                <div class="form-floating theme-form-floating log-in-form">
                                    <input type="email" class="form-control" id="email" placeholder="Email Address" required>
                                    <label for="email">Enter Email Address</label>
                                </div>
                            </div>
                            <div class="box-msg"></div>

                            <div class="col-12">
                                <button id="submitBtn" class="btn btn-animation w-100 justify-content-center"
                                        type="submit">Send</button>
                            </div>
                            <div id="loadingSpinner" style="display: none; text-align: center; margin-top: 10px;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- forgot password end -->


<!-- latest jquery-->
<script th:src="@{/BackEnd/assets/js/jquery-3.6.0.min.js}"></script>

<!-- Bootstrap js-->
<script th:src="@{/BackEnd/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>

<!-- Theme js-->
<script th:src="@{/BackEnd/assets/js/script.js}"></script>
</body>

<script>
    document.getElementById('forgotForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const boxMsg = document.querySelector('.box-msg');
        const submitBtn = document.getElementById('submitBtn');
        const spinner = document.getElementById('loadingSpinner');

        boxMsg.textContent = '';
        submitBtn.disabled = true;
        spinner.style.display = 'block';

        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

        fetch(`/AgriculturalWarehouseManagementApplication/forgotPasswordAdmin/verify/${email}`, {
            method: 'POST',
            headers: {
                [csrfHeader]: csrfToken,
            }
        })
            .then(async response => {
                spinner.style.display = 'none';
                submitBtn.disabled = false;

                if (response.ok) {
                    window.location.href = '/AgriculturalWarehouseManagementApplication/forgotPasswordAdmin/enter-otp';
                } else {
                    const errorData = await response.json();
                    boxMsg.innerText = errorData.error || "Something went wrong.";
                    boxMsg.style.color = 'red';
                }
            })
            .catch(error => {
                console.error(error);
                spinner.style.display = 'none';
                submitBtn.disabled = false;
                boxMsg.innerText = "Network error or server unavailable.";
                boxMsg.style.color = "red";
            });
    });
</script>

</html>