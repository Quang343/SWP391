<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Fastkart admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords"
          content="admin template, Fastkart admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" th:href="@{/BackEnd/assets/images/favicon.png}" type="image/x-icon">
    <link rel="shortcut icon" th:href="@{/BackEnd/assets/images/favicon.png}" type="image/x-icon">
    <title>Fastkart - Currency Rate</title>

    <!-- Google font-->
    <link
            href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet">

    <!-- Fontawesome css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/font-awesome.css}">

    <!-- Linear Icon css -->
    <link rel="stylesheet" th:href="@{/Backend/assets/css/linearicon.css}">

    <!-- remixicon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/remixicon.css}">

    <!-- Data Table css -->
    <!--    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/datatables.css}">-->

    <!-- Themify icon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/themify.css}">

    <!-- Feather icon css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/feather-icon.css}">

    <!-- Plugins css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/scrollbar.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/animate.css}">

    <!-- Bootstrap css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/vendors/bootstrap.css}">

    <!-- App css -->
    <link rel="stylesheet" type="text/css" th:href="@{/Backend/assets/css/style.css}">

    <!-- DataTables official CSS (bổ sung để có icon sắp xếp) -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>
<style>

    table.dataTable thead th {
        text-align: center !important;
    }

    /* Canh giữa nội dung trong th */
    table.dataTable thead th {
        text-align: center !important;
        vertical-align: middle;
        white-space: nowrap;
    }

    /* Canh giữa icon sort */
    table.dataTable thead .sorting:after,
    table.dataTable thead .sorting_asc:after,
    table.dataTable thead .sorting_desc:after {
        margin-left: 5px;
        float: none;
        position: relative;
        top: 1px;
    }

    div.dataTables_filter {
        position: absolute;
        right: 0;
        margin-bottom: 1rem;
    }

    .dataTables_wrapper .dataTables_filter input {
        padding: 7px;
        font-size: 16px;
    }
</style>

<body>
<!-- tap on top start -->
<div class="tap-top">
    <span class="lnr lnr-chevron-up"></span>
</div>
<!-- tap on tap end -->

<!-- page-wrapper Start -->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start -->
    <div th:replace="BackEnd/fragments/Admin/header::header"></div>
    <!-- Page Header End -->

    <!-- Page Body Start -->
    <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div th:replace="BackEnd/fragments/Admin/sidebar::sidebar"></div>
        <!-- Page Sidebar Ends-->

        <!-- Container-fluid starts-->
        <div class="page-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card card-table">
                            <!-- Table Start -->
                            <div class="card-body">
                                <div class="title-header option-title">
                                    <h5>Danh sách vai trò</h5>
                                    <form class="d-inline-flex">
                                        <a th:href="@{/admin/add_role}" class="align-items-center btn btn-theme d-flex">
                                            <i data-feather="plus"></i>Thêm vai trò
                                        </a>
                                    </form>
                                </div>
                                <div>
                                    <div class="table-responsive">
                                        <table id="table_id" class="table role-table all-package theme-table">
                                            <thead>
                                            <tr>
                                                <th>STT</th>
                                                <th>Tên</th>
                                                <!--                                                    <th>Description</th>-->
                                                <th>Trạng thái</th>
                                                <th>Thao tác</th>
                                            </tr>
                                            </thead>

                                            <tbody>
                                            <tr th:each="role, init : ${roles}">
                                                <td th:text="${init.count}"></td>
                                                <td th:text="${role.getName()}"></td>
                                                <!--                                                    <td th:text="${role.getDescription()}"></td>-->
                                                <td th:text="${role.getStatus()}"></td>
                                                <td>
                                                    <ul>
                                                        <li>
                                                            <a th:href="@{'/admin/edit_role/' + ${role.getId()}}">
                                                                <i class="ri-pencil-line"></i>
                                                            </a>
                                                        </li>

                                                        <li>
                                                            <a href="javascript:void(0)"
                                                               th:attr="data-id=${role.getId()}"
                                                               data-bs-toggle="modal"
                                                               data-bs-target="#ModalToggle">
                                                                <i class="ri-delete-bin-line"></i>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- Table End -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Container-fluid Ends-->

            <!-- footer start-->
            <div th:replace="BackEnd/fragments/Admin/footer::footer"></div>
            <!-- footer end-->
        </div>
    </div>
    <!-- Page Body End -->

    <!-- Modal Start -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                    <p>Are you sure you want to log out?</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="button-box">
                        <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                        <button type="button" class="btn  btn--yes btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal End -->
</div>
<!-- page-wrapper End-->

<!-- Delete Modal Box Start -->
<div class="modal fade theme-modal remove-coupon" id="ModalToggle" aria-hidden="true" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header d-block text-center">
                <h5 class="modal-title w-100" id="exampleModalLabel22">Xóa vai trò</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="remove-box">
                    <p style="font-size: 15px">Bạn có chắc chắn muốn xóa vai trò này không?</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-animation btn-md fw-bold" data-bs-dismiss="modal">
                    Hủy bỏ
                </button>
                <button type="button" class="btn btn-animation btn-md fw-bold"
                        data-bs-target="#resultModal"
                        data-bs-toggle="modal" data-bs-dismiss="modal"
                        onclick="confirmDelete()">
                    Xác nhận
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade theme-modal remove-coupon" id="resultModal" aria-hidden="true" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center" id="exampleModalLabel12">Hoàn tất</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="remove-box text-center">
                    <div class="wrapper">
                        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    <h4 class="text-content">Xoá thành công</h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<!-- Delete Modal Box End -->

<!-- latest js -->
<script th:src="@{/Backend/assets/js/jquery-3.6.0.min.js}"></script>

<!-- Bootstrap js -->
<script th:src="@{/Backend/assets/js/bootstrap/bootstrap.bundle.min.js}"></script>

<!-- feather icon js -->
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather.min.js}"></script>
<script th:src="@{/Backend/assets/js/icons/feather-icon/feather-icon.js}"></script>

<!-- scrollbar simplebar js -->
<script th:src="@{/Backend/assets/js/scrollbar/simplebar.js}"></script>
<script th:src="@{/Backend/assets/js/scrollbar/custom.js}"></script>

<!-- customizer js -->
<script th:src="@{/Backend/assets/js/customizer.js}"></script>

<!-- Sidebar js -->
<script th:src="@{/Backend/assets/js/config.js}"></script>

<!-- Plugins js -->
<script th:src="@{/Backend/assets/js/sidebar-menu.js}"></script>
<script th:src="@{/Backend/assets/js/notify/bootstrap-notify.min.js}"></script>
<script th:src="@{/Backend/assets/js/notify/index.js}"></script>

<!-- Data table js -->
<script th:src="@{/Backend/assets/js/jquery.dataTables.js}"></script>
<script th:src="@{/Backend/assets/js/custom-data-table.js}"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>


<!-- all checkbox select js -->
<script th:src="@{/Backend/assets/js/checkbox-all-check.js}"></script>

<!-- sidebar effect -->
<script th:src="@{/Backend/assets/js/sidebareffect.js}"></script>

<!-- Theme js -->
<script th:src="@{/Backend/assets/js/script.js}"></script>

<script>
    let selectedRoleId = null;
    const confirmModal = document.getElementById('ModalToggle');

    confirmModal.addEventListener('shown.bs.modal', function (e) {
        selectedRoleId = e.relatedTarget.getAttribute('data-id');
    })

    function confirmDelete() {
        if (!selectedRoleId) return;

        fetch(`/AgriculturalWarehouseManagementApplication/admin/delete_role/${selectedRoleId}`, {
            method: 'DELETE',
        })
            .then(response => response.json())
            .then(data => {
                const resultModal = document.getElementById('resultModal');
                const modal = new bootstrap.Modal(resultModal);
                modal.show();

                selectedRoleId = null;
                setTimeout(() => location.reload(), 1000);
            })
            .catch(error => {
                alert("Lỗi khi xoá role: " + error);
            });
    }


</script>

<script>
    $(document).ready(function () {
        if (!$.fn.DataTable.isDataTable('#table_id')) {
            $('#table_id').DataTable({
                paging: false,       // Tắt phân trang vì bạn đã làm riêng
                searching: true,     // Cho phép tìm kiếm
                ordering: true,      // Cho phép sắp xếp
                info: false,         // Tắt dòng "Hiển thị x đến y..."
                language: {
                    search: "Tìm kiếm:",
                    emptyTable: "Không có dữ liệu",
                    zeroRecords: "Không tìm thấy kết quả phù hợp"
                }
            });
        }
    });
</script>

<script>
    $(document).ready(function () {
        if ($.fn.DataTable.isDataTable('#table_id')) {
            $('#table_id').DataTable().destroy(); // Hủy bảng cũ nếu đã khởi tạo
        }
        $('#table_id').DataTable({
            paging: true, // Bật phân trang
            searching: true, // Bật tìm kiếm
            ordering: true, // Cho phép sắp xếp
            info: true, // Hiển thị thông tin phân trang ("Hiển thị x đến y của z bản ghi")
            language: {
                search: "",
                searchPlaceholder: "Tìm kiếm...",
                emptyTable: "Không có dữ liệu để hiển thị",
                zeroRecords: "Không tìm thấy kết quả phù hợp",
                info: "Hiển thị _START_ đến _END_ trong _TOTAL_ bản ghi",
                paginate: {
                    first: "Đầu",
                    last: "Cuối",
                    next: "Sau",
                    previous: "Trước"
                }
            }
        });
    });
</script>

</body>

</html>